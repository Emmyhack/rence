import{r as qo,f as G,w as ii,V as A0,M as $0,N as L,k as C0,h as Vc,i as O0,K as R0,A as T0,q as Pl,x as N0,H as D0,F as q0,j as xl,$ as z0,t as B0,p as j0,J as L0,u as Xn,m as Sl,X as U0,o as M0,s as Mf,v as sr,I as k0,y as Fl,z as un,B as Ve,U as at,C as ri,D as Et,E as H0,G as hn,L as kf,O as V0,P as K0,Q as G0,R as Hf,S as W0,T as Vf,W as Kf,Y as fn,Z as Kc,a0 as Ao,a1 as pn,a2 as J0,a3 as $o,a4 as Q0,a5 as Y0,a6 as Z0,a7 as X0,a8 as mo,a9 as ew,aa as tw,ab as _c,ac as Al,ad as rw,ae as iw,af as nw,ag as $l,ah as sw,ai as ow,aj as aw,ak as cw,al as uw,am as hw,an as lw,ao as Qn,ap as Gf,aq as Ec,ar as fw,as as pw,_ as dw}from"./web3-735b79eb.js";import{s as rs,a as zo,e as Qt,r as Wf,f as xi,g as ou,i as or,b as is,c as Cl,d as gw,h as yw,j as au,p as mw,k as cu,l as Bo,E as uu,m as ti,n as vw,o as oi}from"./index.es-6e953a74.js";import{a as Jf,g as hu,c as vo}from"./vendor-d152ed12.js";const ww=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,bw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,_w=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Ew(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Iw(s);return}return t}function Iw(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function wo(s,t={}){if(typeof s!="string")return s;if(s[0]==='"'&&s[s.length-1]==='"'&&s.indexOf("\\")===-1)return s.slice(1,-1);const r=s.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!_w.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(ww.test(s)||bw.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,Ew)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function Pw(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function Ye(s,...t){try{return Pw(s(...t))}catch(r){return Promise.reject(r)}}function xw(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function Sw(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function Co(s){if(xw(s))return String(s);if(Sw(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return Co(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Gc="base64:";function Fw(s){return typeof s=="string"?s:Gc+Cw(s)}function Aw(s){return typeof s!="string"||!s.startsWith(Gc)?s:$w(s.slice(Gc.length))}function $w(s){return globalThis.Buffer?Buffer.from(s,"base64"):Uint8Array.from(globalThis.atob(s),t=>t.codePointAt(0))}function Cw(s){return globalThis.Buffer?Buffer.from(s).toString("base64"):globalThis.btoa(String.fromCodePoint(...s))}function _t(s){var t;return s&&((t=s.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Ow(...s){return _t(s.join(":"))}function bo(s){return s=_t(s),s?s+":":""}function Rw(s,t){if(t===void 0)return!0;let r=0,n=s.indexOf(":");for(;n>-1;)r++,n=s.indexOf(":",n+1);return r<=t}function Tw(s,t){return t?s.startsWith(t)&&s[s.length-1]!=="$":s[s.length-1]!=="$"}const Nw="memory",Dw=()=>{const s=new Map;return{name:Nw,getInstance:()=>s,hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return[...s.keys()]},clear(){s.clear()},dispose(){s.clear()}}};function qw(s={}){const t={mounts:{"":s.driver||Dw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=y=>{for(const m of t.mountpoints)if(y.startsWith(m))return{base:m,relativeKey:y.slice(m.length),driver:t.mounts[m]};return{base:"",relativeKey:y,driver:t.mounts[""]}},n=(y,m)=>t.mountpoints.filter(b=>b.startsWith(y)||m&&y.startsWith(b)).map(b=>({relativeBase:y.length>b.length?y.slice(b.length):void 0,mountpoint:b,driver:t.mounts[b]})),a=(y,m)=>{if(t.watching){m=_t(m);for(const b of t.watchListeners)b(y,m)}},u=async()=>{if(!t.watching){t.watching=!0;for(const y in t.mounts)t.unwatch[y]=await Ol(t.mounts[y],a,y)}},h=async()=>{if(t.watching){for(const y in t.unwatch)await t.unwatch[y]();t.unwatch={},t.watching=!1}},d=(y,m,b)=>{const x=new Map,A=S=>{let D=x.get(S.base);return D||(D={driver:S.driver,base:S.base,items:[]},x.set(S.base,D)),D};for(const S of y){const D=typeof S=="string",k=_t(D?S:S.key),M=D?void 0:S.value,Q=D||!S.options?m:{...m,...S.options},T=r(k);A(T).items.push({key:k,value:M,relativeKey:T.relativeKey,options:Q})}return Promise.all([...x.values()].map(S=>b(S))).then(S=>S.flat())},p={hasItem(y,m={}){y=_t(y);const{relativeKey:b,driver:x}=r(y);return Ye(x.hasItem,b,m)},getItem(y,m={}){y=_t(y);const{relativeKey:b,driver:x}=r(y);return Ye(x.getItem,b,m).then(A=>wo(A))},getItems(y,m={}){return d(y,m,b=>b.driver.getItems?Ye(b.driver.getItems,b.items.map(x=>({key:x.relativeKey,options:x.options})),m).then(x=>x.map(A=>({key:Ow(b.base,A.key),value:wo(A.value)}))):Promise.all(b.items.map(x=>Ye(b.driver.getItem,x.relativeKey,x.options).then(A=>({key:x.key,value:wo(A)})))))},getItemRaw(y,m={}){y=_t(y);const{relativeKey:b,driver:x}=r(y);return x.getItemRaw?Ye(x.getItemRaw,b,m):Ye(x.getItem,b,m).then(A=>Aw(A))},async setItem(y,m,b={}){if(m===void 0)return p.removeItem(y);y=_t(y);const{relativeKey:x,driver:A}=r(y);A.setItem&&(await Ye(A.setItem,x,Co(m),b),A.watch||a("update",y))},async setItems(y,m){await d(y,m,async b=>{if(b.driver.setItems)return Ye(b.driver.setItems,b.items.map(x=>({key:x.relativeKey,value:Co(x.value),options:x.options})),m);b.driver.setItem&&await Promise.all(b.items.map(x=>Ye(b.driver.setItem,x.relativeKey,Co(x.value),x.options)))})},async setItemRaw(y,m,b={}){if(m===void 0)return p.removeItem(y,b);y=_t(y);const{relativeKey:x,driver:A}=r(y);if(A.setItemRaw)await Ye(A.setItemRaw,x,m,b);else if(A.setItem)await Ye(A.setItem,x,Fw(m),b);else return;A.watch||a("update",y)},async removeItem(y,m={}){typeof m=="boolean"&&(m={removeMeta:m}),y=_t(y);const{relativeKey:b,driver:x}=r(y);x.removeItem&&(await Ye(x.removeItem,b,m),(m.removeMeta||m.removeMata)&&await Ye(x.removeItem,b+"$",m),x.watch||a("remove",y))},async getMeta(y,m={}){typeof m=="boolean"&&(m={nativeOnly:m}),y=_t(y);const{relativeKey:b,driver:x}=r(y),A=Object.create(null);if(x.getMeta&&Object.assign(A,await Ye(x.getMeta,b,m)),!m.nativeOnly){const S=await Ye(x.getItem,b+"$",m).then(D=>wo(D));S&&typeof S=="object"&&(typeof S.atime=="string"&&(S.atime=new Date(S.atime)),typeof S.mtime=="string"&&(S.mtime=new Date(S.mtime)),Object.assign(A,S))}return A},setMeta(y,m,b={}){return this.setItem(y+"$",m,b)},removeMeta(y,m={}){return this.removeItem(y+"$",m)},async getKeys(y,m={}){var k;y=bo(y);const b=n(y,!0);let x=[];const A=[];let S=!0;for(const M of b){(k=M.driver.flags)!=null&&k.maxDepth||(S=!1);const Q=await Ye(M.driver.getKeys,M.relativeBase,m);for(const T of Q){const B=M.mountpoint+_t(T);x.some(W=>B.startsWith(W))||A.push(B)}x=[M.mountpoint,...x.filter(T=>!T.startsWith(M.mountpoint))]}const D=m.maxDepth!==void 0&&!S;return A.filter(M=>(!D||Rw(M,m.maxDepth))&&Tw(M,y))},async clear(y,m={}){y=bo(y),await Promise.all(n(y,!1).map(async b=>{if(b.driver.clear)return Ye(b.driver.clear,b.relativeBase,m);if(b.driver.removeItem){const x=await b.driver.getKeys(b.relativeBase||"",m);return Promise.all(x.map(A=>b.driver.removeItem(A,m)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(y=>Rl(y)))},async watch(y){return await u(),t.watchListeners.push(y),async()=>{t.watchListeners=t.watchListeners.filter(m=>m!==y),t.watchListeners.length===0&&await h()}},async unwatch(){t.watchListeners=[],await h()},mount(y,m){if(y=bo(y),y&&t.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(t.mountpoints.push(y),t.mountpoints.sort((b,x)=>x.length-b.length)),t.mounts[y]=m,t.watching&&Promise.resolve(Ol(m,a,y)).then(b=>{t.unwatch[y]=b}).catch(console.error),p},async unmount(y,m=!0){var b,x;y=bo(y),!(!y||!t.mounts[y])&&(t.watching&&y in t.unwatch&&((x=(b=t.unwatch)[y])==null||x.call(b),delete t.unwatch[y]),m&&await Rl(t.mounts[y]),t.mountpoints=t.mountpoints.filter(A=>A!==y),delete t.mounts[y])},getMount(y=""){y=_t(y)+":";const m=r(y);return{driver:m.driver,base:m.base}},getMounts(y="",m={}){return y=_t(y),n(y,m.parents).map(x=>({driver:x.driver,base:x.mountpoint}))},keys:(y,m={})=>p.getKeys(y,m),get:(y,m={})=>p.getItem(y,m),set:(y,m,b={})=>p.setItem(y,m,b),has:(y,m={})=>p.hasItem(y,m),del:(y,m={})=>p.removeItem(y,m),remove:(y,m={})=>p.removeItem(y,m)};return p}function Ol(s,t,r){return s.watch?s.watch((n,a)=>t(n,r+a)):()=>{}}async function Rl(s){typeof s.dispose=="function"&&await Ye(s.dispose)}function Si(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function Qf(s,t){let r;const n=()=>{if(r)return r;const a=indexedDB.open(s);return a.onupgradeneeded=()=>a.result.createObjectStore(t),r=Si(a),r.then(u=>{u.onclose=()=>r=void 0},()=>{}),r};return(a,u)=>n().then(h=>u(h.transaction(t,a).objectStore(t)))}let Ic;function ns(){return Ic||(Ic=Qf("keyval-store","keyval")),Ic}function Tl(s,t=ns()){return t("readonly",r=>Si(r.get(s)))}function zw(s,t,r=ns()){return r("readwrite",n=>(n.put(t,s),Si(n.transaction)))}function Bw(s,t=ns()){return t("readwrite",r=>(r.delete(s),Si(r.transaction)))}function jw(s=ns()){return s("readwrite",t=>(t.clear(),Si(t.transaction)))}function Lw(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Si(s.transaction)}function Uw(s=ns()){return s("readonly",t=>{if(t.getAllKeys)return Si(t.getAllKeys());const r=[];return Lw(t,n=>r.push(n.key)).then(()=>r)})}const Mw="idb-keyval";var kw=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=a=>t+a;let n;return s.dbName&&s.storeName&&(n=Qf(s.dbName,s.storeName)),{name:Mw,options:s,async hasItem(a){return!(typeof await Tl(r(a),n)>"u")},async getItem(a){return await Tl(r(a),n)??null},setItem(a,u){return zw(r(a),u,n)},removeItem(a){return Bw(r(a),n)},getKeys(){return Uw(n)},clear(){return jw(n)}}};const Hw="WALLET_CONNECT_V2_INDEXED_DB",Vw="keyvaluestorage";let Kw=class{constructor(){this.indexedDb=qw({driver:kw({dbName:Hw,storeName:Vw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,rs(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var Pc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Oo={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Pc<"u"&&Pc.localStorage?Oo.exports=Pc.localStorage:typeof window<"u"&&window.localStorage?Oo.exports=window.localStorage:Oo.exports=new t})();function Gw(s){var t;return[s[0],zo((t=s[1])!=null?t:"")]}let Ww=class{constructor(){this.localStorage=Oo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Gw)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return zo(r)}async setItem(t,r){this.localStorage.setItem(t,rs(r))}async removeItem(t){this.localStorage.removeItem(t)}};const Jw="wc_storage_version",Nl=1,Qw=async(s,t,r)=>{const n=Jw,a=await t.getItem(n);if(a&&a>=Nl){r(t);return}const u=await s.getKeys();if(!u.length){r(t);return}const h=[];for(;u.length;){const d=u.shift();if(!d)continue;const p=d.toLowerCase();if(p.includes("wc@")||p.includes("walletconnect")||p.includes("wc_")||p.includes("wallet_connect")){const y=await s.getItem(d);await t.setItem(d,y),h.push(d)}}await t.setItem(n,Nl),r(t),Yw(s,h)},Yw=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let Zw=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Ww;this.storage=t;try{const r=new Kw;Qw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var dn={},Mn={},xc={},kn={};class Fi{}const Xw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Fi},Symbol.toStringTag,{value:"Module"})),eb=Jf(Xw);var Dl;function tb(){if(Dl)return kn;Dl=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.IHeartBeat=void 0;const s=eb;class t extends s.IEvents{constructor(n){super()}}return kn.IHeartBeat=t,kn}var ql;function Yf(){return ql||(ql=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),qo.__exportStar(tb(),s)}(xc)),xc}var Sc={},Ii={},zl;function rb(){if(zl)return Ii;zl=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.HEARTBEAT_EVENTS=Ii.HEARTBEAT_INTERVAL=void 0;const s=G;return Ii.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Ii.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ii}var Bl;function Zf(){return Bl||(Bl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),qo.__exportStar(rb(),s)}(Sc)),Sc}var jl;function ib(){if(jl)return Mn;jl=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.HeartBeat=void 0;const s=qo,t=Qt,r=G,n=Yf(),a=Zf();class u extends n.IHeartBeat{constructor(d){super(d),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(d==null?void 0:d.interval)||a.HEARTBEAT_INTERVAL}static init(d){return s.__awaiter(this,void 0,void 0,function*(){const p=new u(d);return yield p.init(),p})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(d,p){this.events.on(d,p)}once(d,p){this.events.once(d,p)}off(d,p){this.events.off(d,p)}removeListener(d,p){this.events.removeListener(d,p)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Mn.HeartBeat=u,Mn}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=qo;t.__exportStar(ib(),s),t.__exportStar(Yf(),s),t.__exportStar(Zf(),s)})(dn);function nb(s){try{return JSON.stringify(s)}catch{return'"[Circular]"'}}var sb=ob;function ob(s,t,r){var n=r&&r.stringify||nb,a=1;if(typeof s=="object"&&s!==null){var u=t.length+a;if(u===1)return s;var h=new Array(u);h[0]=n(s);for(var d=1;d<u;d++)h[d]=n(t[d]);return h.join(" ")}if(typeof s!="string")return s;var p=t.length;if(p===0)return s;for(var y="",m=1-a,b=-1,x=s&&s.length||0,A=0;A<x;){if(s.charCodeAt(A)===37&&A+1<x){switch(b=b>-1?b:0,s.charCodeAt(A+1)){case 100:case 102:if(m>=p||t[m]==null)break;b<A&&(y+=s.slice(b,A)),y+=Number(t[m]),b=A+2,A++;break;case 105:if(m>=p||t[m]==null)break;b<A&&(y+=s.slice(b,A)),y+=Math.floor(Number(t[m])),b=A+2,A++;break;case 79:case 111:case 106:if(m>=p||t[m]===void 0)break;b<A&&(y+=s.slice(b,A));var S=typeof t[m];if(S==="string"){y+="'"+t[m]+"'",b=A+2,A++;break}if(S==="function"){y+=t[m].name||"<anonymous>",b=A+2,A++;break}y+=n(t[m]),b=A+2,A++;break;case 115:if(m>=p)break;b<A&&(y+=s.slice(b,A)),y+=String(t[m]),b=A+2,A++;break;case 37:b<A&&(y+=s.slice(b,A)),y+="%",b=A+2,A++,m--;break}++m}++A}return b===-1?s:(b<x&&(y+=s.slice(b)),y)}const Ll=sb;var ab=mr;const es=mb().console||{},cb={mapHttpRequest:_o,mapHttpResponse:_o,wrapRequestSerializer:Fc,wrapResponseSerializer:Fc,wrapErrorSerializer:Fc,req:_o,res:_o,err:pb};function ub(s,t){return Array.isArray(s)?s.filter(function(n){return n!=="!stdSerializers.err"}):s===!0?Object.keys(t):!1}function mr(s){s=s||{},s.browser=s.browser||{};const t=s.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=s.browser.write||es;s.browser.write&&(s.browser.asObject=!0);const n=s.serializers||{},a=ub(s.browser.serialize,n);let u=s.browser.serialize;Array.isArray(s.browser.serialize)&&s.browser.serialize.indexOf("!stdSerializers.err")>-1&&(u=!1);const h=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),s.enabled===!1&&(s.level="silent");const d=s.level||"info",p=Object.create(r);p.log||(p.log=ts),Object.defineProperty(p,"levelVal",{get:m}),Object.defineProperty(p,"level",{get:b,set:x});const y={transmit:t,serialize:a,asObject:s.browser.asObject,levels:h,timestamp:db(s)};p.levels=mr.levels,p.level=d,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=ts,p.serializers=n,p._serialize=a,p._stdErrSerialize=u,p.child=A,t&&(p._logEvent=Wc());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function b(){return this._level}function x(S){if(S!=="silent"&&!this.levels.values[S])throw Error("unknown level "+S);this._level=S,on(y,p,"error","log"),on(y,p,"fatal","error"),on(y,p,"warn","error"),on(y,p,"info","log"),on(y,p,"debug","log"),on(y,p,"trace","log")}function A(S,D){if(!S)throw new Error("missing bindings for child Pino");D=D||{},a&&S.serializers&&(D.serializers=S.serializers);const k=D.serializers;if(a&&k){var M=Object.assign({},n,k),Q=s.browser.serialize===!0?Object.keys(M):a;delete S.serializers,jo([S],Q,M,this._stdErrSerialize)}function T(B){this._childLevel=(B._childLevel|0)+1,this.error=an(B,S,"error"),this.fatal=an(B,S,"fatal"),this.warn=an(B,S,"warn"),this.info=an(B,S,"info"),this.debug=an(B,S,"debug"),this.trace=an(B,S,"trace"),M&&(this.serializers=M,this._serialize=Q),t&&(this._logEvent=Wc([].concat(B._logEvent.bindings,S)))}return T.prototype=this,new T(this)}return p}mr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};mr.stdSerializers=cb;mr.stdTimeFunctions=Object.assign({},{nullTime:Xf,epochTime:ep,unixTime:gb,isoTime:yb});function on(s,t,r,n){const a=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?ts:a[r]?a[r]:es[r]||es[n]||ts,hb(s,t,r)}function hb(s,t,r){!s.transmit&&t[r]===ts||(t[r]=function(n){return function(){const u=s.timestamp(),h=new Array(arguments.length),d=Object.getPrototypeOf&&Object.getPrototypeOf(this)===es?es:this;for(var p=0;p<h.length;p++)h[p]=arguments[p];if(s.serialize&&!s.asObject&&jo(h,this._serialize,this.serializers,this._stdErrSerialize),s.asObject?n.call(d,lb(this,r,h,u)):n.apply(d,h),s.transmit){const y=s.transmit.level||t.level,m=mr.levels.values[y],b=mr.levels.values[r];if(b<m)return;fb(this,{ts:u,methodLevel:r,methodValue:b,transmitLevel:y,transmitValue:mr.levels.values[s.transmit.level||t.level],send:s.transmit.send,val:t.levelVal},h)}}}(t[r]))}function lb(s,t,r,n){s._serialize&&jo(r,s._serialize,s.serializers,s._stdErrSerialize);const a=r.slice();let u=a[0];const h={};n&&(h.time=n),h.level=mr.levels.values[t];let d=(s._childLevel|0)+1;if(d<1&&(d=1),u!==null&&typeof u=="object"){for(;d--&&typeof a[0]=="object";)Object.assign(h,a.shift());u=a.length?Ll(a.shift(),a):void 0}else typeof u=="string"&&(u=Ll(a.shift(),a));return u!==void 0&&(h.msg=u),h}function jo(s,t,r,n){for(const a in s)if(n&&s[a]instanceof Error)s[a]=mr.stdSerializers.err(s[a]);else if(typeof s[a]=="object"&&!Array.isArray(s[a]))for(const u in s[a])t&&t.indexOf(u)>-1&&u in r&&(s[a][u]=r[u](s[a][u]))}function an(s,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var a=1;a<n.length;a++)n[a]=arguments[a-1];return s[r].apply(this,n)}}function fb(s,t,r){const n=t.send,a=t.ts,u=t.methodLevel,h=t.methodValue,d=t.val,p=s._logEvent.bindings;jo(r,s._serialize||Object.keys(s.serializers),s.serializers,s._stdErrSerialize===void 0?!0:s._stdErrSerialize),s._logEvent.ts=a,s._logEvent.messages=r.filter(function(y){return p.indexOf(y)===-1}),s._logEvent.level.label=u,s._logEvent.level.value=h,n(u,s._logEvent,d),s._logEvent=Wc(p)}function Wc(s){return{ts:0,messages:[],bindings:s||[],level:{label:"",value:0}}}function pb(s){const t={type:s.constructor.name,msg:s.message,stack:s.stack};for(const r in s)t[r]===void 0&&(t[r]=s[r]);return t}function db(s){return typeof s.timestamp=="function"?s.timestamp:s.timestamp===!1?Xf:ep}function _o(){return{}}function Fc(s){return s}function ts(){}function Xf(){return!1}function ep(){return Date.now()}function gb(){return Math.round(Date.now()/1e3)}function yb(){return new Date(Date.now()).toISOString()}function mb(){function s(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return s(self)||s(window)||s(this)||{}}}const Lo=hu(ab),vb={level:"info"},ss="custom_context";var wb=Object.defineProperty,bb=Object.defineProperties,_b=Object.getOwnPropertyDescriptors,Ul=Object.getOwnPropertySymbols,Eb=Object.prototype.hasOwnProperty,Ib=Object.prototype.propertyIsEnumerable,Ml=(s,t,r)=>t in s?wb(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Pb=(s,t)=>{for(var r in t||(t={}))Eb.call(t,r)&&Ml(s,r,t[r]);if(Ul)for(var r of Ul(t))Ib.call(t,r)&&Ml(s,r,t[r]);return s},xb=(s,t)=>bb(s,_b(t));function Uo(s){return xb(Pb({},s),{level:(s==null?void 0:s.level)||vb.level})}function Sb(s,t=ss){return s[t]||""}function Fb(s,t,r=ss){return s[r]=t,s}function It(s,t=ss){let r="";return typeof s.bindings>"u"?r=Sb(s,t):r=s.bindings().context||"",r}function Ab(s,t,r=ss){const n=It(s,r);return n.trim()?`${n}/${t}`:t}function Pt(s,t,r=ss){const n=Ab(s,t,r),a=s.child({context:n});return Fb(a,n,r)}class $b extends Fi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let Cb=class extends Fi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},Ob=class{constructor(t,r){this.logger=t,this.core=r}},Rb=class extends Fi{constructor(t,r){super(),this.relayer=t,this.logger=r}},Tb=class extends Fi{constructor(t){super()}},Nb=class{constructor(t,r,n,a){this.core=t,this.logger=r,this.name=n}};class Db extends Fi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let qb=class extends Fi{constructor(t,r){super(),this.core=t,this.logger=r}},zb=class{constructor(t,r){this.projectId=t,this.logger=r}},Bb=class{constructor(t,r){this.projectId=t,this.logger=r}},jb=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},Lb=class{constructor(t){this.client=t}};function Ub(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function tp(s,...t){if(!Ub(s))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(s.length))throw new Error("Uint8Array expected of length "+t+", got length="+s.length)}function kl(s,t=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(t&&s.finished)throw new Error("Hash#digest() has already been called")}function Mb(s,t){tp(s);const r=t.outputLen;if(s.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const cn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ac=s=>new DataView(s.buffer,s.byteOffset,s.byteLength);function kb(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function rp(s){return typeof s=="string"&&(s=kb(s)),tp(s),s}class Hb{clone(){return this._cloneInto()}}function Vb(s){const t=n=>s().update(rp(n)).digest(),r=s();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>s(),t}function ip(s=32){if(cn&&typeof cn.getRandomValues=="function")return cn.getRandomValues(new Uint8Array(s));if(cn&&typeof cn.randomBytes=="function")return cn.randomBytes(s);throw new Error("crypto.getRandomValues must be defined")}function Kb(s,t,r,n){if(typeof s.setBigUint64=="function")return s.setBigUint64(t,r,n);const a=BigInt(32),u=BigInt(4294967295),h=Number(r>>a&u),d=Number(r&u),p=n?4:0,y=n?0:4;s.setUint32(t+p,h,n),s.setUint32(t+y,d,n)}class Gb extends Hb{constructor(t,r,n,a){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ac(this.buffer)}update(t){kl(this);const{view:r,buffer:n,blockLen:a}=this;t=rp(t);const u=t.length;for(let h=0;h<u;){const d=Math.min(a-this.pos,u-h);if(d===a){const p=Ac(t);for(;a<=u-h;h+=a)this.process(p,h);continue}n.set(t.subarray(h,h+d),this.pos),this.pos+=d,h+=d,this.pos===a&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){kl(this),Mb(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:a,isLE:u}=this;let{pos:h}=this;r[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>a-h&&(this.process(n,0),h=0);for(let b=h;b<a;b++)r[b]=0;Kb(n,a-8,BigInt(this.length*8),u),this.process(n,0);const d=Ac(t),p=this.outputLen;if(p%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const y=p/4,m=this.get();if(y>m.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<y;b++)d.setUint32(4*b,m[b],u)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:a,finished:u,destroyed:h,pos:d}=this;return t.length=a,t.pos=d,t.finished=u,t.destroyed=h,a%r&&t.buffer.set(n),t}}const Eo=BigInt(2**32-1),Jc=BigInt(32);function np(s,t=!1){return t?{h:Number(s&Eo),l:Number(s>>Jc&Eo)}:{h:Number(s>>Jc&Eo)|0,l:Number(s&Eo)|0}}function Wb(s,t=!1){let r=new Uint32Array(s.length),n=new Uint32Array(s.length);for(let a=0;a<s.length;a++){const{h:u,l:h}=np(s[a],t);[r[a],n[a]]=[u,h]}return[r,n]}const Jb=(s,t)=>BigInt(s>>>0)<<Jc|BigInt(t>>>0),Qb=(s,t,r)=>s>>>r,Yb=(s,t,r)=>s<<32-r|t>>>r,Zb=(s,t,r)=>s>>>r|t<<32-r,Xb=(s,t,r)=>s<<32-r|t>>>r,e_=(s,t,r)=>s<<64-r|t>>>r-32,t_=(s,t,r)=>s>>>r-32|t<<64-r,r_=(s,t)=>t,i_=(s,t)=>s,n_=(s,t,r)=>s<<r|t>>>32-r,s_=(s,t,r)=>t<<r|s>>>32-r,o_=(s,t,r)=>t<<r-32|s>>>64-r,a_=(s,t,r)=>s<<r-32|t>>>64-r;function c_(s,t,r,n){const a=(t>>>0)+(n>>>0);return{h:s+r+(a/2**32|0)|0,l:a|0}}const u_=(s,t,r)=>(s>>>0)+(t>>>0)+(r>>>0),h_=(s,t,r,n)=>t+r+n+(s/2**32|0)|0,l_=(s,t,r,n)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0),f_=(s,t,r,n,a)=>t+r+n+a+(s/2**32|0)|0,p_=(s,t,r,n,a)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(a>>>0),d_=(s,t,r,n,a,u)=>t+r+n+a+u+(s/2**32|0)|0,ue={fromBig:np,split:Wb,toBig:Jb,shrSH:Qb,shrSL:Yb,rotrSH:Zb,rotrSL:Xb,rotrBH:e_,rotrBL:t_,rotr32H:r_,rotr32L:i_,rotlSH:n_,rotlSL:s_,rotlBH:o_,rotlBL:a_,add:c_,add3L:u_,add3H:h_,add4L:l_,add4H:f_,add5H:d_,add5L:p_},[g_,y_]=(()=>ue.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))))(),Xr=new Uint32Array(80),ei=new Uint32Array(80);class m_ extends Gb{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:r,Bh:n,Bl:a,Ch:u,Cl:h,Dh:d,Dl:p,Eh:y,El:m,Fh:b,Fl:x,Gh:A,Gl:S,Hh:D,Hl:k}=this;return[t,r,n,a,u,h,d,p,y,m,b,x,A,S,D,k]}set(t,r,n,a,u,h,d,p,y,m,b,x,A,S,D,k){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=a|0,this.Ch=u|0,this.Cl=h|0,this.Dh=d|0,this.Dl=p|0,this.Eh=y|0,this.El=m|0,this.Fh=b|0,this.Fl=x|0,this.Gh=A|0,this.Gl=S|0,this.Hh=D|0,this.Hl=k|0}process(t,r){for(let T=0;T<16;T++,r+=4)Xr[T]=t.getUint32(r),ei[T]=t.getUint32(r+=4);for(let T=16;T<80;T++){const B=Xr[T-15]|0,W=ei[T-15]|0,le=ue.rotrSH(B,W,1)^ue.rotrSH(B,W,8)^ue.shrSH(B,W,7),re=ue.rotrSL(B,W,1)^ue.rotrSL(B,W,8)^ue.shrSL(B,W,7),oe=Xr[T-2]|0,we=ei[T-2]|0,qt=ue.rotrSH(oe,we,19)^ue.rotrBH(oe,we,61)^ue.shrSH(oe,we,6),zt=ue.rotrSL(oe,we,19)^ue.rotrBL(oe,we,61)^ue.shrSL(oe,we,6),xt=ue.add4L(re,zt,ei[T-7],ei[T-16]),vr=ue.add4H(xt,le,qt,Xr[T-7],Xr[T-16]);Xr[T]=vr|0,ei[T]=xt|0}let{Ah:n,Al:a,Bh:u,Bl:h,Ch:d,Cl:p,Dh:y,Dl:m,Eh:b,El:x,Fh:A,Fl:S,Gh:D,Gl:k,Hh:M,Hl:Q}=this;for(let T=0;T<80;T++){const B=ue.rotrSH(b,x,14)^ue.rotrSH(b,x,18)^ue.rotrBH(b,x,41),W=ue.rotrSL(b,x,14)^ue.rotrSL(b,x,18)^ue.rotrBL(b,x,41),le=b&A^~b&D,re=x&S^~x&k,oe=ue.add5L(Q,W,re,y_[T],ei[T]),we=ue.add5H(oe,M,B,le,g_[T],Xr[T]),qt=oe|0,zt=ue.rotrSH(n,a,28)^ue.rotrBH(n,a,34)^ue.rotrBH(n,a,39),xt=ue.rotrSL(n,a,28)^ue.rotrBL(n,a,34)^ue.rotrBL(n,a,39),vr=n&u^n&d^u&d,jr=a&h^a&p^h&p;M=D|0,Q=k|0,D=A|0,k=S|0,A=b|0,S=x|0,{h:b,l:x}=ue.add(y|0,m|0,we|0,qt|0),y=d|0,m=p|0,d=u|0,p=h|0,u=n|0,h=a|0;const ee=ue.add3L(qt,xt,jr);n=ue.add3H(ee,we,zt,vr),a=ee|0}({h:n,l:a}=ue.add(this.Ah|0,this.Al|0,n|0,a|0)),{h:u,l:h}=ue.add(this.Bh|0,this.Bl|0,u|0,h|0),{h:d,l:p}=ue.add(this.Ch|0,this.Cl|0,d|0,p|0),{h:y,l:m}=ue.add(this.Dh|0,this.Dl|0,y|0,m|0),{h:b,l:x}=ue.add(this.Eh|0,this.El|0,b|0,x|0),{h:A,l:S}=ue.add(this.Fh|0,this.Fl|0,A|0,S|0),{h:D,l:k}=ue.add(this.Gh|0,this.Gl|0,D|0,k|0),{h:M,l:Q}=ue.add(this.Hh|0,this.Hl|0,M|0,Q|0),this.set(n,a,u,h,d,p,y,m,b,x,A,S,D,k,M,Q)}roundClean(){Xr.fill(0),ei.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const v_=Vb(()=>new m_);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const lu=BigInt(0),sp=BigInt(1),w_=BigInt(2);function fu(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function pu(s){if(!fu(s))throw new Error("Uint8Array expected")}function $c(s,t){if(typeof t!="boolean")throw new Error(s+" boolean expected, got "+t)}const b_=Array.from({length:256},(s,t)=>t.toString(16).padStart(2,"0"));function du(s){pu(s);let t="";for(let r=0;r<s.length;r++)t+=b_[s[r]];return t}function op(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?lu:BigInt("0x"+s)}const Nr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Hl(s){if(s>=Nr._0&&s<=Nr._9)return s-Nr._0;if(s>=Nr.A&&s<=Nr.F)return s-(Nr.A-10);if(s>=Nr.a&&s<=Nr.f)return s-(Nr.a-10)}function ap(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);const t=s.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let a=0,u=0;a<r;a++,u+=2){const h=Hl(s.charCodeAt(u)),d=Hl(s.charCodeAt(u+1));if(h===void 0||d===void 0){const p=s[u]+s[u+1];throw new Error('hex string expected, got non-hex character "'+p+'" at index '+u)}n[a]=h*16+d}return n}function __(s){return op(du(s))}function Ro(s){return pu(s),op(du(Uint8Array.from(s).reverse()))}function cp(s,t){return ap(s.toString(16).padStart(t*2,"0"))}function Qc(s,t){return cp(s,t).reverse()}function Dr(s,t,r){let n;if(typeof t=="string")try{n=ap(t)}catch(u){throw new Error(s+" must be hex string or Uint8Array, cause: "+u)}else if(fu(t))n=Uint8Array.from(t);else throw new Error(s+" must be hex string or Uint8Array");const a=n.length;if(typeof r=="number"&&a!==r)throw new Error(s+" of length "+r+" expected, got "+a);return n}function Vl(...s){let t=0;for(let n=0;n<s.length;n++){const a=s[n];pu(a),t+=a.length}const r=new Uint8Array(t);for(let n=0,a=0;n<s.length;n++){const u=s[n];r.set(u,a),a+=u.length}return r}const Cc=s=>typeof s=="bigint"&&lu<=s;function E_(s,t,r){return Cc(s)&&Cc(t)&&Cc(r)&&t<=s&&s<r}function Hn(s,t,r,n){if(!E_(t,r,n))throw new Error("expected valid "+s+": "+r+" <= n < "+n+", got "+t)}function I_(s){let t;for(t=0;s>lu;s>>=sp,t+=1);return t}const P_=s=>(w_<<BigInt(s-1))-sp,x_={bigint:s=>typeof s=="bigint",function:s=>typeof s=="function",boolean:s=>typeof s=="boolean",string:s=>typeof s=="string",stringOrUint8Array:s=>typeof s=="string"||fu(s),isSafeInteger:s=>Number.isSafeInteger(s),array:s=>Array.isArray(s),field:(s,t)=>t.Fp.isValid(s),hash:s=>typeof s=="function"&&Number.isSafeInteger(s.outputLen)};function gu(s,t,r={}){const n=(a,u,h)=>{const d=x_[u];if(typeof d!="function")throw new Error("invalid validator function");const p=s[a];if(!(h&&p===void 0)&&!d(p,s))throw new Error("param "+String(a)+" is invalid. Expected "+u+", got "+p)};for(const[a,u]of Object.entries(t))n(a,u,!1);for(const[a,u]of Object.entries(r))n(a,u,!0);return s}function Kl(s){const t=new WeakMap;return(r,...n)=>{const a=t.get(r);if(a!==void 0)return a;const u=s(r,...n);return t.set(r,u),u}}const Ze=BigInt(0),Me=BigInt(1),Pi=BigInt(2),S_=BigInt(3),Yc=BigInt(4),Gl=BigInt(5),Wl=BigInt(8);function We(s,t){const r=s%t;return r>=Ze?r:t+r}function F_(s,t,r){if(t<Ze)throw new Error("invalid exponent, negatives unsupported");if(r<=Ze)throw new Error("invalid modulus");if(r===Me)return Ze;let n=Me;for(;t>Ze;)t&Me&&(n=n*s%r),s=s*s%r,t>>=Me;return n}function gr(s,t,r){let n=s;for(;t-- >Ze;)n*=n,n%=r;return n}function Jl(s,t){if(s===Ze)throw new Error("invert: expected non-zero number");if(t<=Ze)throw new Error("invert: expected positive modulus, got "+t);let r=We(s,t),n=t,a=Ze,u=Me;for(;r!==Ze;){const h=n/r,d=n%r,p=a-u*h;n=r,r=d,a=u,u=p}if(n!==Me)throw new Error("invert: does not exist");return We(a,t)}function A_(s){const t=(s-Me)/Pi;let r,n,a;for(r=s-Me,n=0;r%Pi===Ze;r/=Pi,n++);for(a=Pi;a<s&&F_(a,t,s)!==s-Me;a++)if(a>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const h=(s+Me)/Yc;return function(d,p){const y=d.pow(p,h);if(!d.eql(d.sqr(y),p))throw new Error("Cannot find square root");return y}}const u=(r+Me)/Pi;return function(h,d){if(h.pow(d,t)===h.neg(h.ONE))throw new Error("Cannot find square root");let p=n,y=h.pow(h.mul(h.ONE,a),r),m=h.pow(d,u),b=h.pow(d,r);for(;!h.eql(b,h.ONE);){if(h.eql(b,h.ZERO))return h.ZERO;let x=1;for(let S=h.sqr(b);x<p&&!h.eql(S,h.ONE);x++)S=h.sqr(S);const A=h.pow(y,Me<<BigInt(p-x-1));y=h.sqr(A),m=h.mul(m,A),b=h.mul(b,y),p=x}return m}}function $_(s){if(s%Yc===S_){const t=(s+Me)/Yc;return function(r,n){const a=r.pow(n,t);if(!r.eql(r.sqr(a),n))throw new Error("Cannot find square root");return a}}if(s%Wl===Gl){const t=(s-Gl)/Wl;return function(r,n){const a=r.mul(n,Pi),u=r.pow(a,t),h=r.mul(n,u),d=r.mul(r.mul(h,Pi),u),p=r.mul(h,r.sub(d,r.ONE));if(!r.eql(r.sqr(p),n))throw new Error("Cannot find square root");return p}}return A_(s)}const C_=(s,t)=>(We(s,t)&Me)===Me,O_=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function R_(s){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=O_.reduce((n,a)=>(n[a]="function",n),t);return gu(s,r)}function T_(s,t,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return s.ONE;if(r===Me)return t;let n=s.ONE,a=t;for(;r>Ze;)r&Me&&(n=s.mul(n,a)),a=s.sqr(a),r>>=Me;return n}function N_(s,t){const r=new Array(t.length),n=t.reduce((u,h,d)=>s.is0(h)?u:(r[d]=u,s.mul(u,h)),s.ONE),a=s.inv(n);return t.reduceRight((u,h,d)=>s.is0(h)?u:(r[d]=s.mul(u,r[d]),s.mul(u,h)),a),r}function up(s,t){const r=t!==void 0?t:s.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function hp(s,t,r=!1,n={}){if(s<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+s);const{nBitLength:a,nByteLength:u}=up(s,t);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const d=Object.freeze({ORDER:s,isLE:r,BITS:a,BYTES:u,MASK:P_(a),ZERO:Ze,ONE:Me,create:p=>We(p,s),isValid:p=>{if(typeof p!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof p);return Ze<=p&&p<s},is0:p=>p===Ze,isOdd:p=>(p&Me)===Me,neg:p=>We(-p,s),eql:(p,y)=>p===y,sqr:p=>We(p*p,s),add:(p,y)=>We(p+y,s),sub:(p,y)=>We(p-y,s),mul:(p,y)=>We(p*y,s),pow:(p,y)=>T_(d,p,y),div:(p,y)=>We(p*Jl(y,s),s),sqrN:p=>p*p,addN:(p,y)=>p+y,subN:(p,y)=>p-y,mulN:(p,y)=>p*y,inv:p=>Jl(p,s),sqrt:n.sqrt||(p=>(h||(h=$_(s)),h(d,p))),invertBatch:p=>N_(d,p),cmov:(p,y,m)=>m?y:p,toBytes:p=>r?Qc(p,u):cp(p,u),fromBytes:p=>{if(p.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+p.length);return r?Ro(p):__(p)}});return Object.freeze(d)}const Ql=BigInt(0),Io=BigInt(1);function Oc(s,t){const r=t.negate();return s?r:t}function lp(s,t){if(!Number.isSafeInteger(s)||s<=0||s>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+s)}function Rc(s,t){lp(s,t);const r=Math.ceil(t/s)+1,n=2**(s-1);return{windows:r,windowSize:n}}function D_(s,t){if(!Array.isArray(s))throw new Error("array expected");s.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function q_(s,t){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}const Tc=new WeakMap,fp=new WeakMap;function Nc(s){return fp.get(s)||1}function z_(s,t){return{constTimeNegate:Oc,hasPrecomputes(r){return Nc(r)!==1},unsafeLadder(r,n,a=s.ZERO){let u=r;for(;n>Ql;)n&Io&&(a=a.add(u)),u=u.double(),n>>=Io;return a},precomputeWindow(r,n){const{windows:a,windowSize:u}=Rc(n,t),h=[];let d=r,p=d;for(let y=0;y<a;y++){p=d,h.push(p);for(let m=1;m<u;m++)p=p.add(d),h.push(p);d=p.double()}return h},wNAF(r,n,a){const{windows:u,windowSize:h}=Rc(r,t);let d=s.ZERO,p=s.BASE;const y=BigInt(2**r-1),m=2**r,b=BigInt(r);for(let x=0;x<u;x++){const A=x*h;let S=Number(a&y);a>>=b,S>h&&(S-=m,a+=Io);const D=A,k=A+Math.abs(S)-1,M=x%2!==0,Q=S<0;S===0?p=p.add(Oc(M,n[D])):d=d.add(Oc(Q,n[k]))}return{p:d,f:p}},wNAFUnsafe(r,n,a,u=s.ZERO){const{windows:h,windowSize:d}=Rc(r,t),p=BigInt(2**r-1),y=2**r,m=BigInt(r);for(let b=0;b<h;b++){const x=b*d;if(a===Ql)break;let A=Number(a&p);if(a>>=m,A>d&&(A-=y,a+=Io),A===0)continue;let S=n[x+Math.abs(A)-1];A<0&&(S=S.negate()),u=u.add(S)}return u},getPrecomputes(r,n,a){let u=Tc.get(n);return u||(u=this.precomputeWindow(n,r),r!==1&&Tc.set(n,a(u))),u},wNAFCached(r,n,a){const u=Nc(r);return this.wNAF(u,this.getPrecomputes(u,r,a),n)},wNAFCachedUnsafe(r,n,a,u){const h=Nc(r);return h===1?this.unsafeLadder(r,n,u):this.wNAFUnsafe(h,this.getPrecomputes(h,r,a),n,u)},setWindowSize(r,n){lp(n,t),fp.set(r,n),Tc.delete(r)}}}function B_(s,t,r,n){if(D_(r,s),q_(n,t),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const a=s.ZERO,u=I_(BigInt(r.length)),h=u>12?u-3:u>4?u-2:u?2:1,d=(1<<h)-1,p=new Array(d+1).fill(a),y=Math.floor((t.BITS-1)/h)*h;let m=a;for(let b=y;b>=0;b-=h){p.fill(a);for(let A=0;A<n.length;A++){const S=n[A],D=Number(S>>BigInt(b)&BigInt(d));p[D]=p[D].add(r[A])}let x=a;for(let A=p.length-1,S=a;A>0;A--)S=S.add(p[A]),x=x.add(S);if(m=m.add(x),b!==0)for(let A=0;A<h;A++)m=m.double()}return m}function j_(s){return R_(s.Fp),gu(s,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...up(s.n,s.nBitLength),...s,p:s.Fp.ORDER})}const ir=BigInt(0),wt=BigInt(1),Po=BigInt(2),L_=BigInt(8),U_={zip215:!0};function M_(s){const t=j_(s);return gu(s,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function k_(s){const t=M_(s),{Fp:r,n,prehash:a,hash:u,randomBytes:h,nByteLength:d,h:p}=t,y=Po<<BigInt(d*8)-wt,m=r.create,b=hp(t.n,t.nBitLength),x=t.uvRatio||((ee,q)=>{try{return{isValid:!0,value:r.sqrt(ee*r.inv(q))}}catch{return{isValid:!1,value:ir}}}),A=t.adjustScalarBytes||(ee=>ee),S=t.domain||((ee,q,V)=>{if($c("phflag",V),q.length||V)throw new Error("Contexts/pre-hash are not supported");return ee});function D(ee,q){Hn("coordinate "+ee,q,ir,y)}function k(ee){if(!(ee instanceof T))throw new Error("ExtendedPoint expected")}const M=Kl((ee,q)=>{const{ex:V,ey:K,ez:de}=ee,fe=ee.is0();q==null&&(q=fe?L_:r.inv(de));const ae=m(V*q),Ae=m(K*q),be=m(de*q);if(fe)return{x:ir,y:wt};if(be!==wt)throw new Error("invZ was invalid");return{x:ae,y:Ae}}),Q=Kl(ee=>{const{a:q,d:V}=t;if(ee.is0())throw new Error("bad point: ZERO");const{ex:K,ey:de,ez:fe,et:ae}=ee,Ae=m(K*K),be=m(de*de),$e=m(fe*fe),Y=m($e*$e),qe=m(Ae*q),St=m($e*m(qe+be)),Ce=m(Y+m(V*m(Ae*be)));if(St!==Ce)throw new Error("bad point: equation left != right (1)");const Be=m(K*de),Ft=m(fe*ae);if(Be!==Ft)throw new Error("bad point: equation left != right (2)");return!0});class T{constructor(q,V,K,de){this.ex=q,this.ey=V,this.ez=K,this.et=de,D("x",q),D("y",V),D("z",K),D("t",de),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(q){if(q instanceof T)throw new Error("extended point not allowed");const{x:V,y:K}=q||{};return D("x",V),D("y",K),new T(V,K,wt,m(V*K))}static normalizeZ(q){const V=r.invertBatch(q.map(K=>K.ez));return q.map((K,de)=>K.toAffine(V[de])).map(T.fromAffine)}static msm(q,V){return B_(T,b,q,V)}_setWindowSize(q){le.setWindowSize(this,q)}assertValidity(){Q(this)}equals(q){k(q);const{ex:V,ey:K,ez:de}=this,{ex:fe,ey:ae,ez:Ae}=q,be=m(V*Ae),$e=m(fe*de),Y=m(K*Ae),qe=m(ae*de);return be===$e&&Y===qe}is0(){return this.equals(T.ZERO)}negate(){return new T(m(-this.ex),this.ey,this.ez,m(-this.et))}double(){const{a:q}=t,{ex:V,ey:K,ez:de}=this,fe=m(V*V),ae=m(K*K),Ae=m(Po*m(de*de)),be=m(q*fe),$e=V+K,Y=m(m($e*$e)-fe-ae),qe=be+ae,St=qe-Ae,Ce=be-ae,Be=m(Y*St),Ft=m(qe*Ce),ut=m(Y*Ce),At=m(St*qe);return new T(Be,Ft,At,ut)}add(q){k(q);const{a:V,d:K}=t,{ex:de,ey:fe,ez:ae,et:Ae}=this,{ex:be,ey:$e,ez:Y,et:qe}=q;if(V===BigInt(-1)){const Ci=m((fe-de)*($e+be)),ar=m((fe+de)*($e-be)),et=m(ar-Ci);if(et===ir)return this.double();const cr=m(ae*Po*qe),br=m(Ae*Po*Y),Oi=br+cr,ur=ar+Ci,Ri=br-cr,Bt=m(Oi*et),jt=m(ur*Ri),Ur=m(Oi*Ri),nt=m(et*ur);return new T(Bt,jt,nt,Ur)}const St=m(de*be),Ce=m(fe*$e),Be=m(Ae*K*qe),Ft=m(ae*Y),ut=m((de+fe)*(be+$e)-St-Ce),At=Ft-Be,Lr=Ft+Be,Xe=m(Ce-V*St),wr=m(ut*At),gn=m(Lr*Xe),$t=m(ut*Xe),$i=m(At*Lr);return new T(wr,gn,$i,$t)}subtract(q){return this.add(q.negate())}wNAF(q){return le.wNAFCached(this,q,T.normalizeZ)}multiply(q){const V=q;Hn("scalar",V,wt,n);const{p:K,f:de}=this.wNAF(V);return T.normalizeZ([K,de])[0]}multiplyUnsafe(q,V=T.ZERO){const K=q;return Hn("scalar",K,ir,n),K===ir?W:this.is0()||K===wt?this:le.wNAFCachedUnsafe(this,K,T.normalizeZ,V)}isSmallOrder(){return this.multiplyUnsafe(p).is0()}isTorsionFree(){return le.unsafeLadder(this,n).is0()}toAffine(q){return M(this,q)}clearCofactor(){const{h:q}=t;return q===wt?this:this.multiplyUnsafe(q)}static fromHex(q,V=!1){const{d:K,a:de}=t,fe=r.BYTES;q=Dr("pointHex",q,fe),$c("zip215",V);const ae=q.slice(),Ae=q[fe-1];ae[fe-1]=Ae&-129;const be=Ro(ae),$e=V?y:r.ORDER;Hn("pointHex.y",be,ir,$e);const Y=m(be*be),qe=m(Y-wt),St=m(K*Y-de);let{isValid:Ce,value:Be}=x(qe,St);if(!Ce)throw new Error("Point.fromHex: invalid y coordinate");const Ft=(Be&wt)===wt,ut=(Ae&128)!==0;if(!V&&Be===ir&&ut)throw new Error("Point.fromHex: x=0 and x_0=1");return ut!==Ft&&(Be=m(-Be)),T.fromAffine({x:Be,y:be})}static fromPrivateKey(q){return we(q).point}toRawBytes(){const{x:q,y:V}=this.toAffine(),K=Qc(V,r.BYTES);return K[K.length-1]|=q&wt?128:0,K}toHex(){return du(this.toRawBytes())}}T.BASE=new T(t.Gx,t.Gy,wt,m(t.Gx*t.Gy)),T.ZERO=new T(ir,wt,wt,ir);const{BASE:B,ZERO:W}=T,le=z_(T,d*8);function re(ee){return We(ee,n)}function oe(ee){return re(Ro(ee))}function we(ee){const q=r.BYTES;ee=Dr("private key",ee,q);const V=Dr("hashed private key",u(ee),2*q),K=A(V.slice(0,q)),de=V.slice(q,2*q),fe=oe(K),ae=B.multiply(fe),Ae=ae.toRawBytes();return{head:K,prefix:de,scalar:fe,point:ae,pointBytes:Ae}}function qt(ee){return we(ee).pointBytes}function zt(ee=new Uint8Array,...q){const V=Vl(...q);return oe(u(S(V,Dr("context",ee),!!a)))}function xt(ee,q,V={}){ee=Dr("message",ee),a&&(ee=a(ee));const{prefix:K,scalar:de,pointBytes:fe}=we(q),ae=zt(V.context,K,ee),Ae=B.multiply(ae).toRawBytes(),be=zt(V.context,Ae,fe,ee),$e=re(ae+be*de);Hn("signature.s",$e,ir,n);const Y=Vl(Ae,Qc($e,r.BYTES));return Dr("result",Y,r.BYTES*2)}const vr=U_;function jr(ee,q,V,K=vr){const{context:de,zip215:fe}=K,ae=r.BYTES;ee=Dr("signature",ee,2*ae),q=Dr("message",q),V=Dr("publicKey",V,ae),fe!==void 0&&$c("zip215",fe),a&&(q=a(q));const Ae=Ro(ee.slice(ae,2*ae));let be,$e,Y;try{be=T.fromHex(V,fe),$e=T.fromHex(ee.slice(0,ae),fe),Y=B.multiplyUnsafe(Ae)}catch{return!1}if(!fe&&be.isSmallOrder())return!1;const qe=zt(de,$e.toRawBytes(),be.toRawBytes(),q);return $e.add(be.multiplyUnsafe(qe)).subtract(Y).clearCofactor().equals(T.ZERO)}return B._setWindowSize(8),{CURVE:t,getPublicKey:qt,sign:xt,verify:jr,ExtendedPoint:T,utils:{getExtendedPublicKey:we,randomPrivateKey:()=>h(r.BYTES),precompute(ee=8,q=T.BASE){return q._setWindowSize(ee),q.multiply(BigInt(3)),q}}}}BigInt(0),BigInt(1);const yu=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Yl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const H_=BigInt(1),Zl=BigInt(2);BigInt(3);const V_=BigInt(5),K_=BigInt(8);function G_(s){const t=BigInt(10),r=BigInt(20),n=BigInt(40),a=BigInt(80),u=yu,h=s*s%u*s%u,d=gr(h,Zl,u)*h%u,p=gr(d,H_,u)*s%u,y=gr(p,V_,u)*p%u,m=gr(y,t,u)*y%u,b=gr(m,r,u)*m%u,x=gr(b,n,u)*b%u,A=gr(x,a,u)*x%u,S=gr(A,a,u)*x%u,D=gr(S,t,u)*y%u;return{pow_p_5_8:gr(D,Zl,u)*s%u,b2:h}}function W_(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}function J_(s,t){const r=yu,n=We(t*t*t,r),a=We(n*n*t,r),u=G_(s*a).pow_p_5_8;let h=We(s*n*u,r);const d=We(t*h*h,r),p=h,y=We(h*Yl,r),m=d===s,b=d===We(-s,r),x=d===We(-s*Yl,r);return m&&(h=p),(b||x)&&(h=y),C_(h,r)&&(h=We(-h,r)),{isValid:m||b,value:h}}const Q_=(()=>hp(yu,void 0,!0))(),Y_=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Q_,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:K_,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:v_,randomBytes:ip,adjustScalarBytes:W_,uvRatio:J_}))(),pp=(()=>k_(Y_))(),Z_="EdDSA",X_="JWT",dp=".",gp="base64url",eE="utf8",tE="utf8",rE=":",iE="did",nE="key",Xl="base58btc",sE="z",oE="K36",aE=32;function mu(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function yp(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?mu(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function mp(s,t){t||(t=s.reduce((a,u)=>a+u.length,0));const r=yp(t);let n=0;for(const a of s)r.set(a,n),n+=a.length;return mu(r)}function cE(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var a=0;a<s.length;a++){var u=s.charAt(a),h=u.charCodeAt(0);if(r[h]!==255)throw new TypeError(u+" is ambiguous");r[h]=a}var d=s.length,p=s.charAt(0),y=Math.log(d)/Math.log(256),m=Math.log(256)/Math.log(d);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,k=0,M=0,Q=S.length;M!==Q&&S[M]===0;)M++,D++;for(var T=(Q-M)*m+1>>>0,B=new Uint8Array(T);M!==Q;){for(var W=S[M],le=0,re=T-1;(W!==0||le<k)&&re!==-1;re--,le++)W+=256*B[re]>>>0,B[re]=W%d>>>0,W=W/d>>>0;if(W!==0)throw new Error("Non-zero carry");k=le,M++}for(var oe=T-k;oe!==T&&B[oe]===0;)oe++;for(var we=p.repeat(D);oe<T;++oe)we+=s.charAt(B[oe]);return we}function x(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var k=0,M=0;S[D]===p;)k++,D++;for(var Q=(S.length-D)*y+1>>>0,T=new Uint8Array(Q);S[D];){var B=r[S.charCodeAt(D)];if(B===255)return;for(var W=0,le=Q-1;(B!==0||W<M)&&le!==-1;le--,W++)B+=d*T[le]>>>0,T[le]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");M=W,D++}if(S[D]!==" "){for(var re=Q-M;re!==Q&&T[re]===0;)re++;for(var oe=new Uint8Array(k+(Q-re)),we=k;re!==Q;)oe[we++]=T[re++];return oe}}}function A(S){var D=x(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:x,decode:A}}var uE=cE,hE=uE;const vp=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},lE=s=>new TextEncoder().encode(s),fE=s=>new TextDecoder().decode(s);let pE=class{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},dE=class{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return wp(this,t)}};class gE{constructor(t){this.decoders=t}or(t){return wp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const wp=(s,t)=>new gE({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});let yE=class{constructor(t,r,n,a){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=a,this.encoder=new pE(t,r,n),this.decoder=new dE(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const Mo=({name:s,prefix:t,encode:r,decode:n})=>new yE(s,t,r,n),os=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:a}=hE(r,t);return Mo({prefix:s,name:t,encode:n,decode:u=>vp(a(u))})},mE=(s,t,r,n)=>{const a={};for(let m=0;m<t.length;++m)a[t[m]]=m;let u=s.length;for(;s[u-1]==="=";)--u;const h=new Uint8Array(u*r/8|0);let d=0,p=0,y=0;for(let m=0;m<u;++m){const b=a[s[m]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);p=p<<r|b,d+=r,d>=8&&(d-=8,h[y++]=255&p>>d)}if(d>=r||255&p<<8-d)throw new SyntaxError("Unexpected end of data");return h},vE=(s,t,r)=>{const n=t[t.length-1]==="=",a=(1<<r)-1;let u="",h=0,d=0;for(let p=0;p<s.length;++p)for(d=d<<8|s[p],h+=8;h>r;)h-=r,u+=t[a&d>>h];if(h&&(u+=t[a&d<<r-h]),n)for(;u.length*r&7;)u+="=";return u},rt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Mo({prefix:t,name:s,encode(a){return vE(a,n,r)},decode(a){return mE(a,n,r,s)}}),wE=Mo({prefix:"\0",name:"identity",encode:s=>fE(s),decode:s=>lE(s)});var bE=Object.freeze({__proto__:null,identity:wE});const _E=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var EE=Object.freeze({__proto__:null,base2:_E});const IE=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var PE=Object.freeze({__proto__:null,base8:IE});const xE=os({prefix:"9",name:"base10",alphabet:"0123456789"});var SE=Object.freeze({__proto__:null,base10:xE});const FE=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),AE=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var $E=Object.freeze({__proto__:null,base16:FE,base16upper:AE});const CE=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),OE=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),RE=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),TE=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),NE=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),DE=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qE=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zE=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),BE=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jE=Object.freeze({__proto__:null,base32:CE,base32upper:OE,base32pad:RE,base32padupper:TE,base32hex:NE,base32hexupper:DE,base32hexpad:qE,base32hexpadupper:zE,base32z:BE});const LE=os({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),UE=os({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ME=Object.freeze({__proto__:null,base36:LE,base36upper:UE});const kE=os({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),HE=os({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var VE=Object.freeze({__proto__:null,base58btc:kE,base58flickr:HE});const KE=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),GE=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),WE=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),JE=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var QE=Object.freeze({__proto__:null,base64:KE,base64pad:GE,base64url:WE,base64urlpad:JE});const bp=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),YE=bp.reduce((s,t,r)=>(s[r]=t,s),[]),ZE=bp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function XE(s){return s.reduce((t,r)=>(t+=YE[r],t),"")}function eI(s){const t=[];for(const r of s){const n=ZE[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const tI=Mo({prefix:"🚀",name:"base256emoji",encode:XE,decode:eI});var rI=Object.freeze({__proto__:null,base256emoji:tI}),iI=_p,ef=128,nI=127,sI=~nI,oI=Math.pow(2,31);function _p(s,t,r){t=t||[],r=r||0;for(var n=r;s>=oI;)t[r++]=s&255|ef,s/=128;for(;s&sI;)t[r++]=s&255|ef,s>>>=7;return t[r]=s|0,_p.bytes=r-n+1,t}var aI=Zc,cI=128,tf=127;function Zc(s,n){var r=0,n=n||0,a=0,u=n,h,d=s.length;do{if(u>=d)throw Zc.bytes=0,new RangeError("Could not decode varint");h=s[u++],r+=a<28?(h&tf)<<a:(h&tf)*Math.pow(2,a),a+=7}while(h>=cI);return Zc.bytes=u-n,r}var uI=Math.pow(2,7),hI=Math.pow(2,14),lI=Math.pow(2,21),fI=Math.pow(2,28),pI=Math.pow(2,35),dI=Math.pow(2,42),gI=Math.pow(2,49),yI=Math.pow(2,56),mI=Math.pow(2,63),vI=function(s){return s<uI?1:s<hI?2:s<lI?3:s<fI?4:s<pI?5:s<dI?6:s<gI?7:s<yI?8:s<mI?9:10},wI={encode:iI,decode:aI,encodingLength:vI},Ep=wI;const rf=(s,t,r=0)=>(Ep.encode(s,t,r),t),nf=s=>Ep.encodingLength(s),Xc=(s,t)=>{const r=t.byteLength,n=nf(s),a=n+nf(r),u=new Uint8Array(a+r);return rf(s,u,0),rf(r,u,n),u.set(t,a),new bI(s,r,t,u)};class bI{constructor(t,r,n,a){this.code=t,this.size=r,this.digest=n,this.bytes=a}}const Ip=({name:s,code:t,encode:r})=>new _I(s,t,r);class _I{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Xc(this.code,r):r.then(n=>Xc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Pp=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),EI=Ip({name:"sha2-256",code:18,encode:Pp("SHA-256")}),II=Ip({name:"sha2-512",code:19,encode:Pp("SHA-512")});var PI=Object.freeze({__proto__:null,sha256:EI,sha512:II});const xp=0,xI="identity",Sp=vp,SI=s=>Xc(xp,Sp(s)),FI={code:xp,name:xI,encode:Sp,digest:SI};var AI=Object.freeze({__proto__:null,identity:FI});new TextEncoder,new TextDecoder;const sf={...bE,...EE,...PE,...SE,...$E,...jE,...ME,...VE,...QE,...rI};({...PI,...AI});function Fp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const of=Fp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),Dc=Fp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=yp(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Ap={utf8:of,"utf-8":of,hex:sf.base16,latin1:Dc,ascii:Dc,binary:Dc,...sf};function vu(s,t="utf8"){const r=Ap[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("utf8"):r.encoder.encode(s).substring(1)}function wu(s,t="utf8"){const r=Ap[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?mu(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}function To(s){return vu(wu(rs(s),eE),gp)}function $p(s){const t=wu(oE,Xl),r=sE+vu(mp([t,s]),Xl);return[iE,nE,r].join(rE)}function $I(s){return vu(s,gp)}function CI(s){return wu([To(s.header),To(s.payload)].join(dp),tE)}function OI(s){return[To(s.header),To(s.payload),$I(s.signature)].join(dp)}function af(s=ip(aE)){const t=pp.getPublicKey(s);return{secretKey:mp([s,t]),publicKey:t}}async function RI(s,t,r,n,a=G.fromMiliseconds(Date.now())){const u={alg:Z_,typ:X_},h=$p(n.publicKey),d=a+r,p={iss:h,sub:s,aud:t,iat:a,exp:d},y=CI({header:u,payload:p}),m=pp.sign(y,n.secretKey.slice(0,32));return OI({header:u,payload:p,signature:m})}let TI=class extends Wf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||ou().toString()),r)}async requestStrict(t,r){return new Promise(async(n,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{or(u)?a(u.error):n(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),is(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const NI=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),DI=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",cf=s=>s.split("?")[0],uf=10,qI=NI();let zI=class{constructor(t){if(this.url=t,this.events=new Qt.EventEmitter,this.registering=!1,!Cl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(rs(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Cl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const a=new URLSearchParams(t).get("origin"),u=gw.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!yw(t)},h=new qI(t,[],u);DI()?h.onerror=d=>{const p=d;n(this.emitError(p.error))}:h.on("error",d=>{n(this.emitError(d))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?zo(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),a=n.message||n.toString(),u=au(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return mw(t,cf(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>uf&&this.events.setMaxListeners(uf)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${cf(this.url)}`));return this.events.emit("register_error",r),r}};var No={exports:{}};No.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",a=1,u=2,h=9007199254740991,d="[object Arguments]",p="[object Array]",y="[object AsyncFunction]",m="[object Boolean]",b="[object Date]",x="[object Error]",A="[object Function]",S="[object GeneratorFunction]",D="[object Map]",k="[object Number]",M="[object Null]",Q="[object Object]",T="[object Promise]",B="[object Proxy]",W="[object RegExp]",le="[object Set]",re="[object String]",oe="[object Symbol]",we="[object Undefined]",qt="[object WeakMap]",zt="[object ArrayBuffer]",xt="[object DataView]",vr="[object Float32Array]",jr="[object Float64Array]",ee="[object Int8Array]",q="[object Int16Array]",V="[object Int32Array]",K="[object Uint8Array]",de="[object Uint8ClampedArray]",fe="[object Uint16Array]",ae="[object Uint32Array]",Ae=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,$e=/^(?:0|[1-9]\d*)$/,Y={};Y[vr]=Y[jr]=Y[ee]=Y[q]=Y[V]=Y[K]=Y[de]=Y[fe]=Y[ae]=!0,Y[d]=Y[p]=Y[zt]=Y[m]=Y[xt]=Y[b]=Y[x]=Y[A]=Y[D]=Y[k]=Y[Q]=Y[W]=Y[le]=Y[re]=Y[qt]=!1;var qe=typeof vo=="object"&&vo&&vo.Object===Object&&vo,St=typeof self=="object"&&self&&self.Object===Object&&self,Ce=qe||St||Function("return this")(),Be=t&&!t.nodeType&&t,Ft=Be&&!0&&s&&!s.nodeType&&s,ut=Ft&&Ft.exports===Be,At=ut&&qe.process,Lr=function(){try{return At&&At.binding&&At.binding("util")}catch{}}(),Xe=Lr&&Lr.isTypedArray;function wr(v,E){for(var R=-1,j=v==null?0:v.length,xe=0,ie=[];++R<j;){var Oe=v[R];E(Oe,R,v)&&(ie[xe++]=Oe)}return ie}function gn(v,E){for(var R=-1,j=E.length,xe=v.length;++R<j;)v[xe+R]=E[R];return v}function $t(v,E){for(var R=-1,j=v==null?0:v.length;++R<j;)if(E(v[R],R,v))return!0;return!1}function $i(v,E){for(var R=-1,j=Array(v);++R<v;)j[R]=E(R);return j}function Ci(v){return function(E){return v(E)}}function ar(v,E){return v.has(E)}function et(v,E){return v==null?void 0:v[E]}function cr(v){var E=-1,R=Array(v.size);return v.forEach(function(j,xe){R[++E]=[xe,j]}),R}function br(v,E){return function(R){return v(E(R))}}function Oi(v){var E=-1,R=Array(v.size);return v.forEach(function(j){R[++E]=j}),R}var ur=Array.prototype,Ri=Function.prototype,Bt=Object.prototype,jt=Ce["__core-js_shared__"],Ur=Ri.toString,nt=Bt.hasOwnProperty,Ti=function(){var v=/[^.]+$/.exec(jt&&jt.keys&&jt.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Ni=Bt.toString,yn=RegExp("^"+Ur.call(nt).replace(Ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Di=ut?Ce.Buffer:void 0,Mr=Ce.Symbol,qi=Ce.Uint8Array,zi=Bt.propertyIsEnumerable,Vo=ur.splice,_r=Mr?Mr.toStringTag:void 0,cs=Object.getOwnPropertySymbols,us=Di?Di.isBuffer:void 0,hs=br(Object.keys,Object),mn=Ct(Ce,"DataView"),ci=Ct(Ce,"Map"),vn=Ct(Ce,"Promise"),wn=Ct(Ce,"Set"),Bi=Ct(Ce,"WeakMap"),ui=Ct(Object,"create"),Ko=Pr(mn),Go=Pr(ci),bn=Pr(vn),Wo=Pr(wn),_n=Pr(Bi),ls=Mr?Mr.prototype:void 0,En=ls?ls.valueOf:void 0;function Er(v){var E=-1,R=v==null?0:v.length;for(this.clear();++E<R;){var j=v[E];this.set(j[0],j[1])}}function Jo(){this.__data__=ui?ui(null):{},this.size=0}function Qo(v){var E=this.has(v)&&delete this.__data__[v];return this.size-=E?1:0,E}function Yo(v){var E=this.__data__;if(ui){var R=E[v];return R===n?void 0:R}return nt.call(E,v)?E[v]:void 0}function Zo(v){var E=this.__data__;return ui?E[v]!==void 0:nt.call(E,v)}function Xo(v,E){var R=this.__data__;return this.size+=this.has(v)?0:1,R[v]=ui&&E===void 0?n:E,this}Er.prototype.clear=Jo,Er.prototype.delete=Qo,Er.prototype.get=Yo,Er.prototype.has=Zo,Er.prototype.set=Xo;function Lt(v){var E=-1,R=v==null?0:v.length;for(this.clear();++E<R;){var j=v[E];this.set(j[0],j[1])}}function ea(){this.__data__=[],this.size=0}function ta(v){var E=this.__data__,R=hi(E,v);if(R<0)return!1;var j=E.length-1;return R==j?E.pop():Vo.call(E,R,1),--this.size,!0}function ra(v){var E=this.__data__,R=hi(E,v);return R<0?void 0:E[R][1]}function ia(v){return hi(this.__data__,v)>-1}function na(v,E){var R=this.__data__,j=hi(R,v);return j<0?(++this.size,R.push([v,E])):R[j][1]=E,this}Lt.prototype.clear=ea,Lt.prototype.delete=ta,Lt.prototype.get=ra,Lt.prototype.has=ia,Lt.prototype.set=na;function Ir(v){var E=-1,R=v==null?0:v.length;for(this.clear();++E<R;){var j=v[E];this.set(j[0],j[1])}}function ji(){this.size=0,this.__data__={hash:new Er,map:new(ci||Lt),string:new Er}}function sa(v){var E=kr(this,v).delete(v);return this.size-=E?1:0,E}function Li(v){return kr(this,v).get(v)}function oa(v){return kr(this,v).has(v)}function aa(v,E){var R=kr(this,v),j=R.size;return R.set(v,E),this.size+=R.size==j?0:1,this}Ir.prototype.clear=ji,Ir.prototype.delete=sa,Ir.prototype.get=Li,Ir.prototype.has=oa,Ir.prototype.set=aa;function Ui(v){var E=-1,R=v==null?0:v.length;for(this.__data__=new Ir;++E<R;)this.add(v[E])}function fs(v){return this.__data__.set(v,n),this}function ps(v){return this.__data__.has(v)}Ui.prototype.add=Ui.prototype.push=fs,Ui.prototype.has=ps;function Yt(v){var E=this.__data__=new Lt(v);this.size=E.size}function ca(){this.__data__=new Lt,this.size=0}function ua(v){var E=this.__data__,R=E.delete(v);return this.size=E.size,R}function ha(v){return this.__data__.get(v)}function la(v){return this.__data__.has(v)}function ds(v,E){var R=this.__data__;if(R instanceof Lt){var j=R.__data__;if(!ci||j.length<r-1)return j.push([v,E]),this.size=++R.size,this;R=this.__data__=new Ir(j)}return R.set(v,E),this.size=R.size,this}Yt.prototype.clear=ca,Yt.prototype.delete=ua,Yt.prototype.get=ha,Yt.prototype.has=la,Yt.prototype.set=ds;function gs(v,E){var R=Hi(v),j=!R&&Fs(v),xe=!R&&!j&&xn(v),ie=!R&&!j&&!xe&&Cs(v),Oe=R||j||xe||ie,ke=Oe?$i(v.length,String):[],ye=ke.length;for(var Se in v)(E||nt.call(v,Se))&&!(Oe&&(Se=="length"||xe&&(Se=="offset"||Se=="parent")||ie&&(Se=="buffer"||Se=="byteLength"||Se=="byteOffset")||Es(Se,ye)))&&ke.push(Se);return ke}function hi(v,E){for(var R=v.length;R--;)if(Ss(v[R][0],E))return R;return-1}function In(v,E,R){var j=E(v);return Hi(v)?j:gn(j,R(v))}function li(v){return v==null?v===void 0?we:M:_r&&_r in Object(v)?bs(v):da(v)}function Pn(v){return pi(v)&&li(v)==d}function fi(v,E,R,j,xe){return v===E?!0:v==null||E==null||!pi(v)&&!pi(E)?v!==v&&E!==E:ys(v,E,R,j,fi,xe)}function ys(v,E,R,j,xe,ie){var Oe=Hi(v),ke=Hi(E),ye=Oe?p:hr(v),Se=ke?p:hr(E);ye=ye==d?Q:ye,Se=Se==d?Q:Se;var je=ye==Q,dt=Se==Q,He=ye==Se;if(He&&xn(v)){if(!xn(E))return!1;Oe=!0,je=!1}if(He&&!je)return ie||(ie=new Yt),Oe||Cs(v)?Mi(v,E,R,j,xe,ie):pa(v,E,ye,R,j,xe,ie);if(!(R&a)){var Re=je&&nt.call(v,"__wrapped__"),ht=dt&&nt.call(E,"__wrapped__");if(Re||ht){var Zt=Re?v.value():v,Ut=ht?E.value():E;return ie||(ie=new Yt),xe(Zt,Ut,R,j,ie)}}return He?(ie||(ie=new Yt),ws(v,E,R,j,xe,ie)):!1}function fa(v){if(!$s(v)||Ps(v))return!1;var E=Vi(v)?yn:be;return E.test(Pr(v))}function ms(v){return pi(v)&&As(v.length)&&!!Y[li(v)]}function vs(v){if(!xs(v))return hs(v);var E=[];for(var R in Object(v))nt.call(v,R)&&R!="constructor"&&E.push(R);return E}function Mi(v,E,R,j,xe,ie){var Oe=R&a,ke=v.length,ye=E.length;if(ke!=ye&&!(Oe&&ye>ke))return!1;var Se=ie.get(v);if(Se&&ie.get(E))return Se==E;var je=-1,dt=!0,He=R&u?new Ui:void 0;for(ie.set(v,E),ie.set(E,v);++je<ke;){var Re=v[je],ht=E[je];if(j)var Zt=Oe?j(ht,Re,je,E,v,ie):j(Re,ht,je,v,E,ie);if(Zt!==void 0){if(Zt)continue;dt=!1;break}if(He){if(!$t(E,function(Ut,lr){if(!ar(He,lr)&&(Re===Ut||xe(Re,Ut,R,j,ie)))return He.push(lr)})){dt=!1;break}}else if(!(Re===ht||xe(Re,ht,R,j,ie))){dt=!1;break}}return ie.delete(v),ie.delete(E),dt}function pa(v,E,R,j,xe,ie,Oe){switch(R){case xt:if(v.byteLength!=E.byteLength||v.byteOffset!=E.byteOffset)return!1;v=v.buffer,E=E.buffer;case zt:return!(v.byteLength!=E.byteLength||!ie(new qi(v),new qi(E)));case m:case b:case k:return Ss(+v,+E);case x:return v.name==E.name&&v.message==E.message;case W:case re:return v==E+"";case D:var ke=cr;case le:var ye=j&a;if(ke||(ke=Oi),v.size!=E.size&&!ye)return!1;var Se=Oe.get(v);if(Se)return Se==E;j|=u,Oe.set(v,E);var je=Mi(ke(v),ke(E),j,xe,ie,Oe);return Oe.delete(v),je;case oe:if(En)return En.call(v)==En.call(E)}return!1}function ws(v,E,R,j,xe,ie){var Oe=R&a,ke=ki(v),ye=ke.length,Se=ki(E),je=Se.length;if(ye!=je&&!Oe)return!1;for(var dt=ye;dt--;){var He=ke[dt];if(!(Oe?He in E:nt.call(E,He)))return!1}var Re=ie.get(v);if(Re&&ie.get(E))return Re==E;var ht=!0;ie.set(v,E),ie.set(E,v);for(var Zt=Oe;++dt<ye;){He=ke[dt];var Ut=v[He],lr=E[He];if(j)var Sn=Oe?j(lr,Ut,He,E,v,ie):j(Ut,lr,He,v,E,ie);if(!(Sn===void 0?Ut===lr||xe(Ut,lr,R,j,ie):Sn)){ht=!1;break}Zt||(Zt=He=="constructor")}if(ht&&!Zt){var di=v.constructor,Je=E.constructor;di!=Je&&"constructor"in v&&"constructor"in E&&!(typeof di=="function"&&di instanceof di&&typeof Je=="function"&&Je instanceof Je)&&(ht=!1)}return ie.delete(v),ie.delete(E),ht}function ki(v){return In(v,ma,_s)}function kr(v,E){var R=v.__data__;return Is(E)?R[typeof E=="string"?"string":"hash"]:R.map}function Ct(v,E){var R=et(v,E);return fa(R)?R:void 0}function bs(v){var E=nt.call(v,_r),R=v[_r];try{v[_r]=void 0;var j=!0}catch{}var xe=Ni.call(v);return j&&(E?v[_r]=R:delete v[_r]),xe}var _s=cs?function(v){return v==null?[]:(v=Object(v),wr(cs(v),function(E){return zi.call(v,E)}))}:Pe,hr=li;(mn&&hr(new mn(new ArrayBuffer(1)))!=xt||ci&&hr(new ci)!=D||vn&&hr(vn.resolve())!=T||wn&&hr(new wn)!=le||Bi&&hr(new Bi)!=qt)&&(hr=function(v){var E=li(v),R=E==Q?v.constructor:void 0,j=R?Pr(R):"";if(j)switch(j){case Ko:return xt;case Go:return D;case bn:return T;case Wo:return le;case _n:return qt}return E});function Es(v,E){return E=E??h,!!E&&(typeof v=="number"||$e.test(v))&&v>-1&&v%1==0&&v<E}function Is(v){var E=typeof v;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?v!=="__proto__":v===null}function Ps(v){return!!Ti&&Ti in v}function xs(v){var E=v&&v.constructor,R=typeof E=="function"&&E.prototype||Bt;return v===R}function da(v){return Ni.call(v)}function Pr(v){if(v!=null){try{return Ur.call(v)}catch{}try{return v+""}catch{}}return""}function Ss(v,E){return v===E||v!==v&&E!==E}var Fs=Pn(function(){return arguments}())?Pn:function(v){return pi(v)&&nt.call(v,"callee")&&!zi.call(v,"callee")},Hi=Array.isArray;function ga(v){return v!=null&&As(v.length)&&!Vi(v)}var xn=us||Ie;function ya(v,E){return fi(v,E)}function Vi(v){if(!$s(v))return!1;var E=li(v);return E==A||E==S||E==y||E==B}function As(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=h}function $s(v){var E=typeof v;return v!=null&&(E=="object"||E=="function")}function pi(v){return v!=null&&typeof v=="object"}var Cs=Xe?Ci(Xe):ms;function ma(v){return ga(v)?gs(v):vs(v)}function Pe(){return[]}function Ie(){return!1}s.exports=ya})(No,No.exports);var BI=No.exports;const jI=hu(BI);function LI(s,t){return t=t||{},new Promise(function(r,n){var a=new XMLHttpRequest,u=[],h=[],d={},p=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:p,headers:{keys:function(){return u},entries:function(){return h},get:function(m){return d[m.toLowerCase()]},has:function(m){return m.toLowerCase()in d}}}};for(var y in a.open(t.method||"get",s,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(m,b,x){u.push(b=b.toLowerCase()),h.push([b,x]),d[b]=d[b]?d[b]+","+x:x}),r(p())},a.onerror=n,a.withCredentials=t.credentials=="include",t.headers)a.setRequestHeader(y,t.headers[y]);a.send(t.body||null)})}const UI=Object.freeze(Object.defineProperty({__proto__:null,default:LI},Symbol.toStringTag,{value:"Module"})),hf=Jf(UI);var MI=self.fetch||(self.fetch=hf.default||hf);const kI=hu(MI);function HI(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var a=0;a<s.length;a++){var u=s.charAt(a),h=u.charCodeAt(0);if(r[h]!==255)throw new TypeError(u+" is ambiguous");r[h]=a}var d=s.length,p=s.charAt(0),y=Math.log(d)/Math.log(256),m=Math.log(256)/Math.log(d);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,k=0,M=0,Q=S.length;M!==Q&&S[M]===0;)M++,D++;for(var T=(Q-M)*m+1>>>0,B=new Uint8Array(T);M!==Q;){for(var W=S[M],le=0,re=T-1;(W!==0||le<k)&&re!==-1;re--,le++)W+=256*B[re]>>>0,B[re]=W%d>>>0,W=W/d>>>0;if(W!==0)throw new Error("Non-zero carry");k=le,M++}for(var oe=T-k;oe!==T&&B[oe]===0;)oe++;for(var we=p.repeat(D);oe<T;++oe)we+=s.charAt(B[oe]);return we}function x(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var k=0,M=0;S[D]===p;)k++,D++;for(var Q=(S.length-D)*y+1>>>0,T=new Uint8Array(Q);S[D];){var B=r[S.charCodeAt(D)];if(B===255)return;for(var W=0,le=Q-1;(B!==0||W<M)&&le!==-1;le--,W++)B+=d*T[le]>>>0,T[le]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");M=W,D++}if(S[D]!==" "){for(var re=Q-M;re!==Q&&T[re]===0;)re++;for(var oe=new Uint8Array(k+(Q-re)),we=k;re!==Q;)oe[we++]=T[re++];return oe}}}function A(S){var D=x(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:x,decode:A}}var VI=HI,KI=VI;const Cp=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},GI=s=>new TextEncoder().encode(s),WI=s=>new TextDecoder().decode(s);class JI{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class QI{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Op(this,t)}}class YI{constructor(t){this.decoders=t}or(t){return Op(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Op=(s,t)=>new YI({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class ZI{constructor(t,r,n,a){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=a,this.encoder=new JI(t,r,n),this.decoder=new QI(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ko=({name:s,prefix:t,encode:r,decode:n})=>new ZI(s,t,r,n),as=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:a}=KI(r,t);return ko({prefix:s,name:t,encode:n,decode:u=>Cp(a(u))})},XI=(s,t,r,n)=>{const a={};for(let m=0;m<t.length;++m)a[t[m]]=m;let u=s.length;for(;s[u-1]==="=";)--u;const h=new Uint8Array(u*r/8|0);let d=0,p=0,y=0;for(let m=0;m<u;++m){const b=a[s[m]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);p=p<<r|b,d+=r,d>=8&&(d-=8,h[y++]=255&p>>d)}if(d>=r||255&p<<8-d)throw new SyntaxError("Unexpected end of data");return h},e2=(s,t,r)=>{const n=t[t.length-1]==="=",a=(1<<r)-1;let u="",h=0,d=0;for(let p=0;p<s.length;++p)for(d=d<<8|s[p],h+=8;h>r;)h-=r,u+=t[a&d>>h];if(h&&(u+=t[a&d<<r-h]),n)for(;u.length*r&7;)u+="=";return u},it=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>ko({prefix:t,name:s,encode(a){return e2(a,n,r)},decode(a){return XI(a,n,r,s)}}),t2=ko({prefix:"\0",name:"identity",encode:s=>WI(s),decode:s=>GI(s)});var r2=Object.freeze({__proto__:null,identity:t2});const i2=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var n2=Object.freeze({__proto__:null,base2:i2});const s2=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var o2=Object.freeze({__proto__:null,base8:s2});const a2=as({prefix:"9",name:"base10",alphabet:"0123456789"});var c2=Object.freeze({__proto__:null,base10:a2});const u2=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),h2=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var l2=Object.freeze({__proto__:null,base16:u2,base16upper:h2});const f2=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),p2=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),d2=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),g2=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),y2=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),m2=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),v2=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),w2=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),b2=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var _2=Object.freeze({__proto__:null,base32:f2,base32upper:p2,base32pad:d2,base32padupper:g2,base32hex:y2,base32hexupper:m2,base32hexpad:v2,base32hexpadupper:w2,base32z:b2});const E2=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),I2=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var P2=Object.freeze({__proto__:null,base36:E2,base36upper:I2});const x2=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),S2=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var F2=Object.freeze({__proto__:null,base58btc:x2,base58flickr:S2});const A2=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),$2=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),C2=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),O2=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var R2=Object.freeze({__proto__:null,base64:A2,base64pad:$2,base64url:C2,base64urlpad:O2});const Rp=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),T2=Rp.reduce((s,t,r)=>(s[r]=t,s),[]),N2=Rp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function D2(s){return s.reduce((t,r)=>(t+=T2[r],t),"")}function q2(s){const t=[];for(const r of s){const n=N2[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const z2=ko({prefix:"🚀",name:"base256emoji",encode:D2,decode:q2});var B2=Object.freeze({__proto__:null,base256emoji:z2}),j2=Tp,lf=128,L2=127,U2=~L2,M2=Math.pow(2,31);function Tp(s,t,r){t=t||[],r=r||0;for(var n=r;s>=M2;)t[r++]=s&255|lf,s/=128;for(;s&U2;)t[r++]=s&255|lf,s>>>=7;return t[r]=s|0,Tp.bytes=r-n+1,t}var k2=eu,H2=128,ff=127;function eu(s,n){var r=0,n=n||0,a=0,u=n,h,d=s.length;do{if(u>=d)throw eu.bytes=0,new RangeError("Could not decode varint");h=s[u++],r+=a<28?(h&ff)<<a:(h&ff)*Math.pow(2,a),a+=7}while(h>=H2);return eu.bytes=u-n,r}var V2=Math.pow(2,7),K2=Math.pow(2,14),G2=Math.pow(2,21),W2=Math.pow(2,28),J2=Math.pow(2,35),Q2=Math.pow(2,42),Y2=Math.pow(2,49),Z2=Math.pow(2,56),X2=Math.pow(2,63),eP=function(s){return s<V2?1:s<K2?2:s<G2?3:s<W2?4:s<J2?5:s<Q2?6:s<Y2?7:s<Z2?8:s<X2?9:10},tP={encode:j2,decode:k2,encodingLength:eP},Np=tP;const pf=(s,t,r=0)=>(Np.encode(s,t,r),t),df=s=>Np.encodingLength(s),tu=(s,t)=>{const r=t.byteLength,n=df(s),a=n+df(r),u=new Uint8Array(a+r);return pf(s,u,0),pf(r,u,n),u.set(t,a),new rP(s,r,t,u)};class rP{constructor(t,r,n,a){this.code=t,this.size=r,this.digest=n,this.bytes=a}}const Dp=({name:s,code:t,encode:r})=>new iP(s,t,r);class iP{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?tu(this.code,r):r.then(n=>tu(this.code,n))}else throw Error("Unknown type, must be binary type")}}const qp=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),nP=Dp({name:"sha2-256",code:18,encode:qp("SHA-256")}),sP=Dp({name:"sha2-512",code:19,encode:qp("SHA-512")});var oP=Object.freeze({__proto__:null,sha256:nP,sha512:sP});const zp=0,aP="identity",Bp=Cp,cP=s=>tu(zp,Bp(s)),uP={code:zp,name:aP,encode:Bp,digest:cP};var hP=Object.freeze({__proto__:null,identity:uP});new TextEncoder,new TextDecoder;const gf={...r2,...n2,...o2,...c2,...l2,..._2,...P2,...F2,...R2,...B2};({...oP,...hP});function jp(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function lP(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?jp(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Lp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const yf=Lp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),qc=Lp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=lP(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),fP={utf8:yf,"utf-8":yf,hex:gf.base16,latin1:qc,ascii:qc,binary:qc,...gf};function pP(s,t="utf8"){const r=fP[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?jp(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const Up="wc",dP=2,bu="core",ni=`${Up}@2:${bu}:`,gP={name:bu,logger:"error"},yP={database:":memory:"},mP="crypto",mf="client_ed25519_seed",vP=G.ONE_DAY,wP="keychain",bP="0.3",_P="messages",EP="0.3",IP=G.SIX_HOURS,PP="publisher",Mp="irn",xP="error",kp="wss://relay.walletconnect.com",vf="wss://relay.walletconnect.org",SP="relayer",ct={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},FP="_subscription",qr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},AP=G.ONE_SECOND,$P="2.11.0",CP=1e4,OP="0.3",RP="WALLETCONNECT_CLIENT_ID",nr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},TP="subscription",NP="0.3",DP=G.FIVE_SECONDS*1e3,qP="pairing",zP="0.3",Vn={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},Yn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},BP="history",jP="0.3",LP="expirer",Jt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},UP="0.3",zc="verify-api",ln="https://verify.walletconnect.com",ru="https://verify.walletconnect.org",MP=[ln,ru],kP="echo",HP="https://echo.walletconnect.com";class VP{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=wP,this.version=bP,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:u}=L("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(u)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Vf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Kf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class KP{constructor(t,r,n){this.core=t,this.logger=r,this.name=mP,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=af(a);return $p(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=C0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),h=af(u),d=Vc();return await RI(d,a,vP,h)},this.generateSharedKey=(a,u,h)=>{this.isInitialized();const d=this.getPrivateKey(a),p=O0(d,u);return this.setSymKey(p,h)},this.setSymKey=async(a,u)=>{this.isInitialized();const h=u||R0(a);return await this.keychain.set(h,a),h},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,h)=>{this.isInitialized();const d=T0(h),p=rs(u);if(Pl(d)){const x=d.senderPublicKey,A=d.receiverPublicKey;a=await this.generateSharedKey(x,A)}const y=this.getSymKey(a),{type:m,senderPublicKey:b}=d;return N0({type:m,symKey:y,message:p,senderPublicKey:b})},this.decode=async(a,u,h)=>{this.isInitialized();const d=D0(u,h);if(Pl(d)){const p=d.receiverPublicKey,y=d.senderPublicKey;a=await this.generateSharedKey(p,y)}try{const p=this.getSymKey(a),y=q0({symKey:p,encoded:u});return zo(y)}catch(p){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(p)}},this.getPayloadType=a=>{const u=xl(a);return z0(u.type)},this.getPayloadSenderPublicKey=a=>{const u=xl(a);return u.senderPublicKey?B0(u.senderPublicKey,j0):void 0},this.core=t,this.logger=Pt(r,this.name),this.keychain=n||new VP(this.core,this.logger)}get context(){return It(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(mf)}catch{t=Vc(),await this.keychain.set(mf,t)}return pP(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class GP extends Ob{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=_P,this.version=EP,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const u=fn(a);let h=this.messages.get(n);return typeof h>"u"&&(h={}),typeof h[u]<"u"||(h[u]=a,this.messages.set(n,h),await this.persist()),u},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const u=this.get(n),h=fn(a);return typeof u[h]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Pt(t,this.name),this.core=r}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Vf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Kf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class WP extends Rb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qt.EventEmitter,this.name=PP,this.queue=new Map,this.publishTimeout=G.toMiliseconds(G.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,u)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:u}});try{const d=(u==null?void 0:u.ttl)||IP,p=Kc(u),y=(u==null?void 0:u.prompt)||!1,m=(u==null?void 0:u.tag)||0,b=(u==null?void 0:u.id)||ou().toString(),x={topic:n,message:a,opts:{ttl:d,relay:p,prompt:y,tag:m,id:b}},A=setTimeout(()=>this.queue.set(b,x),this.publishTimeout);try{await await Xn(this.rpcPublish(n,a,d,p,y,m,b),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(b),this.relayer.events.emit(ct.publish,x)}catch(S){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=u==null?void 0:u.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(b),S;return}finally{clearTimeout(A)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:u}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=t,this.logger=Pt(r,this.name),this.registerEventListeners()}get context(){return It(this.logger)}rpcPublish(t,r,n,a,u,h,d){var p,y,m,b;const x={method:Ao(a.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:u,tag:h},id:d};return ii((p=x.params)==null?void 0:p.prompt)&&((y=x.params)==null||delete y.prompt),ii((m=x.params)==null?void 0:m.tag)&&((b=x.params)==null||delete b.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:x}),this.relayer.request(x)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:a}=t;await this.publish(r,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ct.connection_stalled);return}this.checkQueue()}),this.relayer.on(ct.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class JP{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const a=n.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var QP=Object.defineProperty,YP=Object.defineProperties,ZP=Object.getOwnPropertyDescriptors,wf=Object.getOwnPropertySymbols,XP=Object.prototype.hasOwnProperty,ex=Object.prototype.propertyIsEnumerable,bf=(s,t,r)=>t in s?QP(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Kn=(s,t)=>{for(var r in t||(t={}))XP.call(t,r)&&bf(s,r,t[r]);if(wf)for(var r of wf(t))ex.call(t,r)&&bf(s,r,t[r]);return s},Bc=(s,t)=>YP(s,ZP(t));class tx extends Db{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new JP,this.events=new Qt.EventEmitter,this.name=TP,this.version=NP,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ni,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const u=Kc(a),h={topic:n,relay:u};this.pending.set(n,h);const d=await this.rpcSubscribe(n,u);return this.onSubscribe(d,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),d}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,u)=>{const h=new G.Watch;h.start(this.pendingSubscriptionWatchLabel);const d=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(d),h.stop(this.pendingSubscriptionWatchLabel),a(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=DP&&(clearInterval(d),h.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Pt(r,this.name),this.clientId=""}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const a=Kc(n);await this.rpcUnsubscribe(t,r,a);const u=at("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const n={method:Ao(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}return fn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:Ao(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}}rpcUnsubscribe(t,r,n){const a={method:Ao(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,Bc(Kn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Kn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Kn({},r)),this.topicMap.set(r.topic,t),this.events.emit(nr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(nr.deleted,Bc(Kn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(nr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(nr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);pn(r)&&this.onBatchSubscribe(r.map((n,a)=>Bc(Kn({},t[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ct.connect,async()=>{await this.onConnect()}),this.relayer.on(ct.disconnect,()=>{this.onDisconnect()}),this.events.on(nr.created,async t=>{const r=nr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(nr.deleted,async t=>{const r=nr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var rx=Object.defineProperty,_f=Object.getOwnPropertySymbols,ix=Object.prototype.hasOwnProperty,nx=Object.prototype.propertyIsEnumerable,Ef=(s,t,r)=>t in s?rx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,sx=(s,t)=>{for(var r in t||(t={}))ix.call(t,r)&&Ef(s,r,t[r]);if(_f)for(var r of _f(t))nx.call(t,r)&&Ef(s,r,t[r]);return s};class ox extends Tb{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qt.EventEmitter,this.name=SP,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(ct.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(ct.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(qr.payload,this.onPayloadHandler),this.provider.on(qr.connect,this.onConnectHandler),this.provider.on(qr.disconnect,this.onDisconnectHandler),this.provider.on(qr.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Pt(t.logger,this.name):Lo(Uo({level:t.logger||xP})),this.messages=new GP(this.logger,t.core),this.subscriber=new tx(this,this.logger),this.publisher=new WP(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||kp,this.projectId=t.projectId,this.bundleId=L0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${vf}...`),await this.restartTransport(vf)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},CP)}get context(){return It(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(a)return a;let u;const h=d=>{d.topic===t&&(this.subscriber.off(nr.created,h),u())};return await Promise.all([new Promise(d=>{u=d,this.subscriber.on(nr.created,h)}),new Promise(async d=>{a=await this.subscriber.subscribe(t,r),d()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Xn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(nr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await Xn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){n(a);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(qr.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Sl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new TI(new zI(U0({sdkVersion:$P,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),cu(t)){if(!t.method.endsWith(FP))return;const r=t.params,{topic:n,message:a,publishedAt:u}=r.data,h={topic:n,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(sx({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(t),await this.onMessageEvent(h)}else is(t)&&this.events.emit(ct.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(ct.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Bo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(qr.payload,this.onPayloadHandler),this.provider.off(qr.connect,this.onConnectHandler),this.provider.off(qr.disconnect,this.onDisconnectHandler),this.provider.off(qr.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(ct.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Sl();M0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(ct.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},G.toMiliseconds(AP)))}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var ax=Object.defineProperty,If=Object.getOwnPropertySymbols,cx=Object.prototype.hasOwnProperty,ux=Object.prototype.propertyIsEnumerable,Pf=(s,t,r)=>t in s?ax(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,xf=(s,t)=>{for(var r in t||(t={}))cx.call(t,r)&&Pf(s,r,t[r]);if(If)for(var r of If(t))ux.call(t,r)&&Pf(s,r,t[r]);return s};class Ho extends Nb{constructor(t,r,n,a=ni,u=void 0){super(t,r,n,a),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=OP,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!ii(h)?this.map.set(this.getKey(h),h):A0(h)?this.map.set(h.id,h):$0(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,d)=>{this.isInitialized(),this.map.has(h)?await this.update(h,d):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:d}),this.map.set(h,d),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(d=>Object.keys(h).every(p=>jI(d[p],h[p]))):this.values),this.update=async(h,d)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:d});const p=xf(xf({},this.getData(h)),d);this.map.set(h,p),await this.persist()},this.delete=async(h,d)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:d}),this.map.delete(h),await this.persist())},this.logger=Pt(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class hx{constructor(t,r){this.core=t,this.logger=r,this.name=qP,this.version=zP,this.events=new uu,this.initialized=!1,this.storagePrefix=ni,this.ignoredPayloadTypes=[Mf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Vc(),a=await this.core.crypto.setSymKey(n),u=sr(G.FIVE_MINUTES),h={protocol:Mp},d={topic:a,expiry:u,relay:h,active:!1},p=k0({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:h});return await this.pairings.set(a,d),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:p}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:u,relay:h}=Fl(n.uri);let d;if(this.pairings.keys.includes(a)&&(d=this.pairings.get(a),d.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const p=sr(G.FIVE_MINUTES),y={topic:a,relay:h,expiry:p,active:!1};return await this.pairings.set(a,y),this.core.expirer.set(a,p),n.activatePairing&&await this.activate({topic:a}),this.events.emit(Yn.create,y),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:h})),y},this.activate=async({topic:n})=>{this.isInitialized();const a=sr(G.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:h,resolve:d,reject:p}=un();this.events.once(Ve("pairing_ping",u),({error:y})=>{y?p(y):d()}),await h()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",at("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,u)=>{const h=xi(a,u),d=await this.core.crypto.encode(n,h),p=Vn[a].req;return this.core.history.set(n,h),this.core.relayer.publish(n,d,p),h.id},this.sendResult=async(n,a,u)=>{const h=Bo(n,u),d=await this.core.crypto.encode(a,h),p=await this.core.history.get(a,n),y=Vn[p.request.method].res;await this.core.relayer.publish(a,d,y),await this.core.history.resolve(h)},this.sendError=async(n,a,u)=>{const h=au(n,u),d=await this.core.crypto.encode(a,h),p=await this.core.history.get(a,n),y=Vn[p.request.method]?Vn[p.request.method].res:Vn.unregistered_method.res;await this.core.relayer.publish(a,d,y),await this.core.history.resolve(h)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,at("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>ri(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:u}=n;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:u}=n,h=(await this.core.history.get(a,u.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(n,a)=>{const{id:u}=a;try{this.isValidPing({topic:n}),await this.sendResult(u,n,!0),this.events.emit(Yn.ping,{id:u,topic:n})}catch(h){await this.sendError(u,n,h),this.logger.error(h)}},this.onPairingPingResponse=(n,a)=>{const{id:u}=a;setTimeout(()=>{ti(a)?this.events.emit(Ve("pairing_ping",u),{}):or(a)&&this.events.emit(Ve("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Yn.delete,{id:u,topic:n})}catch(h){await this.sendError(u,n,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:u,method:h}=a;try{if(this.registeredMethods.includes(h))return;const d=at("WC_METHOD_UNSUPPORTED",h);await this.sendError(u,n,d),this.logger.error(d)}catch(d){await this.sendError(u,n,d),this.logger.error(d)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(at("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var a;if(!Et(n)){const{message:h}=L("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(h)}if(!H0(n.uri)){const{message:h}=L("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(h)}const u=Fl(n.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:h}=L("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(u!=null&&u.symKey)){const{message:h}=L("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async n=>{if(!Et(n)){const{message:u}=L("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(u)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!Et(n)){const{message:u}=L("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(u)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!hn(n,!1)){const{message:a}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(ri(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=L("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=t,this.logger=Pt(r,this.name),this.pairings=new Ho(this.core,this.logger,this.name,this.storagePrefix)}get context(){return It(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(r,n);try{cu(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):is(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Jt.expired,async t=>{const{topic:r}=kf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Yn.expire,{topic:r}))})}}class lx extends Cb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qt.EventEmitter,this.name=BP,this.version=jP,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:u}),this.records.has(a.id))return;const h={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:u,expiry:sr(G.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(yr.created,h)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=or(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(yr.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===n){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(yr.deleted,u)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:xi(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(yr.created,t=>{const r=yr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.updated,t=>{const r=yr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.deleted,t=>{const r=yr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{G.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class fx extends qb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qt.EventEmitter,this.name=LP,this.version=UP,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const u=this.formatTarget(n),h={target:u,expiry:a};this.expirations.set(u,h),this.checkExpiry(u,h),this.events.emit(Jt.created,{target:u,expiration:h})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Jt.deleted,{target:a,expiration:u})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return V0(t);if(typeof t=="number")return K0(t);const{message:r}=L("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Jt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;G.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Jt.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Jt.created,t=>{const r=Jt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.expired,t=>{const r=Jt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.deleted,t=>{const r=Jt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}}}class px extends zb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=zc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||G0()||!Hf())return;const a=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ru;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let u;try{u=await this.fetchAttestation(n.attestationId,a)}catch(h){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${a}`),this.logger.info(h),u=await this.fetchAttestation(n.attestationId,ru)}return u},this.fetchAttestation=async(n,a)=>{this.logger.info(`resolving attestation: ${n} from url: ${a}`);const u=this.startAbortTimer(G.ONE_SECOND*2),h=await fetch(`${a}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(u),h.status===200?await h.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),n())};await Promise.race([new Promise(u=>{if(document.getElementById(zc))return u();window.addEventListener("message",a);const h=document.createElement("iframe");h.id=zc,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,n=u}),new Promise((u,h)=>setTimeout(()=>{window.removeEventListener("message",a),h("verify iframe load timeout")},G.toMiliseconds(G.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let a=n||ln;return MP.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${ln}`),a=ln),a},this.logger=Pt(r,this.name),this.verifyUrl=ln,this.abortController=new AbortController,this.isDevEnv=W0()&&{}.IS_VITEST}get context(){return It(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),G.toMiliseconds(t))}}class dx extends Bb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=kP,this.registerDeviceToken=async n=>{const{clientId:a,token:u,notificationType:h,enableEncrypted:d=!1}=n,p=`${HP}/${this.projectId}/clients`;await kI(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:h,token:u,always_raw:d})})},this.logger=Pt(r,this.context)}}var gx=Object.defineProperty,Sf=Object.getOwnPropertySymbols,yx=Object.prototype.hasOwnProperty,mx=Object.prototype.propertyIsEnumerable,Ff=(s,t,r)=>t in s?gx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Af=(s,t)=>{for(var r in t||(t={}))yx.call(t,r)&&Ff(s,r,t[r]);if(Sf)for(var r of Sf(t))mx.call(t,r)&&Ff(s,r,t[r]);return s};class _u extends $b{constructor(t){super(t),this.protocol=Up,this.version=dP,this.name=bu,this.events=new Qt.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||kp,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Lo(Uo({level:(t==null?void 0:t.logger)||gP.logger}));this.logger=Pt(r,this.name),this.heartbeat=new dn.HeartBeat,this.crypto=new KP(this,this.logger,t==null?void 0:t.keychain),this.history=new lx(this,this.logger),this.expirer=new fx(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Zw(Af(Af({},yP),t==null?void 0:t.storageOptions)),this.relayer=new ox({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new hx(this,this.logger),this.verify=new px(this.projectId||"",this.logger),this.echoClient=new dx(this.projectId||"",this.logger)}static async init(t){const r=new _u(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(RP,n),r}get context(){return It(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const vx=_u,Hp="wc",Vp=2,Kp="client",Eu=`${Hp}@${Vp}:${Kp}:`,jc={name:Kp,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},$f="WALLETCONNECT_DEEPLINK_CHOICE",wx="proposal",Gp="Proposal expired",bx="session",xo=G.SEVEN_DAYS,_x="engine",Gn={wc_sessionPropose:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1104},res:{ttl:G.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1106},res:{ttl:G.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1112},res:{ttl:G.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1115}}},Lc={min:G.FIVE_MINUTES,max:G.SEVEN_DAYS},zr={idle:"IDLE",active:"ACTIVE"},Ex="request",Ix=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Px=Object.defineProperty,xx=Object.defineProperties,Sx=Object.getOwnPropertyDescriptors,Cf=Object.getOwnPropertySymbols,Fx=Object.prototype.hasOwnProperty,Ax=Object.prototype.propertyIsEnumerable,Of=(s,t,r)=>t in s?Px(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,bt=(s,t)=>{for(var r in t||(t={}))Fx.call(t,r)&&Of(s,r,t[r]);if(Cf)for(var r of Cf(t))Ax.call(t,r)&&Of(s,r,t[r]);return s},Wn=(s,t)=>xx(s,Sx(t));class $x extends Lb{constructor(t){super(t),this.name=_x,this.events=new uu,this.initialized=!1,this.ignoredPayloadTypes=[Mf],this.requestQueue={state:zr.idle,queue:[]},this.sessionRequestQueue={state:zr.idle,queue:[]},this.requestQueueDelay=G.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Wn(bt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:h,sessionProperties:d,relays:p}=n;let y=a,m,b=!1;if(y&&(b=this.client.core.pairing.pairings.get(y).active),!y||!b){const{topic:T,uri:B}=await this.client.core.pairing.create();y=T,m=B}const x=await this.client.core.crypto.generateKeyPair(),A=bt({requiredNamespaces:u,optionalNamespaces:h,relays:p??[{protocol:Mp}],proposer:{publicKey:x,metadata:this.client.metadata}},d&&{sessionProperties:d}),{reject:S,resolve:D,done:k}=un(G.FIVE_MINUTES,Gp);if(this.events.once(Ve("session_connect"),async({error:T,session:B})=>{if(T)S(T);else if(B){B.self.publicKey=x;const W=Wn(bt({},B),{requiredNamespaces:B.requiredNamespaces,optionalNamespaces:B.optionalNamespaces});await this.client.session.set(B.topic,W),await this.setExpiry(B.topic,B.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:B.peer.metadata}),D(W)}}),!y){const{message:T}=L("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(T)}const M=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:A}),Q=sr(G.FIVE_MINUTES);return await this.setProposal(M,bt({id:M,expiry:Q},A)),{uri:m,approval:k}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:a,namespaces:u,sessionProperties:h}=r,d=this.client.proposal.get(n);let{pairingTopic:p,proposer:y,requiredNamespaces:m,optionalNamespaces:b}=d;p=p||"",$o(m)||(m=Q0(u,"approve()"));const x=await this.client.core.crypto.generateKeyPair(),A=y.publicKey,S=await this.client.core.crypto.generateSharedKey(x,A);p&&n&&(await this.client.core.pairing.updateMetadata({topic:p,metadata:y.metadata}),await this.sendResult({id:n,topic:p,result:{relay:{protocol:a??"irn"},responderPublicKey:x}}),await this.client.proposal.delete(n,at("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:p}));const D=bt({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:m,optionalNamespaces:b,pairingTopic:p,controller:{publicKey:x,metadata:this.client.metadata},expiry:sr(xo)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(S),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:D,throwOnFailedPublish:!0});const k=Wn(bt({},D),{topic:S,pairingTopic:p,acknowledged:!1,self:D.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:x});return await this.client.session.set(S,k),await this.setExpiry(S,sr(xo)),{topic:S,acknowledged:()=>new Promise(M=>setTimeout(()=>M(this.client.session.get(S)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(n);u&&(await this.sendError(n,u,a),await this.client.proposal.delete(n,at("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:a}=r,u=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:h,resolve:d,reject:p}=un();return this.events.once(Ve("session_update",u),({error:y})=>{y?p(y):d()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,a=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:u,resolve:h,reject:d}=un();return this.events.once(Ve("session_extend",a),({error:p})=>{p?d(p):h()}),await this.setExpiry(n,sr(xo)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:a,topic:u,expiry:h}=r,d=vw(),{done:p,resolve:y,reject:m}=un(h,"Request expired. Please try again.");return this.events.once(Ve("session_request",d),({error:b,result:x})=>{b?m(b):y(x)}),await Promise.all([new Promise(async b=>{await this.sendRequest({clientRpcId:d,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:n},expiry:h,throwOnFailedPublish:!0}).catch(x=>m(x)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:n,id:d}),b()}),new Promise(async b=>{const x=await Y0(this.client.core.storage,$f);Z0({id:d,topic:u,wcDeepLink:x}),b()}),p()]).then(b=>b[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:a}=r,{id:u}=a;ti(a)?await this.sendResult({id:u,topic:n,result:a.result,throwOnFailedPublish:!0}):or(a)&&await this.sendError(u,n,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const a=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:u,resolve:h,reject:d}=un();this.events.once(Ve("session_ping",a),({error:p})=>{p?d(p):h()}),await u()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:a,chainId:u}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:at("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>X0(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var h,d;return((h=u.peerMetadata)==null?void 0:h.url)&&((d=u.peerMetadata)==null?void 0:d.url)===r.peer.metadata.url&&u.topic&&u.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,at("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem($f).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,at("USER_DISCONNECTED"))})},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,at("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=zr.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Gn.wc_sessionRequest.req.ttl,{id:a,topic:u,params:h,verifyContext:d}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:h,verifyContext:d}),n&&this.client.core.expirer.set(a,sr(n))},this.sendRequest=async r=>{const{topic:n,method:a,params:u,expiry:h,relayRpcId:d,clientRpcId:p,throwOnFailedPublish:y}=r,m=xi(a,u,p);if(Hf()&&Ix.includes(a)){const A=fn(JSON.stringify(m));this.client.core.verify.register({attestationId:A})}const b=await this.client.core.crypto.encode(n,m),x=Gn[a].req;return h&&(x.ttl=h),d&&(x.id=d),this.client.core.history.set(n,m),y?(x.internal=Wn(bt({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,b,x)):this.client.core.relayer.publish(n,b,x).catch(A=>this.client.logger.error(A)),m.id},this.sendResult=async r=>{const{id:n,topic:a,result:u,throwOnFailedPublish:h}=r,d=Bo(n,u),p=await this.client.core.crypto.encode(a,d),y=await this.client.core.history.get(a,n),m=Gn[y.request.method].res;h?(m.internal=Wn(bt({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,p,m)):this.client.core.relayer.publish(a,p,m).catch(b=>this.client.logger.error(b)),await this.client.core.history.resolve(d)},this.sendError=async(r,n,a)=>{const u=au(r,a),h=await this.client.core.crypto.encode(n,u),d=await this.client.core.history.get(n,r),p=Gn[d.request.method].res;this.client.core.relayer.publish(n,h,p),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(a=>{ri(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{ri(a.expiry)&&n.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===zr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=zr.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=zr.idle},this.processRequest=r=>{const{topic:n,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:a}=r,u=(await this.client.core.history.get(n,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:a}=L("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,n)=>{const{params:a,id:u}=n;try{this.isValidConnect(bt({},n.params));const h=sr(G.FIVE_MINUTES),d=bt({id:u,pairingTopic:r,expiry:h},a);await this.setProposal(u,d);const p=fn(JSON.stringify(n)),y=await this.getVerifyContext(p,d.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:d,verifyContext:y})}catch(h){await this.sendError(u,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,n)=>{const{id:a}=n;if(ti(n)){const{result:u}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const h=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const d=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:d});const p=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:p});const y=await this.client.core.crypto.generateSharedKey(d,p);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const m=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:m}),await this.client.core.pairing.activate({topic:r})}else or(n)&&(await this.client.proposal.delete(a,at("USER_DISCONNECTED")),this.events.emit(Ve("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:a,params:u}=n;try{this.isValidSessionSettleRequest(u);const{relay:h,controller:d,expiry:p,namespaces:y,requiredNamespaces:m,optionalNamespaces:b,sessionProperties:x,pairingTopic:A}=n.params,S=bt({topic:r,relay:h,expiry:p,namespaces:y,acknowledged:!0,pairingTopic:A,requiredNamespaces:m,optionalNamespaces:b,controller:d.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},x&&{sessionProperties:x});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Ve("session_connect"),{session:S}),this.cleanupDuplicatePairings(S)}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,n)=>{const{id:a}=n;ti(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ve("session_approve",a),{})):or(n)&&(await this.client.session.delete(r,at("USER_DISCONNECTED")),this.events.emit(Ve("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:a,id:u}=n;try{const h=`${r}_session_update`,d=mo.get(h);if(d&&this.isRequestOutOfSync(d,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(bt({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),mo.set(h,u)}catch(h){await this.sendError(u,r,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:a}=n;ti(n)?this.events.emit(Ve("session_update",a),{}):or(n)&&this.events.emit(Ve("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:a}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,sr(xo)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,n)=>{const{id:a}=n;ti(n)?this.events.emit(Ve("session_extend",a),{}):or(n)&&this.events.emit(Ve("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:a}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,n)=>{const{id:a}=n;setTimeout(()=>{ti(n)?this.events.emit(Ve("session_ping",a),{}):or(n)&&this.events.emit(Ve("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(ct.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,n)=>{const{id:a,params:u}=n;try{this.isValidRequest(bt({topic:r},u));const h=fn(JSON.stringify(xi("wc_sessionRequest",u,a))),d=this.client.session.get(r),p=await this.getVerifyContext(h,d.peer.metadata),y={id:a,topic:r,params:u,verifyContext:p};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,n)=>{const{id:a}=n;ti(n)?this.events.emit(Ve("session_request",a),{result:n.result}):or(n)&&this.events.emit(Ve("session_request",a),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:a,params:u}=n;try{const h=`${r}_session_event_${u.event.name}`,d=mo.get(h);if(d&&this.isRequestOutOfSync(d,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(bt({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),mo.set(h,a)}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=zr.idle,this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===zr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=zr.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,xi("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!Et(r)){const{message:p}=L("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(p)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:h,relays:d}=r;if(ii(n)||await this.isValidPairingTopic(n),!ew(d,!0)){const{message:p}=L("MISSING_OR_INVALID",`connect() relays: ${d}`);throw new Error(p)}!ii(a)&&$o(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ii(u)&&$o(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),ii(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,n)=>{const a=tw(r,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!Et(r))throw new Error(L("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:a,relayProtocol:u,sessionProperties:h}=r;await this.isValidProposalId(n);const d=this.client.proposal.get(n),p=_c(a,"approve()");if(p)throw new Error(p.message);const y=Al(d.requiredNamespaces,a,"approve()");if(y)throw new Error(y.message);if(!hn(u,!0)){const{message:m}=L("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(m)}ii(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!Et(r)){const{message:u}=L("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:n,reason:a}=r;if(await this.isValidProposalId(n),!rw(a)){const{message:u}=L("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!Et(r)){const{message:y}=L("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(y)}const{relay:n,controller:a,namespaces:u,expiry:h}=r;if(!iw(n)){const{message:y}=L("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const d=nw(a,"onSessionSettleRequest()");if(d)throw new Error(d.message);const p=_c(u,"onSessionSettleRequest()");if(p)throw new Error(p.message);if(ri(h)){const{message:y}=L("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async r=>{if(!Et(r)){const{message:p}=L("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(p)}const{topic:n,namespaces:a}=r;await this.isValidSessionTopic(n);const u=this.client.session.get(n),h=_c(a,"update()");if(h)throw new Error(h.message);const d=Al(u.requiredNamespaces,a,"update()");if(d)throw new Error(d.message)},this.isValidExtend=async r=>{if(!Et(r)){const{message:a}=L("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!Et(r)){const{message:p}=L("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(p)}const{topic:n,request:a,chainId:u,expiry:h}=r;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!$l(d,u)){const{message:p}=L("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(p)}if(!sw(a)){const{message:p}=L("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(p)}if(!ow(d,u,a.method)){const{message:p}=L("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(p)}if(h&&!aw(h,Lc)){const{message:p}=L("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${Lc.min} and ${Lc.max}`);throw new Error(p)}},this.isValidRespond=async r=>{var n;if(!Et(r)){const{message:h}=L("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(h){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),h}if(!cw(u)){const{message:h}=L("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!Et(r)){const{message:a}=L("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!Et(r)){const{message:d}=L("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(d)}const{topic:n,event:a,chainId:u}=r;await this.isValidSessionTopic(n);const{namespaces:h}=this.client.session.get(n);if(!$l(h,u)){const{message:d}=L("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(d)}if(!uw(a)){const{message:d}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}if(!hw(h,u,a.name)){const{message:d}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}},this.isValidDisconnect=async r=>{if(!Et(r)){const{message:a}=L("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const a={verified:{verifyUrl:n.verifyUrl||ln,validation:"UNKNOWN",origin:n.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(a=>{if(!hn(a,!1)){const{message:u}=L("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=L("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(r,n);try{cu(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):is(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(Jt.expired,async t=>{const{topic:r,id:n}=kf(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,L("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Yn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!hn(t,!1)){const{message:r}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=L("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!hn(t,!1)){const{message:r}=L("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=L("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=L("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(hn(t,!1)){const{message:r}=L("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=L("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!lw(t)){const{message:r}=L("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=L("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=L("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class Cx extends Ho{constructor(t,r){super(t,r,wx,Eu),this.core=t,this.logger=r}}class Ox extends Ho{constructor(t,r){super(t,r,bx,Eu),this.core=t,this.logger=r}}class Rx extends Ho{constructor(t,r){super(t,r,Ex,Eu,n=>n.id),this.core=t,this.logger=r}}let Tx=class Wp extends jb{constructor(t){super(t),this.protocol=Hp,this.version=Vp,this.name=jc.name,this.events=new Qt.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||jc.name,this.metadata=(t==null?void 0:t.metadata)||J0();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Lo(Uo({level:(t==null?void 0:t.logger)||jc.logger}));this.core=(t==null?void 0:t.core)||new vx(t),this.logger=Pt(r,this.name),this.session=new Ox(this.core,this.logger),this.proposal=new Cx(this.core,this.logger),this.pendingRequest=new Rx(this.core,this.logger),this.engine=new $x(this)}static async init(t){const r=new Wp(t);return await r.initialize(),r}get context(){return It(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};class ai extends Wf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||ou().toString()),r)}async requestStrict(t,r){return new Promise(async(n,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{or(u)?a(u.error):n(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),is(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Rf="error",Nx="wss://relay.walletconnect.com",Dx="wc",qx="universal_provider",Tf=`${Dx}@2:${qx}:`,zx="https://rpc.walletconnect.com/v1/",Br={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Jn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},iu={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",d="Invalid `variable` option passed into `_.template`",p="__lodash_hash_undefined__",y=500,m="__lodash_placeholder__",b=1,x=2,A=4,S=1,D=2,k=1,M=2,Q=4,T=8,B=16,W=32,le=64,re=128,oe=256,we=512,qt=30,zt="...",xt=800,vr=16,jr=1,ee=2,q=3,V=1/0,K=9007199254740991,de=17976931348623157e292,fe=0/0,ae=4294967295,Ae=ae-1,be=ae>>>1,$e=[["ary",re],["bind",k],["bindKey",M],["curry",T],["curryRight",B],["flip",we],["partial",W],["partialRight",le],["rearg",oe]],Y="[object Arguments]",qe="[object Array]",St="[object AsyncFunction]",Ce="[object Boolean]",Be="[object Date]",Ft="[object DOMException]",ut="[object Error]",At="[object Function]",Lr="[object GeneratorFunction]",Xe="[object Map]",wr="[object Number]",gn="[object Null]",$t="[object Object]",$i="[object Promise]",Ci="[object Proxy]",ar="[object RegExp]",et="[object Set]",cr="[object String]",br="[object Symbol]",Oi="[object Undefined]",ur="[object WeakMap]",Ri="[object WeakSet]",Bt="[object ArrayBuffer]",jt="[object DataView]",Ur="[object Float32Array]",nt="[object Float64Array]",Ti="[object Int8Array]",Ni="[object Int16Array]",yn="[object Int32Array]",Di="[object Uint8Array]",Mr="[object Uint8ClampedArray]",qi="[object Uint16Array]",zi="[object Uint32Array]",Vo=/\b__p \+= '';/g,_r=/\b(__p \+=) '' \+/g,cs=/(__e\(.*?\)|\b__t\)) \+\n'';/g,us=/&(?:amp|lt|gt|quot|#39);/g,hs=/[&<>"']/g,mn=RegExp(us.source),ci=RegExp(hs.source),vn=/<%-([\s\S]+?)%>/g,wn=/<%([\s\S]+?)%>/g,Bi=/<%=([\s\S]+?)%>/g,ui=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ko=/^\w*$/,Go=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bn=/[\\^$.*+?()[\]{}|]/g,Wo=RegExp(bn.source),_n=/^\s+/,ls=/\s/,En=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Er=/\{\n\/\* \[wrapped with (.+)\] \*/,Jo=/,? & /,Qo=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Yo=/[()=,{}\[\]\/\s]/,Zo=/\\(\\)?/g,Xo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Lt=/\w*$/,ea=/^[-+]0x[0-9a-f]+$/i,ta=/^0b[01]+$/i,ra=/^\[object .+?Constructor\]$/,ia=/^0o[0-7]+$/i,na=/^(?:0|[1-9]\d*)$/,Ir=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ji=/($^)/,sa=/['\n\r\u2028\u2029\\]/g,Li="\\ud800-\\udfff",oa="\\u0300-\\u036f",aa="\\ufe20-\\ufe2f",Ui="\\u20d0-\\u20ff",fs=oa+aa+Ui,ps="\\u2700-\\u27bf",Yt="a-z\\xdf-\\xf6\\xf8-\\xff",ca="\\xac\\xb1\\xd7\\xf7",ua="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ha="\\u2000-\\u206f",la=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ds="A-Z\\xc0-\\xd6\\xd8-\\xde",gs="\\ufe0e\\ufe0f",hi=ca+ua+ha+la,In="['’]",li="["+Li+"]",Pn="["+hi+"]",fi="["+fs+"]",ys="\\d+",fa="["+ps+"]",ms="["+Yt+"]",vs="[^"+Li+hi+ys+ps+Yt+ds+"]",Mi="\\ud83c[\\udffb-\\udfff]",pa="(?:"+fi+"|"+Mi+")",ws="[^"+Li+"]",ki="(?:\\ud83c[\\udde6-\\uddff]){2}",kr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ct="["+ds+"]",bs="\\u200d",_s="(?:"+ms+"|"+vs+")",hr="(?:"+Ct+"|"+vs+")",Es="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",Is="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",Ps=pa+"?",xs="["+gs+"]?",da="(?:"+bs+"(?:"+[ws,ki,kr].join("|")+")"+xs+Ps+")*",Pr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ss="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Fs=xs+Ps+da,Hi="(?:"+[fa,ki,kr].join("|")+")"+Fs,ga="(?:"+[ws+fi+"?",fi,ki,kr,li].join("|")+")",xn=RegExp(In,"g"),ya=RegExp(fi,"g"),Vi=RegExp(Mi+"(?="+Mi+")|"+ga+Fs,"g"),As=RegExp([Ct+"?"+ms+"+"+Es+"(?="+[Pn,Ct,"$"].join("|")+")",hr+"+"+Is+"(?="+[Pn,Ct+_s,"$"].join("|")+")",Ct+"?"+_s+"+"+Es,Ct+"+"+Is,Ss,Pr,ys,Hi].join("|"),"g"),$s=RegExp("["+bs+Li+fs+gs+"]"),pi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ma=-1,Pe={};Pe[Ur]=Pe[nt]=Pe[Ti]=Pe[Ni]=Pe[yn]=Pe[Di]=Pe[Mr]=Pe[qi]=Pe[zi]=!0,Pe[Y]=Pe[qe]=Pe[Bt]=Pe[Ce]=Pe[jt]=Pe[Be]=Pe[ut]=Pe[At]=Pe[Xe]=Pe[wr]=Pe[$t]=Pe[ar]=Pe[et]=Pe[cr]=Pe[ur]=!1;var Ie={};Ie[Y]=Ie[qe]=Ie[Bt]=Ie[jt]=Ie[Ce]=Ie[Be]=Ie[Ur]=Ie[nt]=Ie[Ti]=Ie[Ni]=Ie[yn]=Ie[Xe]=Ie[wr]=Ie[$t]=Ie[ar]=Ie[et]=Ie[cr]=Ie[br]=Ie[Di]=Ie[Mr]=Ie[qi]=Ie[zi]=!0,Ie[ut]=Ie[At]=Ie[ur]=!1;var v={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},R={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},j={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xe=parseFloat,ie=parseInt,Oe=typeof Jn=="object"&&Jn&&Jn.Object===Object&&Jn,ke=typeof self=="object"&&self&&self.Object===Object&&self,ye=Oe||ke||Function("return this")(),Se=t&&!t.nodeType&&t,je=Se&&!0&&s&&!s.nodeType&&s,dt=je&&je.exports===Se,He=dt&&Oe.process,Re=function(){try{var I=je&&je.require&&je.require("util").types;return I||He&&He.binding&&He.binding("util")}catch{}}(),ht=Re&&Re.isArrayBuffer,Zt=Re&&Re.isDate,Ut=Re&&Re.isMap,lr=Re&&Re.isRegExp,Sn=Re&&Re.isSet,di=Re&&Re.isTypedArray;function Je(I,$,F){switch(F.length){case 0:return I.call($);case 1:return I.call($,F[0]);case 2:return I.call($,F[0],F[1]);case 3:return I.call($,F[0],F[1],F[2])}return I.apply($,F)}function Yp(I,$,F,U){for(var te=-1,ve=I==null?0:I.length;++te<ve;){var Ke=I[te];$(U,Ke,F(Ke),I)}return U}function Mt(I,$){for(var F=-1,U=I==null?0:I.length;++F<U&&$(I[F],F,I)!==!1;);return I}function Zp(I,$){for(var F=I==null?0:I.length;F--&&$(I[F],F,I)!==!1;);return I}function xu(I,$){for(var F=-1,U=I==null?0:I.length;++F<U;)if(!$(I[F],F,I))return!1;return!0}function Hr(I,$){for(var F=-1,U=I==null?0:I.length,te=0,ve=[];++F<U;){var Ke=I[F];$(Ke,F,I)&&(ve[te++]=Ke)}return ve}function Os(I,$){var F=I==null?0:I.length;return!!F&&Ki(I,$,0)>-1}function va(I,$,F){for(var U=-1,te=I==null?0:I.length;++U<te;)if(F($,I[U]))return!0;return!1}function Te(I,$){for(var F=-1,U=I==null?0:I.length,te=Array(U);++F<U;)te[F]=$(I[F],F,I);return te}function Vr(I,$){for(var F=-1,U=$.length,te=I.length;++F<U;)I[te+F]=$[F];return I}function wa(I,$,F,U){var te=-1,ve=I==null?0:I.length;for(U&&ve&&(F=I[++te]);++te<ve;)F=$(F,I[te],te,I);return F}function Xp(I,$,F,U){var te=I==null?0:I.length;for(U&&te&&(F=I[--te]);te--;)F=$(F,I[te],te,I);return F}function ba(I,$){for(var F=-1,U=I==null?0:I.length;++F<U;)if($(I[F],F,I))return!0;return!1}var ed=_a("length");function td(I){return I.split("")}function rd(I){return I.match(Qo)||[]}function Su(I,$,F){var U;return F(I,function(te,ve,Ke){if($(te,ve,Ke))return U=ve,!1}),U}function Rs(I,$,F,U){for(var te=I.length,ve=F+(U?1:-1);U?ve--:++ve<te;)if($(I[ve],ve,I))return ve;return-1}function Ki(I,$,F){return $===$?dd(I,$,F):Rs(I,Fu,F)}function id(I,$,F,U){for(var te=F-1,ve=I.length;++te<ve;)if(U(I[te],$))return te;return-1}function Fu(I){return I!==I}function Au(I,$){var F=I==null?0:I.length;return F?Ia(I,$)/F:fe}function _a(I){return function($){return $==null?r:$[I]}}function Ea(I){return function($){return I==null?r:I[$]}}function $u(I,$,F,U,te){return te(I,function(ve,Ke,Fe){F=U?(U=!1,ve):$(F,ve,Ke,Fe)}),F}function nd(I,$){var F=I.length;for(I.sort($);F--;)I[F]=I[F].value;return I}function Ia(I,$){for(var F,U=-1,te=I.length;++U<te;){var ve=$(I[U]);ve!==r&&(F=F===r?ve:F+ve)}return F}function Pa(I,$){for(var F=-1,U=Array(I);++F<I;)U[F]=$(F);return U}function sd(I,$){return Te($,function(F){return[F,I[F]]})}function Cu(I){return I&&I.slice(0,Nu(I)+1).replace(_n,"")}function Ot(I){return function($){return I($)}}function xa(I,$){return Te($,function(F){return I[F]})}function Fn(I,$){return I.has($)}function Ou(I,$){for(var F=-1,U=I.length;++F<U&&Ki($,I[F],0)>-1;);return F}function Ru(I,$){for(var F=I.length;F--&&Ki($,I[F],0)>-1;);return F}function od(I,$){for(var F=I.length,U=0;F--;)I[F]===$&&++U;return U}var ad=Ea(v),cd=Ea(E);function ud(I){return"\\"+j[I]}function hd(I,$){return I==null?r:I[$]}function Gi(I){return $s.test(I)}function ld(I){return pi.test(I)}function fd(I){for(var $,F=[];!($=I.next()).done;)F.push($.value);return F}function Sa(I){var $=-1,F=Array(I.size);return I.forEach(function(U,te){F[++$]=[te,U]}),F}function Tu(I,$){return function(F){return I($(F))}}function Kr(I,$){for(var F=-1,U=I.length,te=0,ve=[];++F<U;){var Ke=I[F];(Ke===$||Ke===m)&&(I[F]=m,ve[te++]=F)}return ve}function Ts(I){var $=-1,F=Array(I.size);return I.forEach(function(U){F[++$]=U}),F}function pd(I){var $=-1,F=Array(I.size);return I.forEach(function(U){F[++$]=[U,U]}),F}function dd(I,$,F){for(var U=F-1,te=I.length;++U<te;)if(I[U]===$)return U;return-1}function gd(I,$,F){for(var U=F+1;U--;)if(I[U]===$)return U;return U}function Wi(I){return Gi(I)?md(I):ed(I)}function Xt(I){return Gi(I)?vd(I):td(I)}function Nu(I){for(var $=I.length;$--&&ls.test(I.charAt($)););return $}var yd=Ea(R);function md(I){for(var $=Vi.lastIndex=0;Vi.test(I);)++$;return $}function vd(I){return I.match(Vi)||[]}function wd(I){return I.match(As)||[]}var bd=function I($){$=$==null?ye:Ji.defaults(ye.Object(),$,Ji.pick(ye,Cs));var F=$.Array,U=$.Date,te=$.Error,ve=$.Function,Ke=$.Math,Fe=$.Object,Fa=$.RegExp,_d=$.String,kt=$.TypeError,Ns=F.prototype,Ed=ve.prototype,Qi=Fe.prototype,Ds=$["__core-js_shared__"],qs=Ed.toString,Ee=Qi.hasOwnProperty,Id=0,Du=function(){var e=/[^.]+$/.exec(Ds&&Ds.keys&&Ds.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),zs=Qi.toString,Pd=qs.call(Fe),xd=ye._,Sd=Fa("^"+qs.call(Ee).replace(bn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bs=dt?$.Buffer:r,Gr=$.Symbol,js=$.Uint8Array,qu=Bs?Bs.allocUnsafe:r,Ls=Tu(Fe.getPrototypeOf,Fe),zu=Fe.create,Bu=Qi.propertyIsEnumerable,Us=Ns.splice,ju=Gr?Gr.isConcatSpreadable:r,An=Gr?Gr.iterator:r,gi=Gr?Gr.toStringTag:r,Ms=function(){try{var e=bi(Fe,"defineProperty");return e({},"",{}),e}catch{}}(),Fd=$.clearTimeout!==ye.clearTimeout&&$.clearTimeout,Ad=U&&U.now!==ye.Date.now&&U.now,$d=$.setTimeout!==ye.setTimeout&&$.setTimeout,ks=Ke.ceil,Hs=Ke.floor,Aa=Fe.getOwnPropertySymbols,Cd=Bs?Bs.isBuffer:r,Lu=$.isFinite,Od=Ns.join,Rd=Tu(Fe.keys,Fe),Ge=Ke.max,st=Ke.min,Td=U.now,Nd=$.parseInt,Uu=Ke.random,Dd=Ns.reverse,$a=bi($,"DataView"),$n=bi($,"Map"),Ca=bi($,"Promise"),Yi=bi($,"Set"),Cn=bi($,"WeakMap"),On=bi(Fe,"create"),Vs=Cn&&new Cn,Zi={},qd=_i($a),zd=_i($n),Bd=_i(Ca),jd=_i(Yi),Ld=_i(Cn),Ks=Gr?Gr.prototype:r,Rn=Ks?Ks.valueOf:r,Mu=Ks?Ks.toString:r;function f(e){if(ze(e)&&!ne(e)&&!(e instanceof ge)){if(e instanceof Ht)return e;if(Ee.call(e,"__wrapped__"))return kh(e)}return new Ht(e)}var Xi=function(){function e(){}return function(i){if(!De(i))return{};if(zu)return zu(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function Gs(){}function Ht(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}f.templateSettings={escape:vn,evaluate:wn,interpolate:Bi,variable:"",imports:{_:f}},f.prototype=Gs.prototype,f.prototype.constructor=f,Ht.prototype=Xi(Gs.prototype),Ht.prototype.constructor=Ht;function ge(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ae,this.__views__=[]}function Ud(){var e=new ge(this.__wrapped__);return e.__actions__=gt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=gt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=gt(this.__views__),e}function Md(){if(this.__filtered__){var e=new ge(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function kd(){var e=this.__wrapped__.value(),i=this.__dir__,o=ne(e),c=i<0,l=o?e.length:0,g=ty(0,l,this.__views__),w=g.start,_=g.end,P=_-w,C=c?_:w-1,O=this.__iteratees__,N=O.length,z=0,H=st(P,this.__takeCount__);if(!o||!c&&l==P&&H==P)return fh(e,this.__actions__);var Z=[];e:for(;P--&&z<H;){C+=i;for(var ce=-1,X=e[C];++ce<N;){var pe=O[ce],me=pe.iteratee,Nt=pe.type,pt=me(X);if(Nt==ee)X=pt;else if(!pt){if(Nt==jr)continue e;break e}}Z[z++]=X}return Z}ge.prototype=Xi(Gs.prototype),ge.prototype.constructor=ge;function yi(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function Hd(){this.__data__=On?On(null):{},this.size=0}function Vd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Kd(e){var i=this.__data__;if(On){var o=i[e];return o===p?r:o}return Ee.call(i,e)?i[e]:r}function Gd(e){var i=this.__data__;return On?i[e]!==r:Ee.call(i,e)}function Wd(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=On&&i===r?p:i,this}yi.prototype.clear=Hd,yi.prototype.delete=Vd,yi.prototype.get=Kd,yi.prototype.has=Gd,yi.prototype.set=Wd;function xr(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function Jd(){this.__data__=[],this.size=0}function Qd(e){var i=this.__data__,o=Ws(i,e);if(o<0)return!1;var c=i.length-1;return o==c?i.pop():Us.call(i,o,1),--this.size,!0}function Yd(e){var i=this.__data__,o=Ws(i,e);return o<0?r:i[o][1]}function Zd(e){return Ws(this.__data__,e)>-1}function Xd(e,i){var o=this.__data__,c=Ws(o,e);return c<0?(++this.size,o.push([e,i])):o[c][1]=i,this}xr.prototype.clear=Jd,xr.prototype.delete=Qd,xr.prototype.get=Yd,xr.prototype.has=Zd,xr.prototype.set=Xd;function Sr(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function eg(){this.size=0,this.__data__={hash:new yi,map:new($n||xr),string:new yi}}function tg(e){var i=oo(this,e).delete(e);return this.size-=i?1:0,i}function rg(e){return oo(this,e).get(e)}function ig(e){return oo(this,e).has(e)}function ng(e,i){var o=oo(this,e),c=o.size;return o.set(e,i),this.size+=o.size==c?0:1,this}Sr.prototype.clear=eg,Sr.prototype.delete=tg,Sr.prototype.get=rg,Sr.prototype.has=ig,Sr.prototype.set=ng;function mi(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new Sr;++i<o;)this.add(e[i])}function sg(e){return this.__data__.set(e,p),this}function og(e){return this.__data__.has(e)}mi.prototype.add=mi.prototype.push=sg,mi.prototype.has=og;function er(e){var i=this.__data__=new xr(e);this.size=i.size}function ag(){this.__data__=new xr,this.size=0}function cg(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function ug(e){return this.__data__.get(e)}function hg(e){return this.__data__.has(e)}function lg(e,i){var o=this.__data__;if(o instanceof xr){var c=o.__data__;if(!$n||c.length<a-1)return c.push([e,i]),this.size=++o.size,this;o=this.__data__=new Sr(c)}return o.set(e,i),this.size=o.size,this}er.prototype.clear=ag,er.prototype.delete=cg,er.prototype.get=ug,er.prototype.has=hg,er.prototype.set=lg;function ku(e,i){var o=ne(e),c=!o&&Ei(e),l=!o&&!c&&Zr(e),g=!o&&!c&&!l&&nn(e),w=o||c||l||g,_=w?Pa(e.length,_d):[],P=_.length;for(var C in e)(i||Ee.call(e,C))&&!(w&&(C=="length"||l&&(C=="offset"||C=="parent")||g&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||Cr(C,P)))&&_.push(C);return _}function Hu(e){var i=e.length;return i?e[Ua(0,i-1)]:r}function fg(e,i){return ao(gt(e),vi(i,0,e.length))}function pg(e){return ao(gt(e))}function Oa(e,i,o){(o!==r&&!tr(e[i],o)||o===r&&!(i in e))&&Fr(e,i,o)}function Tn(e,i,o){var c=e[i];(!(Ee.call(e,i)&&tr(c,o))||o===r&&!(i in e))&&Fr(e,i,o)}function Ws(e,i){for(var o=e.length;o--;)if(tr(e[o][0],i))return o;return-1}function dg(e,i,o,c){return Wr(e,function(l,g,w){i(c,l,o(l),w)}),c}function Vu(e,i){return e&&pr(i,Qe(i),e)}function gg(e,i){return e&&pr(i,mt(i),e)}function Fr(e,i,o){i=="__proto__"&&Ms?Ms(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function Ra(e,i){for(var o=-1,c=i.length,l=F(c),g=e==null;++o<c;)l[o]=g?r:fc(e,i[o]);return l}function vi(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Vt(e,i,o,c,l,g){var w,_=i&b,P=i&x,C=i&A;if(o&&(w=l?o(e,c,l,g):o(e)),w!==r)return w;if(!De(e))return e;var O=ne(e);if(O){if(w=iy(e),!_)return gt(e,w)}else{var N=ot(e),z=N==At||N==Lr;if(Zr(e))return gh(e,_);if(N==$t||N==Y||z&&!l){if(w=P||z?{}:Nh(e),!_)return P?Kg(e,gg(w,e)):Vg(e,Vu(w,e))}else{if(!Ie[N])return l?e:{};w=ny(e,N,_)}}g||(g=new er);var H=g.get(e);if(H)return H;g.set(e,w),ul(e)?e.forEach(function(X){w.add(Vt(X,i,o,X,e,g))}):al(e)&&e.forEach(function(X,pe){w.set(pe,Vt(X,i,o,pe,e,g))});var Z=C?P?Za:Ya:P?mt:Qe,ce=O?r:Z(e);return Mt(ce||e,function(X,pe){ce&&(pe=X,X=e[pe]),Tn(w,pe,Vt(X,i,o,pe,e,g))}),w}function yg(e){var i=Qe(e);return function(o){return Ku(o,e,i)}}function Ku(e,i,o){var c=o.length;if(e==null)return!c;for(e=Fe(e);c--;){var l=o[c],g=i[l],w=e[l];if(w===r&&!(l in e)||!g(w))return!1}return!0}function Gu(e,i,o){if(typeof e!="function")throw new kt(h);return Ln(function(){e.apply(r,o)},i)}function Nn(e,i,o,c){var l=-1,g=Os,w=!0,_=e.length,P=[],C=i.length;if(!_)return P;o&&(i=Te(i,Ot(o))),c?(g=va,w=!1):i.length>=a&&(g=Fn,w=!1,i=new mi(i));e:for(;++l<_;){var O=e[l],N=o==null?O:o(O);if(O=c||O!==0?O:0,w&&N===N){for(var z=C;z--;)if(i[z]===N)continue e;P.push(O)}else g(i,N,c)||P.push(O)}return P}var Wr=bh(fr),Wu=bh(Na,!0);function mg(e,i){var o=!0;return Wr(e,function(c,l,g){return o=!!i(c,l,g),o}),o}function Js(e,i,o){for(var c=-1,l=e.length;++c<l;){var g=e[c],w=i(g);if(w!=null&&(_===r?w===w&&!Tt(w):o(w,_)))var _=w,P=g}return P}function vg(e,i,o,c){var l=e.length;for(o=se(o),o<0&&(o=-o>l?0:l+o),c=c===r||c>l?l:se(c),c<0&&(c+=l),c=o>c?0:ll(c);o<c;)e[o++]=i;return e}function Ju(e,i){var o=[];return Wr(e,function(c,l,g){i(c,l,g)&&o.push(c)}),o}function tt(e,i,o,c,l){var g=-1,w=e.length;for(o||(o=oy),l||(l=[]);++g<w;){var _=e[g];i>0&&o(_)?i>1?tt(_,i-1,o,c,l):Vr(l,_):c||(l[l.length]=_)}return l}var Ta=_h(),Qu=_h(!0);function fr(e,i){return e&&Ta(e,i,Qe)}function Na(e,i){return e&&Qu(e,i,Qe)}function Qs(e,i){return Hr(i,function(o){return Or(e[o])})}function wi(e,i){i=Qr(i,e);for(var o=0,c=i.length;e!=null&&o<c;)e=e[dr(i[o++])];return o&&o==c?e:r}function Yu(e,i,o){var c=i(e);return ne(e)?c:Vr(c,o(e))}function lt(e){return e==null?e===r?Oi:gn:gi&&gi in Fe(e)?ey(e):py(e)}function Da(e,i){return e>i}function wg(e,i){return e!=null&&Ee.call(e,i)}function bg(e,i){return e!=null&&i in Fe(e)}function _g(e,i,o){return e>=st(i,o)&&e<Ge(i,o)}function qa(e,i,o){for(var c=o?va:Os,l=e[0].length,g=e.length,w=g,_=F(g),P=1/0,C=[];w--;){var O=e[w];w&&i&&(O=Te(O,Ot(i))),P=st(O.length,P),_[w]=!o&&(i||l>=120&&O.length>=120)?new mi(w&&O):r}O=e[0];var N=-1,z=_[0];e:for(;++N<l&&C.length<P;){var H=O[N],Z=i?i(H):H;if(H=o||H!==0?H:0,!(z?Fn(z,Z):c(C,Z,o))){for(w=g;--w;){var ce=_[w];if(!(ce?Fn(ce,Z):c(e[w],Z,o)))continue e}z&&z.push(Z),C.push(H)}}return C}function Eg(e,i,o,c){return fr(e,function(l,g,w){i(c,o(l),g,w)}),c}function Dn(e,i,o){i=Qr(i,e),e=Bh(e,i);var c=e==null?e:e[dr(Gt(i))];return c==null?r:Je(c,e,o)}function Zu(e){return ze(e)&&lt(e)==Y}function Ig(e){return ze(e)&&lt(e)==Bt}function Pg(e){return ze(e)&&lt(e)==Be}function qn(e,i,o,c,l){return e===i?!0:e==null||i==null||!ze(e)&&!ze(i)?e!==e&&i!==i:xg(e,i,o,c,qn,l)}function xg(e,i,o,c,l,g){var w=ne(e),_=ne(i),P=w?qe:ot(e),C=_?qe:ot(i);P=P==Y?$t:P,C=C==Y?$t:C;var O=P==$t,N=C==$t,z=P==C;if(z&&Zr(e)){if(!Zr(i))return!1;w=!0,O=!1}if(z&&!O)return g||(g=new er),w||nn(e)?Oh(e,i,o,c,l,g):Zg(e,i,P,o,c,l,g);if(!(o&S)){var H=O&&Ee.call(e,"__wrapped__"),Z=N&&Ee.call(i,"__wrapped__");if(H||Z){var ce=H?e.value():e,X=Z?i.value():i;return g||(g=new er),l(ce,X,o,c,g)}}return z?(g||(g=new er),Xg(e,i,o,c,l,g)):!1}function Sg(e){return ze(e)&&ot(e)==Xe}function za(e,i,o,c){var l=o.length,g=l,w=!c;if(e==null)return!g;for(e=Fe(e);l--;){var _=o[l];if(w&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<g;){_=o[l];var P=_[0],C=e[P],O=_[1];if(w&&_[2]){if(C===r&&!(P in e))return!1}else{var N=new er;if(c)var z=c(C,O,P,e,i,N);if(!(z===r?qn(O,C,S|D,c,N):z))return!1}}return!0}function Xu(e){if(!De(e)||cy(e))return!1;var i=Or(e)?Sd:ra;return i.test(_i(e))}function Fg(e){return ze(e)&&lt(e)==ar}function Ag(e){return ze(e)&&ot(e)==et}function $g(e){return ze(e)&&po(e.length)&&!!Pe[lt(e)]}function eh(e){return typeof e=="function"?e:e==null?vt:typeof e=="object"?ne(e)?ih(e[0],e[1]):rh(e):El(e)}function Ba(e){if(!jn(e))return Rd(e);var i=[];for(var o in Fe(e))Ee.call(e,o)&&o!="constructor"&&i.push(o);return i}function Cg(e){if(!De(e))return fy(e);var i=jn(e),o=[];for(var c in e)c=="constructor"&&(i||!Ee.call(e,c))||o.push(c);return o}function ja(e,i){return e<i}function th(e,i){var o=-1,c=yt(e)?F(e.length):[];return Wr(e,function(l,g,w){c[++o]=i(l,g,w)}),c}function rh(e){var i=ec(e);return i.length==1&&i[0][2]?qh(i[0][0],i[0][1]):function(o){return o===e||za(o,e,i)}}function ih(e,i){return rc(e)&&Dh(i)?qh(dr(e),i):function(o){var c=fc(o,e);return c===r&&c===i?pc(o,e):qn(i,c,S|D)}}function Ys(e,i,o,c,l){e!==i&&Ta(i,function(g,w){if(l||(l=new er),De(g))Og(e,i,w,o,Ys,c,l);else{var _=c?c(nc(e,w),g,w+"",e,i,l):r;_===r&&(_=g),Oa(e,w,_)}},mt)}function Og(e,i,o,c,l,g,w){var _=nc(e,o),P=nc(i,o),C=w.get(P);if(C){Oa(e,o,C);return}var O=g?g(_,P,o+"",e,i,w):r,N=O===r;if(N){var z=ne(P),H=!z&&Zr(P),Z=!z&&!H&&nn(P);O=P,z||H||Z?ne(_)?O=_:Le(_)?O=gt(_):H?(N=!1,O=gh(P,!0)):Z?(N=!1,O=yh(P,!0)):O=[]:Un(P)||Ei(P)?(O=_,Ei(_)?O=fl(_):(!De(_)||Or(_))&&(O=Nh(P))):N=!1}N&&(w.set(P,O),l(O,P,c,g,w),w.delete(P)),Oa(e,o,O)}function nh(e,i){var o=e.length;if(o)return i+=i<0?o:0,Cr(i,o)?e[i]:r}function sh(e,i,o){i.length?i=Te(i,function(g){return ne(g)?function(w){return wi(w,g.length===1?g[0]:g)}:g}):i=[vt];var c=-1;i=Te(i,Ot(J()));var l=th(e,function(g,w,_){var P=Te(i,function(C){return C(g)});return{criteria:P,index:++c,value:g}});return nd(l,function(g,w){return Hg(g,w,o)})}function Rg(e,i){return oh(e,i,function(o,c){return pc(e,c)})}function oh(e,i,o){for(var c=-1,l=i.length,g={};++c<l;){var w=i[c],_=wi(e,w);o(_,w)&&zn(g,Qr(w,e),_)}return g}function Tg(e){return function(i){return wi(i,e)}}function La(e,i,o,c){var l=c?id:Ki,g=-1,w=i.length,_=e;for(e===i&&(i=gt(i)),o&&(_=Te(e,Ot(o)));++g<w;)for(var P=0,C=i[g],O=o?o(C):C;(P=l(_,O,P,c))>-1;)_!==e&&Us.call(_,P,1),Us.call(e,P,1);return e}function ah(e,i){for(var o=e?i.length:0,c=o-1;o--;){var l=i[o];if(o==c||l!==g){var g=l;Cr(l)?Us.call(e,l,1):Ha(e,l)}}return e}function Ua(e,i){return e+Hs(Uu()*(i-e+1))}function Ng(e,i,o,c){for(var l=-1,g=Ge(ks((i-e)/(o||1)),0),w=F(g);g--;)w[c?g:++l]=e,e+=o;return w}function Ma(e,i){var o="";if(!e||i<1||i>K)return o;do i%2&&(o+=e),i=Hs(i/2),i&&(e+=e);while(i);return o}function he(e,i){return sc(zh(e,i,vt),e+"")}function Dg(e){return Hu(sn(e))}function qg(e,i){var o=sn(e);return ao(o,vi(i,0,o.length))}function zn(e,i,o,c){if(!De(e))return e;i=Qr(i,e);for(var l=-1,g=i.length,w=g-1,_=e;_!=null&&++l<g;){var P=dr(i[l]),C=o;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=w){var O=_[P];C=c?c(O,P,_):r,C===r&&(C=De(O)?O:Cr(i[l+1])?[]:{})}Tn(_,P,C),_=_[P]}return e}var ch=Vs?function(e,i){return Vs.set(e,i),e}:vt,zg=Ms?function(e,i){return Ms(e,"toString",{configurable:!0,enumerable:!1,value:gc(i),writable:!0})}:vt;function Bg(e){return ao(sn(e))}function Kt(e,i,o){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),o=o>l?l:o,o<0&&(o+=l),l=i>o?0:o-i>>>0,i>>>=0;for(var g=F(l);++c<l;)g[c]=e[c+i];return g}function jg(e,i){var o;return Wr(e,function(c,l,g){return o=i(c,l,g),!o}),!!o}function Zs(e,i,o){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=be){for(;c<l;){var g=c+l>>>1,w=e[g];w!==null&&!Tt(w)&&(o?w<=i:w<i)?c=g+1:l=g}return l}return ka(e,i,vt,o)}function ka(e,i,o,c){var l=0,g=e==null?0:e.length;if(g===0)return 0;i=o(i);for(var w=i!==i,_=i===null,P=Tt(i),C=i===r;l<g;){var O=Hs((l+g)/2),N=o(e[O]),z=N!==r,H=N===null,Z=N===N,ce=Tt(N);if(w)var X=c||Z;else C?X=Z&&(c||z):_?X=Z&&z&&(c||!H):P?X=Z&&z&&!H&&(c||!ce):H||ce?X=!1:X=c?N<=i:N<i;X?l=O+1:g=O}return st(g,Ae)}function uh(e,i){for(var o=-1,c=e.length,l=0,g=[];++o<c;){var w=e[o],_=i?i(w):w;if(!o||!tr(_,P)){var P=_;g[l++]=w===0?0:w}}return g}function hh(e){return typeof e=="number"?e:Tt(e)?fe:+e}function Rt(e){if(typeof e=="string")return e;if(ne(e))return Te(e,Rt)+"";if(Tt(e))return Mu?Mu.call(e):"";var i=e+"";return i=="0"&&1/e==-V?"-0":i}function Jr(e,i,o){var c=-1,l=Os,g=e.length,w=!0,_=[],P=_;if(o)w=!1,l=va;else if(g>=a){var C=i?null:Qg(e);if(C)return Ts(C);w=!1,l=Fn,P=new mi}else P=i?[]:_;e:for(;++c<g;){var O=e[c],N=i?i(O):O;if(O=o||O!==0?O:0,w&&N===N){for(var z=P.length;z--;)if(P[z]===N)continue e;i&&P.push(N),_.push(O)}else l(P,N,o)||(P!==_&&P.push(N),_.push(O))}return _}function Ha(e,i){return i=Qr(i,e),e=Bh(e,i),e==null||delete e[dr(Gt(i))]}function lh(e,i,o,c){return zn(e,i,o(wi(e,i)),c)}function Xs(e,i,o,c){for(var l=e.length,g=c?l:-1;(c?g--:++g<l)&&i(e[g],g,e););return o?Kt(e,c?0:g,c?g+1:l):Kt(e,c?g+1:0,c?l:g)}function fh(e,i){var o=e;return o instanceof ge&&(o=o.value()),wa(i,function(c,l){return l.func.apply(l.thisArg,Vr([c],l.args))},o)}function Va(e,i,o){var c=e.length;if(c<2)return c?Jr(e[0]):[];for(var l=-1,g=F(c);++l<c;)for(var w=e[l],_=-1;++_<c;)_!=l&&(g[l]=Nn(g[l]||w,e[_],i,o));return Jr(tt(g,1),i,o)}function ph(e,i,o){for(var c=-1,l=e.length,g=i.length,w={};++c<l;){var _=c<g?i[c]:r;o(w,e[c],_)}return w}function Ka(e){return Le(e)?e:[]}function Ga(e){return typeof e=="function"?e:vt}function Qr(e,i){return ne(e)?e:rc(e,i)?[e]:Mh(_e(e))}var Lg=he;function Yr(e,i,o){var c=e.length;return o=o===r?c:o,!i&&o>=c?e:Kt(e,i,o)}var dh=Fd||function(e){return ye.clearTimeout(e)};function gh(e,i){if(i)return e.slice();var o=e.length,c=qu?qu(o):new e.constructor(o);return e.copy(c),c}function Wa(e){var i=new e.constructor(e.byteLength);return new js(i).set(new js(e)),i}function Ug(e,i){var o=i?Wa(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function Mg(e){var i=new e.constructor(e.source,Lt.exec(e));return i.lastIndex=e.lastIndex,i}function kg(e){return Rn?Fe(Rn.call(e)):{}}function yh(e,i){var o=i?Wa(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function mh(e,i){if(e!==i){var o=e!==r,c=e===null,l=e===e,g=Tt(e),w=i!==r,_=i===null,P=i===i,C=Tt(i);if(!_&&!C&&!g&&e>i||g&&w&&P&&!_&&!C||c&&w&&P||!o&&P||!l)return 1;if(!c&&!g&&!C&&e<i||C&&o&&l&&!c&&!g||_&&o&&l||!w&&l||!P)return-1}return 0}function Hg(e,i,o){for(var c=-1,l=e.criteria,g=i.criteria,w=l.length,_=o.length;++c<w;){var P=mh(l[c],g[c]);if(P){if(c>=_)return P;var C=o[c];return P*(C=="desc"?-1:1)}}return e.index-i.index}function vh(e,i,o,c){for(var l=-1,g=e.length,w=o.length,_=-1,P=i.length,C=Ge(g-w,0),O=F(P+C),N=!c;++_<P;)O[_]=i[_];for(;++l<w;)(N||l<g)&&(O[o[l]]=e[l]);for(;C--;)O[_++]=e[l++];return O}function wh(e,i,o,c){for(var l=-1,g=e.length,w=-1,_=o.length,P=-1,C=i.length,O=Ge(g-_,0),N=F(O+C),z=!c;++l<O;)N[l]=e[l];for(var H=l;++P<C;)N[H+P]=i[P];for(;++w<_;)(z||l<g)&&(N[H+o[w]]=e[l++]);return N}function gt(e,i){var o=-1,c=e.length;for(i||(i=F(c));++o<c;)i[o]=e[o];return i}function pr(e,i,o,c){var l=!o;o||(o={});for(var g=-1,w=i.length;++g<w;){var _=i[g],P=c?c(o[_],e[_],_,o,e):r;P===r&&(P=e[_]),l?Fr(o,_,P):Tn(o,_,P)}return o}function Vg(e,i){return pr(e,tc(e),i)}function Kg(e,i){return pr(e,Rh(e),i)}function eo(e,i){return function(o,c){var l=ne(o)?Yp:dg,g=i?i():{};return l(o,e,J(c,2),g)}}function en(e){return he(function(i,o){var c=-1,l=o.length,g=l>1?o[l-1]:r,w=l>2?o[2]:r;for(g=e.length>3&&typeof g=="function"?(l--,g):r,w&&ft(o[0],o[1],w)&&(g=l<3?r:g,l=1),i=Fe(i);++c<l;){var _=o[c];_&&e(i,_,c,g)}return i})}function bh(e,i){return function(o,c){if(o==null)return o;if(!yt(o))return e(o,c);for(var l=o.length,g=i?l:-1,w=Fe(o);(i?g--:++g<l)&&c(w[g],g,w)!==!1;);return o}}function _h(e){return function(i,o,c){for(var l=-1,g=Fe(i),w=c(i),_=w.length;_--;){var P=w[e?_:++l];if(o(g[P],P,g)===!1)break}return i}}function Gg(e,i,o){var c=i&k,l=Bn(e);function g(){var w=this&&this!==ye&&this instanceof g?l:e;return w.apply(c?o:this,arguments)}return g}function Eh(e){return function(i){i=_e(i);var o=Gi(i)?Xt(i):r,c=o?o[0]:i.charAt(0),l=o?Yr(o,1).join(""):i.slice(1);return c[e]()+l}}function tn(e){return function(i){return wa(bl(wl(i).replace(xn,"")),e,"")}}function Bn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=Xi(e.prototype),c=e.apply(o,i);return De(c)?c:o}}function Wg(e,i,o){var c=Bn(e);function l(){for(var g=arguments.length,w=F(g),_=g,P=rn(l);_--;)w[_]=arguments[_];var C=g<3&&w[0]!==P&&w[g-1]!==P?[]:Kr(w,P);if(g-=C.length,g<o)return Fh(e,i,to,l.placeholder,r,w,C,r,r,o-g);var O=this&&this!==ye&&this instanceof l?c:e;return Je(O,this,w)}return l}function Ih(e){return function(i,o,c){var l=Fe(i);if(!yt(i)){var g=J(o,3);i=Qe(i),o=function(_){return g(l[_],_,l)}}var w=e(i,o,c);return w>-1?l[g?i[w]:w]:r}}function Ph(e){return $r(function(i){var o=i.length,c=o,l=Ht.prototype.thru;for(e&&i.reverse();c--;){var g=i[c];if(typeof g!="function")throw new kt(h);if(l&&!w&&so(g)=="wrapper")var w=new Ht([],!0)}for(c=w?c:o;++c<o;){g=i[c];var _=so(g),P=_=="wrapper"?Xa(g):r;P&&ic(P[0])&&P[1]==(re|T|W|oe)&&!P[4].length&&P[9]==1?w=w[so(P[0])].apply(w,P[3]):w=g.length==1&&ic(g)?w[_]():w.thru(g)}return function(){var C=arguments,O=C[0];if(w&&C.length==1&&ne(O))return w.plant(O).value();for(var N=0,z=o?i[N].apply(this,C):O;++N<o;)z=i[N].call(this,z);return z}})}function to(e,i,o,c,l,g,w,_,P,C){var O=i&re,N=i&k,z=i&M,H=i&(T|B),Z=i&we,ce=z?r:Bn(e);function X(){for(var pe=arguments.length,me=F(pe),Nt=pe;Nt--;)me[Nt]=arguments[Nt];if(H)var pt=rn(X),Dt=od(me,pt);if(c&&(me=vh(me,c,l,H)),g&&(me=wh(me,g,w,H)),pe-=Dt,H&&pe<C){var Ue=Kr(me,pt);return Fh(e,i,to,X.placeholder,o,me,Ue,_,P,C-pe)}var rr=N?o:this,Tr=z?rr[e]:e;return pe=me.length,_?me=dy(me,_):Z&&pe>1&&me.reverse(),O&&P<pe&&(me.length=P),this&&this!==ye&&this instanceof X&&(Tr=ce||Bn(Tr)),Tr.apply(rr,me)}return X}function xh(e,i){return function(o,c){return Eg(o,e,i(c),{})}}function ro(e,i){return function(o,c){var l;if(o===r&&c===r)return i;if(o!==r&&(l=o),c!==r){if(l===r)return c;typeof o=="string"||typeof c=="string"?(o=Rt(o),c=Rt(c)):(o=hh(o),c=hh(c)),l=e(o,c)}return l}}function Ja(e){return $r(function(i){return i=Te(i,Ot(J())),he(function(o){var c=this;return e(i,function(l){return Je(l,c,o)})})})}function io(e,i){i=i===r?" ":Rt(i);var o=i.length;if(o<2)return o?Ma(i,e):i;var c=Ma(i,ks(e/Wi(i)));return Gi(i)?Yr(Xt(c),0,e).join(""):c.slice(0,e)}function Jg(e,i,o,c){var l=i&k,g=Bn(e);function w(){for(var _=-1,P=arguments.length,C=-1,O=c.length,N=F(O+P),z=this&&this!==ye&&this instanceof w?g:e;++C<O;)N[C]=c[C];for(;P--;)N[C++]=arguments[++_];return Je(z,l?o:this,N)}return w}function Sh(e){return function(i,o,c){return c&&typeof c!="number"&&ft(i,o,c)&&(o=c=r),i=Rr(i),o===r?(o=i,i=0):o=Rr(o),c=c===r?i<o?1:-1:Rr(c),Ng(i,o,c,e)}}function no(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=Wt(i),o=Wt(o)),e(i,o)}}function Fh(e,i,o,c,l,g,w,_,P,C){var O=i&T,N=O?w:r,z=O?r:w,H=O?g:r,Z=O?r:g;i|=O?W:le,i&=~(O?le:W),i&Q||(i&=~(k|M));var ce=[e,i,l,H,N,Z,z,_,P,C],X=o.apply(r,ce);return ic(e)&&jh(X,ce),X.placeholder=c,Lh(X,e,i)}function Qa(e){var i=Ke[e];return function(o,c){if(o=Wt(o),c=c==null?0:st(se(c),292),c&&Lu(o)){var l=(_e(o)+"e").split("e"),g=i(l[0]+"e"+(+l[1]+c));return l=(_e(g)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(o)}}var Qg=Yi&&1/Ts(new Yi([,-0]))[1]==V?function(e){return new Yi(e)}:vc;function Ah(e){return function(i){var o=ot(i);return o==Xe?Sa(i):o==et?pd(i):sd(i,e(i))}}function Ar(e,i,o,c,l,g,w,_){var P=i&M;if(!P&&typeof e!="function")throw new kt(h);var C=c?c.length:0;if(C||(i&=~(W|le),c=l=r),w=w===r?w:Ge(se(w),0),_=_===r?_:se(_),C-=l?l.length:0,i&le){var O=c,N=l;c=l=r}var z=P?r:Xa(e),H=[e,i,o,c,l,O,N,g,w,_];if(z&&ly(H,z),e=H[0],i=H[1],o=H[2],c=H[3],l=H[4],_=H[9]=H[9]===r?P?0:e.length:Ge(H[9]-C,0),!_&&i&(T|B)&&(i&=~(T|B)),!i||i==k)var Z=Gg(e,i,o);else i==T||i==B?Z=Wg(e,i,_):(i==W||i==(k|W))&&!l.length?Z=Jg(e,i,o,c):Z=to.apply(r,H);var ce=z?ch:jh;return Lh(ce(Z,H),e,i)}function $h(e,i,o,c){return e===r||tr(e,Qi[o])&&!Ee.call(c,o)?i:e}function Ch(e,i,o,c,l,g){return De(e)&&De(i)&&(g.set(i,e),Ys(e,i,r,Ch,g),g.delete(i)),e}function Yg(e){return Un(e)?r:e}function Oh(e,i,o,c,l,g){var w=o&S,_=e.length,P=i.length;if(_!=P&&!(w&&P>_))return!1;var C=g.get(e),O=g.get(i);if(C&&O)return C==i&&O==e;var N=-1,z=!0,H=o&D?new mi:r;for(g.set(e,i),g.set(i,e);++N<_;){var Z=e[N],ce=i[N];if(c)var X=w?c(ce,Z,N,i,e,g):c(Z,ce,N,e,i,g);if(X!==r){if(X)continue;z=!1;break}if(H){if(!ba(i,function(pe,me){if(!Fn(H,me)&&(Z===pe||l(Z,pe,o,c,g)))return H.push(me)})){z=!1;break}}else if(!(Z===ce||l(Z,ce,o,c,g))){z=!1;break}}return g.delete(e),g.delete(i),z}function Zg(e,i,o,c,l,g,w){switch(o){case jt:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Bt:return!(e.byteLength!=i.byteLength||!g(new js(e),new js(i)));case Ce:case Be:case wr:return tr(+e,+i);case ut:return e.name==i.name&&e.message==i.message;case ar:case cr:return e==i+"";case Xe:var _=Sa;case et:var P=c&S;if(_||(_=Ts),e.size!=i.size&&!P)return!1;var C=w.get(e);if(C)return C==i;c|=D,w.set(e,i);var O=Oh(_(e),_(i),c,l,g,w);return w.delete(e),O;case br:if(Rn)return Rn.call(e)==Rn.call(i)}return!1}function Xg(e,i,o,c,l,g){var w=o&S,_=Ya(e),P=_.length,C=Ya(i),O=C.length;if(P!=O&&!w)return!1;for(var N=P;N--;){var z=_[N];if(!(w?z in i:Ee.call(i,z)))return!1}var H=g.get(e),Z=g.get(i);if(H&&Z)return H==i&&Z==e;var ce=!0;g.set(e,i),g.set(i,e);for(var X=w;++N<P;){z=_[N];var pe=e[z],me=i[z];if(c)var Nt=w?c(me,pe,z,i,e,g):c(pe,me,z,e,i,g);if(!(Nt===r?pe===me||l(pe,me,o,c,g):Nt)){ce=!1;break}X||(X=z=="constructor")}if(ce&&!X){var pt=e.constructor,Dt=i.constructor;pt!=Dt&&"constructor"in e&&"constructor"in i&&!(typeof pt=="function"&&pt instanceof pt&&typeof Dt=="function"&&Dt instanceof Dt)&&(ce=!1)}return g.delete(e),g.delete(i),ce}function $r(e){return sc(zh(e,r,Kh),e+"")}function Ya(e){return Yu(e,Qe,tc)}function Za(e){return Yu(e,mt,Rh)}var Xa=Vs?function(e){return Vs.get(e)}:vc;function so(e){for(var i=e.name+"",o=Zi[i],c=Ee.call(Zi,i)?o.length:0;c--;){var l=o[c],g=l.func;if(g==null||g==e)return l.name}return i}function rn(e){var i=Ee.call(f,"placeholder")?f:e;return i.placeholder}function J(){var e=f.iteratee||yc;return e=e===yc?eh:e,arguments.length?e(arguments[0],arguments[1]):e}function oo(e,i){var o=e.__data__;return ay(i)?o[typeof i=="string"?"string":"hash"]:o.map}function ec(e){for(var i=Qe(e),o=i.length;o--;){var c=i[o],l=e[c];i[o]=[c,l,Dh(l)]}return i}function bi(e,i){var o=hd(e,i);return Xu(o)?o:r}function ey(e){var i=Ee.call(e,gi),o=e[gi];try{e[gi]=r;var c=!0}catch{}var l=zs.call(e);return c&&(i?e[gi]=o:delete e[gi]),l}var tc=Aa?function(e){return e==null?[]:(e=Fe(e),Hr(Aa(e),function(i){return Bu.call(e,i)}))}:wc,Rh=Aa?function(e){for(var i=[];e;)Vr(i,tc(e)),e=Ls(e);return i}:wc,ot=lt;($a&&ot(new $a(new ArrayBuffer(1)))!=jt||$n&&ot(new $n)!=Xe||Ca&&ot(Ca.resolve())!=$i||Yi&&ot(new Yi)!=et||Cn&&ot(new Cn)!=ur)&&(ot=function(e){var i=lt(e),o=i==$t?e.constructor:r,c=o?_i(o):"";if(c)switch(c){case qd:return jt;case zd:return Xe;case Bd:return $i;case jd:return et;case Ld:return ur}return i});function ty(e,i,o){for(var c=-1,l=o.length;++c<l;){var g=o[c],w=g.size;switch(g.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=st(i,e+w);break;case"takeRight":e=Ge(e,i-w);break}}return{start:e,end:i}}function ry(e){var i=e.match(Er);return i?i[1].split(Jo):[]}function Th(e,i,o){i=Qr(i,e);for(var c=-1,l=i.length,g=!1;++c<l;){var w=dr(i[c]);if(!(g=e!=null&&o(e,w)))break;e=e[w]}return g||++c!=l?g:(l=e==null?0:e.length,!!l&&po(l)&&Cr(w,l)&&(ne(e)||Ei(e)))}function iy(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&Ee.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function Nh(e){return typeof e.constructor=="function"&&!jn(e)?Xi(Ls(e)):{}}function ny(e,i,o){var c=e.constructor;switch(i){case Bt:return Wa(e);case Ce:case Be:return new c(+e);case jt:return Ug(e,o);case Ur:case nt:case Ti:case Ni:case yn:case Di:case Mr:case qi:case zi:return yh(e,o);case Xe:return new c;case wr:case cr:return new c(e);case ar:return Mg(e);case et:return new c;case br:return kg(e)}}function sy(e,i){var o=i.length;if(!o)return e;var c=o-1;return i[c]=(o>1?"& ":"")+i[c],i=i.join(o>2?", ":" "),e.replace(En,`{
/* [wrapped with `+i+`] */
`)}function oy(e){return ne(e)||Ei(e)||!!(ju&&e&&e[ju])}function Cr(e,i){var o=typeof e;return i=i??K,!!i&&(o=="number"||o!="symbol"&&na.test(e))&&e>-1&&e%1==0&&e<i}function ft(e,i,o){if(!De(o))return!1;var c=typeof i;return(c=="number"?yt(o)&&Cr(i,o.length):c=="string"&&i in o)?tr(o[i],e):!1}function rc(e,i){if(ne(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||Tt(e)?!0:Ko.test(e)||!ui.test(e)||i!=null&&e in Fe(i)}function ay(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function ic(e){var i=so(e),o=f[i];if(typeof o!="function"||!(i in ge.prototype))return!1;if(e===o)return!0;var c=Xa(o);return!!c&&e===c[0]}function cy(e){return!!Du&&Du in e}var uy=Ds?Or:bc;function jn(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||Qi;return e===o}function Dh(e){return e===e&&!De(e)}function qh(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in Fe(o))}}function hy(e){var i=lo(e,function(c){return o.size===y&&o.clear(),c}),o=i.cache;return i}function ly(e,i){var o=e[1],c=i[1],l=o|c,g=l<(k|M|re),w=c==re&&o==T||c==re&&o==oe&&e[7].length<=i[8]||c==(re|oe)&&i[7].length<=i[8]&&o==T;if(!(g||w))return e;c&k&&(e[2]=i[2],l|=o&k?0:Q);var _=i[3];if(_){var P=e[3];e[3]=P?vh(P,_,i[4]):_,e[4]=P?Kr(e[3],m):i[4]}return _=i[5],_&&(P=e[5],e[5]=P?wh(P,_,i[6]):_,e[6]=P?Kr(e[5],m):i[6]),_=i[7],_&&(e[7]=_),c&re&&(e[8]=e[8]==null?i[8]:st(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function fy(e){var i=[];if(e!=null)for(var o in Fe(e))i.push(o);return i}function py(e){return zs.call(e)}function zh(e,i,o){return i=Ge(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,g=Ge(c.length-i,0),w=F(g);++l<g;)w[l]=c[i+l];l=-1;for(var _=F(i+1);++l<i;)_[l]=c[l];return _[i]=o(w),Je(e,this,_)}}function Bh(e,i){return i.length<2?e:wi(e,Kt(i,0,-1))}function dy(e,i){for(var o=e.length,c=st(i.length,o),l=gt(e);c--;){var g=i[c];e[c]=Cr(g,o)?l[g]:r}return e}function nc(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var jh=Uh(ch),Ln=$d||function(e,i){return ye.setTimeout(e,i)},sc=Uh(zg);function Lh(e,i,o){var c=i+"";return sc(e,sy(c,gy(ry(c),o)))}function Uh(e){var i=0,o=0;return function(){var c=Td(),l=vr-(c-o);if(o=c,l>0){if(++i>=xt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function ao(e,i){var o=-1,c=e.length,l=c-1;for(i=i===r?c:i;++o<i;){var g=Ua(o,l),w=e[g];e[g]=e[o],e[o]=w}return e.length=i,e}var Mh=hy(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Go,function(o,c,l,g){i.push(l?g.replace(Zo,"$1"):c||o)}),i});function dr(e){if(typeof e=="string"||Tt(e))return e;var i=e+"";return i=="0"&&1/e==-V?"-0":i}function _i(e){if(e!=null){try{return qs.call(e)}catch{}try{return e+""}catch{}}return""}function gy(e,i){return Mt($e,function(o){var c="_."+o[0];i&o[1]&&!Os(e,c)&&e.push(c)}),e.sort()}function kh(e){if(e instanceof ge)return e.clone();var i=new Ht(e.__wrapped__,e.__chain__);return i.__actions__=gt(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function yy(e,i,o){(o?ft(e,i,o):i===r)?i=1:i=Ge(se(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,g=0,w=F(ks(c/i));l<c;)w[g++]=Kt(e,l,l+=i);return w}function my(e){for(var i=-1,o=e==null?0:e.length,c=0,l=[];++i<o;){var g=e[i];g&&(l[c++]=g)}return l}function vy(){var e=arguments.length;if(!e)return[];for(var i=F(e-1),o=arguments[0],c=e;c--;)i[c-1]=arguments[c];return Vr(ne(o)?gt(o):[o],tt(i,1))}var wy=he(function(e,i){return Le(e)?Nn(e,tt(i,1,Le,!0)):[]}),by=he(function(e,i){var o=Gt(i);return Le(o)&&(o=r),Le(e)?Nn(e,tt(i,1,Le,!0),J(o,2)):[]}),_y=he(function(e,i){var o=Gt(i);return Le(o)&&(o=r),Le(e)?Nn(e,tt(i,1,Le,!0),r,o):[]});function Ey(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:se(i),Kt(e,i<0?0:i,c)):[]}function Iy(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:se(i),i=c-i,Kt(e,0,i<0?0:i)):[]}function Py(e,i){return e&&e.length?Xs(e,J(i,3),!0,!0):[]}function xy(e,i){return e&&e.length?Xs(e,J(i,3),!0):[]}function Sy(e,i,o,c){var l=e==null?0:e.length;return l?(o&&typeof o!="number"&&ft(e,i,o)&&(o=0,c=l),vg(e,i,o,c)):[]}function Hh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:se(o);return l<0&&(l=Ge(c+l,0)),Rs(e,J(i,3),l)}function Vh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return o!==r&&(l=se(o),l=o<0?Ge(c+l,0):st(l,c-1)),Rs(e,J(i,3),l,!0)}function Kh(e){var i=e==null?0:e.length;return i?tt(e,1):[]}function Fy(e){var i=e==null?0:e.length;return i?tt(e,V):[]}function Ay(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:se(i),tt(e,i)):[]}function $y(e){for(var i=-1,o=e==null?0:e.length,c={};++i<o;){var l=e[i];c[l[0]]=l[1]}return c}function Gh(e){return e&&e.length?e[0]:r}function Cy(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=o==null?0:se(o);return l<0&&(l=Ge(c+l,0)),Ki(e,i,l)}function Oy(e){var i=e==null?0:e.length;return i?Kt(e,0,-1):[]}var Ry=he(function(e){var i=Te(e,Ka);return i.length&&i[0]===e[0]?qa(i):[]}),Ty=he(function(e){var i=Gt(e),o=Te(e,Ka);return i===Gt(o)?i=r:o.pop(),o.length&&o[0]===e[0]?qa(o,J(i,2)):[]}),Ny=he(function(e){var i=Gt(e),o=Te(e,Ka);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?qa(o,r,i):[]});function Dy(e,i){return e==null?"":Od.call(e,i)}function Gt(e){var i=e==null?0:e.length;return i?e[i-1]:r}function qy(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var l=c;return o!==r&&(l=se(o),l=l<0?Ge(c+l,0):st(l,c-1)),i===i?gd(e,i,l):Rs(e,Fu,l,!0)}function zy(e,i){return e&&e.length?nh(e,se(i)):r}var By=he(Wh);function Wh(e,i){return e&&e.length&&i&&i.length?La(e,i):e}function jy(e,i,o){return e&&e.length&&i&&i.length?La(e,i,J(o,2)):e}function Ly(e,i,o){return e&&e.length&&i&&i.length?La(e,i,r,o):e}var Uy=$r(function(e,i){var o=e==null?0:e.length,c=Ra(e,i);return ah(e,Te(i,function(l){return Cr(l,o)?+l:l}).sort(mh)),c});function My(e,i){var o=[];if(!(e&&e.length))return o;var c=-1,l=[],g=e.length;for(i=J(i,3);++c<g;){var w=e[c];i(w,c,e)&&(o.push(w),l.push(c))}return ah(e,l),o}function oc(e){return e==null?e:Dd.call(e)}function ky(e,i,o){var c=e==null?0:e.length;return c?(o&&typeof o!="number"&&ft(e,i,o)?(i=0,o=c):(i=i==null?0:se(i),o=o===r?c:se(o)),Kt(e,i,o)):[]}function Hy(e,i){return Zs(e,i)}function Vy(e,i,o){return ka(e,i,J(o,2))}function Ky(e,i){var o=e==null?0:e.length;if(o){var c=Zs(e,i);if(c<o&&tr(e[c],i))return c}return-1}function Gy(e,i){return Zs(e,i,!0)}function Wy(e,i,o){return ka(e,i,J(o,2),!0)}function Jy(e,i){var o=e==null?0:e.length;if(o){var c=Zs(e,i,!0)-1;if(tr(e[c],i))return c}return-1}function Qy(e){return e&&e.length?uh(e):[]}function Yy(e,i){return e&&e.length?uh(e,J(i,2)):[]}function Zy(e){var i=e==null?0:e.length;return i?Kt(e,1,i):[]}function Xy(e,i,o){return e&&e.length?(i=o||i===r?1:se(i),Kt(e,0,i<0?0:i)):[]}function em(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:se(i),i=c-i,Kt(e,i<0?0:i,c)):[]}function tm(e,i){return e&&e.length?Xs(e,J(i,3),!1,!0):[]}function rm(e,i){return e&&e.length?Xs(e,J(i,3)):[]}var im=he(function(e){return Jr(tt(e,1,Le,!0))}),nm=he(function(e){var i=Gt(e);return Le(i)&&(i=r),Jr(tt(e,1,Le,!0),J(i,2))}),sm=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Jr(tt(e,1,Le,!0),r,i)});function om(e){return e&&e.length?Jr(e):[]}function am(e,i){return e&&e.length?Jr(e,J(i,2)):[]}function cm(e,i){return i=typeof i=="function"?i:r,e&&e.length?Jr(e,r,i):[]}function ac(e){if(!(e&&e.length))return[];var i=0;return e=Hr(e,function(o){if(Le(o))return i=Ge(o.length,i),!0}),Pa(i,function(o){return Te(e,_a(o))})}function Jh(e,i){if(!(e&&e.length))return[];var o=ac(e);return i==null?o:Te(o,function(c){return Je(i,r,c)})}var um=he(function(e,i){return Le(e)?Nn(e,i):[]}),hm=he(function(e){return Va(Hr(e,Le))}),lm=he(function(e){var i=Gt(e);return Le(i)&&(i=r),Va(Hr(e,Le),J(i,2))}),fm=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Va(Hr(e,Le),r,i)}),pm=he(ac);function dm(e,i){return ph(e||[],i||[],Tn)}function gm(e,i){return ph(e||[],i||[],zn)}var ym=he(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,Jh(e,o)});function Qh(e){var i=f(e);return i.__chain__=!0,i}function mm(e,i){return i(e),e}function co(e,i){return i(e)}var vm=$r(function(e){var i=e.length,o=i?e[0]:0,c=this.__wrapped__,l=function(g){return Ra(g,e)};return i>1||this.__actions__.length||!(c instanceof ge)||!Cr(o)?this.thru(l):(c=c.slice(o,+o+(i?1:0)),c.__actions__.push({func:co,args:[l],thisArg:r}),new Ht(c,this.__chain__).thru(function(g){return i&&!g.length&&g.push(r),g}))});function wm(){return Qh(this)}function bm(){return new Ht(this.value(),this.__chain__)}function _m(){this.__values__===r&&(this.__values__=hl(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Em(){return this}function Im(e){for(var i,o=this;o instanceof Gs;){var c=kh(o);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;o=o.__wrapped__}return l.__wrapped__=e,i}function Pm(){var e=this.__wrapped__;if(e instanceof ge){var i=e;return this.__actions__.length&&(i=new ge(this)),i=i.reverse(),i.__actions__.push({func:co,args:[oc],thisArg:r}),new Ht(i,this.__chain__)}return this.thru(oc)}function xm(){return fh(this.__wrapped__,this.__actions__)}var Sm=eo(function(e,i,o){Ee.call(e,o)?++e[o]:Fr(e,o,1)});function Fm(e,i,o){var c=ne(e)?xu:mg;return o&&ft(e,i,o)&&(i=r),c(e,J(i,3))}function Am(e,i){var o=ne(e)?Hr:Ju;return o(e,J(i,3))}var $m=Ih(Hh),Cm=Ih(Vh);function Om(e,i){return tt(uo(e,i),1)}function Rm(e,i){return tt(uo(e,i),V)}function Tm(e,i,o){return o=o===r?1:se(o),tt(uo(e,i),o)}function Yh(e,i){var o=ne(e)?Mt:Wr;return o(e,J(i,3))}function Zh(e,i){var o=ne(e)?Zp:Wu;return o(e,J(i,3))}var Nm=eo(function(e,i,o){Ee.call(e,o)?e[o].push(i):Fr(e,o,[i])});function Dm(e,i,o,c){e=yt(e)?e:sn(e),o=o&&!c?se(o):0;var l=e.length;return o<0&&(o=Ge(l+o,0)),go(e)?o<=l&&e.indexOf(i,o)>-1:!!l&&Ki(e,i,o)>-1}var qm=he(function(e,i,o){var c=-1,l=typeof i=="function",g=yt(e)?F(e.length):[];return Wr(e,function(w){g[++c]=l?Je(i,w,o):Dn(w,i,o)}),g}),zm=eo(function(e,i,o){Fr(e,o,i)});function uo(e,i){var o=ne(e)?Te:th;return o(e,J(i,3))}function Bm(e,i,o,c){return e==null?[]:(ne(i)||(i=i==null?[]:[i]),o=c?r:o,ne(o)||(o=o==null?[]:[o]),sh(e,i,o))}var jm=eo(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function Lm(e,i,o){var c=ne(e)?wa:$u,l=arguments.length<3;return c(e,J(i,4),o,l,Wr)}function Um(e,i,o){var c=ne(e)?Xp:$u,l=arguments.length<3;return c(e,J(i,4),o,l,Wu)}function Mm(e,i){var o=ne(e)?Hr:Ju;return o(e,fo(J(i,3)))}function km(e){var i=ne(e)?Hu:Dg;return i(e)}function Hm(e,i,o){(o?ft(e,i,o):i===r)?i=1:i=se(i);var c=ne(e)?fg:qg;return c(e,i)}function Vm(e){var i=ne(e)?pg:Bg;return i(e)}function Km(e){if(e==null)return 0;if(yt(e))return go(e)?Wi(e):e.length;var i=ot(e);return i==Xe||i==et?e.size:Ba(e).length}function Gm(e,i,o){var c=ne(e)?ba:jg;return o&&ft(e,i,o)&&(i=r),c(e,J(i,3))}var Wm=he(function(e,i){if(e==null)return[];var o=i.length;return o>1&&ft(e,i[0],i[1])?i=[]:o>2&&ft(i[0],i[1],i[2])&&(i=[i[0]]),sh(e,tt(i,1),[])}),ho=Ad||function(){return ye.Date.now()};function Jm(e,i){if(typeof i!="function")throw new kt(h);return e=se(e),function(){if(--e<1)return i.apply(this,arguments)}}function Xh(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,Ar(e,re,r,r,r,r,i)}function el(e,i){var o;if(typeof i!="function")throw new kt(h);return e=se(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var cc=he(function(e,i,o){var c=k;if(o.length){var l=Kr(o,rn(cc));c|=W}return Ar(e,c,i,o,l)}),tl=he(function(e,i,o){var c=k|M;if(o.length){var l=Kr(o,rn(tl));c|=W}return Ar(i,c,e,o,l)});function rl(e,i,o){i=o?r:i;var c=Ar(e,T,r,r,r,r,r,i);return c.placeholder=rl.placeholder,c}function il(e,i,o){i=o?r:i;var c=Ar(e,B,r,r,r,r,r,i);return c.placeholder=il.placeholder,c}function nl(e,i,o){var c,l,g,w,_,P,C=0,O=!1,N=!1,z=!0;if(typeof e!="function")throw new kt(h);i=Wt(i)||0,De(o)&&(O=!!o.leading,N="maxWait"in o,g=N?Ge(Wt(o.maxWait)||0,i):g,z="trailing"in o?!!o.trailing:z);function H(Ue){var rr=c,Tr=l;return c=l=r,C=Ue,w=e.apply(Tr,rr),w}function Z(Ue){return C=Ue,_=Ln(pe,i),O?H(Ue):w}function ce(Ue){var rr=Ue-P,Tr=Ue-C,Il=i-rr;return N?st(Il,g-Tr):Il}function X(Ue){var rr=Ue-P,Tr=Ue-C;return P===r||rr>=i||rr<0||N&&Tr>=g}function pe(){var Ue=ho();if(X(Ue))return me(Ue);_=Ln(pe,ce(Ue))}function me(Ue){return _=r,z&&c?H(Ue):(c=l=r,w)}function Nt(){_!==r&&dh(_),C=0,c=P=l=_=r}function pt(){return _===r?w:me(ho())}function Dt(){var Ue=ho(),rr=X(Ue);if(c=arguments,l=this,P=Ue,rr){if(_===r)return Z(P);if(N)return dh(_),_=Ln(pe,i),H(P)}return _===r&&(_=Ln(pe,i)),w}return Dt.cancel=Nt,Dt.flush=pt,Dt}var Qm=he(function(e,i){return Gu(e,1,i)}),Ym=he(function(e,i,o){return Gu(e,Wt(i)||0,o)});function Zm(e){return Ar(e,we)}function lo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new kt(h);var o=function(){var c=arguments,l=i?i.apply(this,c):c[0],g=o.cache;if(g.has(l))return g.get(l);var w=e.apply(this,c);return o.cache=g.set(l,w)||g,w};return o.cache=new(lo.Cache||Sr),o}lo.Cache=Sr;function fo(e){if(typeof e!="function")throw new kt(h);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Xm(e){return el(2,e)}var ev=Lg(function(e,i){i=i.length==1&&ne(i[0])?Te(i[0],Ot(J())):Te(tt(i,1),Ot(J()));var o=i.length;return he(function(c){for(var l=-1,g=st(c.length,o);++l<g;)c[l]=i[l].call(this,c[l]);return Je(e,this,c)})}),uc=he(function(e,i){var o=Kr(i,rn(uc));return Ar(e,W,r,i,o)}),sl=he(function(e,i){var o=Kr(i,rn(sl));return Ar(e,le,r,i,o)}),tv=$r(function(e,i){return Ar(e,oe,r,r,r,i)});function rv(e,i){if(typeof e!="function")throw new kt(h);return i=i===r?i:se(i),he(e,i)}function iv(e,i){if(typeof e!="function")throw new kt(h);return i=i==null?0:Ge(se(i),0),he(function(o){var c=o[i],l=Yr(o,0,i);return c&&Vr(l,c),Je(e,this,l)})}function nv(e,i,o){var c=!0,l=!0;if(typeof e!="function")throw new kt(h);return De(o)&&(c="leading"in o?!!o.leading:c,l="trailing"in o?!!o.trailing:l),nl(e,i,{leading:c,maxWait:i,trailing:l})}function sv(e){return Xh(e,1)}function ov(e,i){return uc(Ga(i),e)}function av(){if(!arguments.length)return[];var e=arguments[0];return ne(e)?e:[e]}function cv(e){return Vt(e,A)}function uv(e,i){return i=typeof i=="function"?i:r,Vt(e,A,i)}function hv(e){return Vt(e,b|A)}function lv(e,i){return i=typeof i=="function"?i:r,Vt(e,b|A,i)}function fv(e,i){return i==null||Ku(e,i,Qe(i))}function tr(e,i){return e===i||e!==e&&i!==i}var pv=no(Da),dv=no(function(e,i){return e>=i}),Ei=Zu(function(){return arguments}())?Zu:function(e){return ze(e)&&Ee.call(e,"callee")&&!Bu.call(e,"callee")},ne=F.isArray,gv=ht?Ot(ht):Ig;function yt(e){return e!=null&&po(e.length)&&!Or(e)}function Le(e){return ze(e)&&yt(e)}function yv(e){return e===!0||e===!1||ze(e)&&lt(e)==Ce}var Zr=Cd||bc,mv=Zt?Ot(Zt):Pg;function vv(e){return ze(e)&&e.nodeType===1&&!Un(e)}function wv(e){if(e==null)return!0;if(yt(e)&&(ne(e)||typeof e=="string"||typeof e.splice=="function"||Zr(e)||nn(e)||Ei(e)))return!e.length;var i=ot(e);if(i==Xe||i==et)return!e.size;if(jn(e))return!Ba(e).length;for(var o in e)if(Ee.call(e,o))return!1;return!0}function bv(e,i){return qn(e,i)}function _v(e,i,o){o=typeof o=="function"?o:r;var c=o?o(e,i):r;return c===r?qn(e,i,r,o):!!c}function hc(e){if(!ze(e))return!1;var i=lt(e);return i==ut||i==Ft||typeof e.message=="string"&&typeof e.name=="string"&&!Un(e)}function Ev(e){return typeof e=="number"&&Lu(e)}function Or(e){if(!De(e))return!1;var i=lt(e);return i==At||i==Lr||i==St||i==Ci}function ol(e){return typeof e=="number"&&e==se(e)}function po(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=K}function De(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function ze(e){return e!=null&&typeof e=="object"}var al=Ut?Ot(Ut):Sg;function Iv(e,i){return e===i||za(e,i,ec(i))}function Pv(e,i,o){return o=typeof o=="function"?o:r,za(e,i,ec(i),o)}function xv(e){return cl(e)&&e!=+e}function Sv(e){if(uy(e))throw new te(u);return Xu(e)}function Fv(e){return e===null}function Av(e){return e==null}function cl(e){return typeof e=="number"||ze(e)&&lt(e)==wr}function Un(e){if(!ze(e)||lt(e)!=$t)return!1;var i=Ls(e);if(i===null)return!0;var o=Ee.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&qs.call(o)==Pd}var lc=lr?Ot(lr):Fg;function $v(e){return ol(e)&&e>=-K&&e<=K}var ul=Sn?Ot(Sn):Ag;function go(e){return typeof e=="string"||!ne(e)&&ze(e)&&lt(e)==cr}function Tt(e){return typeof e=="symbol"||ze(e)&&lt(e)==br}var nn=di?Ot(di):$g;function Cv(e){return e===r}function Ov(e){return ze(e)&&ot(e)==ur}function Rv(e){return ze(e)&&lt(e)==Ri}var Tv=no(ja),Nv=no(function(e,i){return e<=i});function hl(e){if(!e)return[];if(yt(e))return go(e)?Xt(e):gt(e);if(An&&e[An])return fd(e[An]());var i=ot(e),o=i==Xe?Sa:i==et?Ts:sn;return o(e)}function Rr(e){if(!e)return e===0?e:0;if(e=Wt(e),e===V||e===-V){var i=e<0?-1:1;return i*de}return e===e?e:0}function se(e){var i=Rr(e),o=i%1;return i===i?o?i-o:i:0}function ll(e){return e?vi(se(e),0,ae):0}function Wt(e){if(typeof e=="number")return e;if(Tt(e))return fe;if(De(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=De(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Cu(e);var o=ta.test(e);return o||ia.test(e)?ie(e.slice(2),o?2:8):ea.test(e)?fe:+e}function fl(e){return pr(e,mt(e))}function Dv(e){return e?vi(se(e),-K,K):e===0?e:0}function _e(e){return e==null?"":Rt(e)}var qv=en(function(e,i){if(jn(i)||yt(i)){pr(i,Qe(i),e);return}for(var o in i)Ee.call(i,o)&&Tn(e,o,i[o])}),pl=en(function(e,i){pr(i,mt(i),e)}),yo=en(function(e,i,o,c){pr(i,mt(i),e,c)}),zv=en(function(e,i,o,c){pr(i,Qe(i),e,c)}),Bv=$r(Ra);function jv(e,i){var o=Xi(e);return i==null?o:Vu(o,i)}var Lv=he(function(e,i){e=Fe(e);var o=-1,c=i.length,l=c>2?i[2]:r;for(l&&ft(i[0],i[1],l)&&(c=1);++o<c;)for(var g=i[o],w=mt(g),_=-1,P=w.length;++_<P;){var C=w[_],O=e[C];(O===r||tr(O,Qi[C])&&!Ee.call(e,C))&&(e[C]=g[C])}return e}),Uv=he(function(e){return e.push(r,Ch),Je(dl,r,e)});function Mv(e,i){return Su(e,J(i,3),fr)}function kv(e,i){return Su(e,J(i,3),Na)}function Hv(e,i){return e==null?e:Ta(e,J(i,3),mt)}function Vv(e,i){return e==null?e:Qu(e,J(i,3),mt)}function Kv(e,i){return e&&fr(e,J(i,3))}function Gv(e,i){return e&&Na(e,J(i,3))}function Wv(e){return e==null?[]:Qs(e,Qe(e))}function Jv(e){return e==null?[]:Qs(e,mt(e))}function fc(e,i,o){var c=e==null?r:wi(e,i);return c===r?o:c}function Qv(e,i){return e!=null&&Th(e,i,wg)}function pc(e,i){return e!=null&&Th(e,i,bg)}var Yv=xh(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=zs.call(i)),e[i]=o},gc(vt)),Zv=xh(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=zs.call(i)),Ee.call(e,i)?e[i].push(o):e[i]=[o]},J),Xv=he(Dn);function Qe(e){return yt(e)?ku(e):Ba(e)}function mt(e){return yt(e)?ku(e,!0):Cg(e)}function e1(e,i){var o={};return i=J(i,3),fr(e,function(c,l,g){Fr(o,i(c,l,g),c)}),o}function t1(e,i){var o={};return i=J(i,3),fr(e,function(c,l,g){Fr(o,l,i(c,l,g))}),o}var r1=en(function(e,i,o){Ys(e,i,o)}),dl=en(function(e,i,o,c){Ys(e,i,o,c)}),i1=$r(function(e,i){var o={};if(e==null)return o;var c=!1;i=Te(i,function(g){return g=Qr(g,e),c||(c=g.length>1),g}),pr(e,Za(e),o),c&&(o=Vt(o,b|x|A,Yg));for(var l=i.length;l--;)Ha(o,i[l]);return o});function n1(e,i){return gl(e,fo(J(i)))}var s1=$r(function(e,i){return e==null?{}:Rg(e,i)});function gl(e,i){if(e==null)return{};var o=Te(Za(e),function(c){return[c]});return i=J(i),oh(e,o,function(c,l){return i(c,l[0])})}function o1(e,i,o){i=Qr(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var g=e==null?r:e[dr(i[c])];g===r&&(c=l,g=o),e=Or(g)?g.call(e):g}return e}function a1(e,i,o){return e==null?e:zn(e,i,o)}function c1(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:zn(e,i,o,c)}var yl=Ah(Qe),ml=Ah(mt);function u1(e,i,o){var c=ne(e),l=c||Zr(e)||nn(e);if(i=J(i,4),o==null){var g=e&&e.constructor;l?o=c?new g:[]:De(e)?o=Or(g)?Xi(Ls(e)):{}:o={}}return(l?Mt:fr)(e,function(w,_,P){return i(o,w,_,P)}),o}function h1(e,i){return e==null?!0:Ha(e,i)}function l1(e,i,o){return e==null?e:lh(e,i,Ga(o))}function f1(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:lh(e,i,Ga(o),c)}function sn(e){return e==null?[]:xa(e,Qe(e))}function p1(e){return e==null?[]:xa(e,mt(e))}function d1(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=Wt(o),o=o===o?o:0),i!==r&&(i=Wt(i),i=i===i?i:0),vi(Wt(e),i,o)}function g1(e,i,o){return i=Rr(i),o===r?(o=i,i=0):o=Rr(o),e=Wt(e),_g(e,i,o)}function y1(e,i,o){if(o&&typeof o!="boolean"&&ft(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=Rr(e),i===r?(i=e,e=0):i=Rr(i)),e>i){var c=e;e=i,i=c}if(o||e%1||i%1){var l=Uu();return st(e+l*(i-e+xe("1e-"+((l+"").length-1))),i)}return Ua(e,i)}var m1=tn(function(e,i,o){return i=i.toLowerCase(),e+(o?vl(i):i)});function vl(e){return dc(_e(e).toLowerCase())}function wl(e){return e=_e(e),e&&e.replace(Ir,ad).replace(ya,"")}function v1(e,i,o){e=_e(e),i=Rt(i);var c=e.length;o=o===r?c:vi(se(o),0,c);var l=o;return o-=i.length,o>=0&&e.slice(o,l)==i}function w1(e){return e=_e(e),e&&ci.test(e)?e.replace(hs,cd):e}function b1(e){return e=_e(e),e&&Wo.test(e)?e.replace(bn,"\\$&"):e}var _1=tn(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),E1=tn(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),I1=Eh("toLowerCase");function P1(e,i,o){e=_e(e),i=se(i);var c=i?Wi(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return io(Hs(l),o)+e+io(ks(l),o)}function x1(e,i,o){e=_e(e),i=se(i);var c=i?Wi(e):0;return i&&c<i?e+io(i-c,o):e}function S1(e,i,o){e=_e(e),i=se(i);var c=i?Wi(e):0;return i&&c<i?io(i-c,o)+e:e}function F1(e,i,o){return o||i==null?i=0:i&&(i=+i),Nd(_e(e).replace(_n,""),i||0)}function A1(e,i,o){return(o?ft(e,i,o):i===r)?i=1:i=se(i),Ma(_e(e),i)}function $1(){var e=arguments,i=_e(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var C1=tn(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function O1(e,i,o){return o&&typeof o!="number"&&ft(e,i,o)&&(i=o=r),o=o===r?ae:o>>>0,o?(e=_e(e),e&&(typeof i=="string"||i!=null&&!lc(i))&&(i=Rt(i),!i&&Gi(e))?Yr(Xt(e),0,o):e.split(i,o)):[]}var R1=tn(function(e,i,o){return e+(o?" ":"")+dc(i)});function T1(e,i,o){return e=_e(e),o=o==null?0:vi(se(o),0,e.length),i=Rt(i),e.slice(o,o+i.length)==i}function N1(e,i,o){var c=f.templateSettings;o&&ft(e,i,o)&&(i=r),e=_e(e),i=yo({},i,c,$h);var l=yo({},i.imports,c.imports,$h),g=Qe(l),w=xa(l,g),_,P,C=0,O=i.interpolate||ji,N="__p += '",z=Fa((i.escape||ji).source+"|"+O.source+"|"+(O===Bi?Xo:ji).source+"|"+(i.evaluate||ji).source+"|$","g"),H="//# sourceURL="+(Ee.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ma+"]")+`
`;e.replace(z,function(X,pe,me,Nt,pt,Dt){return me||(me=Nt),N+=e.slice(C,Dt).replace(sa,ud),pe&&(_=!0,N+=`' +
__e(`+pe+`) +
'`),pt&&(P=!0,N+=`';
`+pt+`;
__p += '`),me&&(N+=`' +
((__t = (`+me+`)) == null ? '' : __t) +
'`),C=Dt+X.length,X}),N+=`';
`;var Z=Ee.call(i,"variable")&&i.variable;if(!Z)N=`with (obj) {
`+N+`
}
`;else if(Yo.test(Z))throw new te(d);N=(P?N.replace(Vo,""):N).replace(_r,"$1").replace(cs,"$1;"),N="function("+(Z||"obj")+`) {
`+(Z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+N+`return __p
}`;var ce=_l(function(){return ve(g,H+"return "+N).apply(r,w)});if(ce.source=N,hc(ce))throw ce;return ce}function D1(e){return _e(e).toLowerCase()}function q1(e){return _e(e).toUpperCase()}function z1(e,i,o){if(e=_e(e),e&&(o||i===r))return Cu(e);if(!e||!(i=Rt(i)))return e;var c=Xt(e),l=Xt(i),g=Ou(c,l),w=Ru(c,l)+1;return Yr(c,g,w).join("")}function B1(e,i,o){if(e=_e(e),e&&(o||i===r))return e.slice(0,Nu(e)+1);if(!e||!(i=Rt(i)))return e;var c=Xt(e),l=Ru(c,Xt(i))+1;return Yr(c,0,l).join("")}function j1(e,i,o){if(e=_e(e),e&&(o||i===r))return e.replace(_n,"");if(!e||!(i=Rt(i)))return e;var c=Xt(e),l=Ou(c,Xt(i));return Yr(c,l).join("")}function L1(e,i){var o=qt,c=zt;if(De(i)){var l="separator"in i?i.separator:l;o="length"in i?se(i.length):o,c="omission"in i?Rt(i.omission):c}e=_e(e);var g=e.length;if(Gi(e)){var w=Xt(e);g=w.length}if(o>=g)return e;var _=o-Wi(c);if(_<1)return c;var P=w?Yr(w,0,_).join(""):e.slice(0,_);if(l===r)return P+c;if(w&&(_+=P.length-_),lc(l)){if(e.slice(_).search(l)){var C,O=P;for(l.global||(l=Fa(l.source,_e(Lt.exec(l))+"g")),l.lastIndex=0;C=l.exec(O);)var N=C.index;P=P.slice(0,N===r?_:N)}}else if(e.indexOf(Rt(l),_)!=_){var z=P.lastIndexOf(l);z>-1&&(P=P.slice(0,z))}return P+c}function U1(e){return e=_e(e),e&&mn.test(e)?e.replace(us,yd):e}var M1=tn(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),dc=Eh("toUpperCase");function bl(e,i,o){return e=_e(e),i=o?r:i,i===r?ld(e)?wd(e):rd(e):e.match(i)||[]}var _l=he(function(e,i){try{return Je(e,r,i)}catch(o){return hc(o)?o:new te(o)}}),k1=$r(function(e,i){return Mt(i,function(o){o=dr(o),Fr(e,o,cc(e[o],e))}),e});function H1(e){var i=e==null?0:e.length,o=J();return e=i?Te(e,function(c){if(typeof c[1]!="function")throw new kt(h);return[o(c[0]),c[1]]}):[],he(function(c){for(var l=-1;++l<i;){var g=e[l];if(Je(g[0],this,c))return Je(g[1],this,c)}})}function V1(e){return yg(Vt(e,b))}function gc(e){return function(){return e}}function K1(e,i){return e==null||e!==e?i:e}var G1=Ph(),W1=Ph(!0);function vt(e){return e}function yc(e){return eh(typeof e=="function"?e:Vt(e,b))}function J1(e){return rh(Vt(e,b))}function Q1(e,i){return ih(e,Vt(i,b))}var Y1=he(function(e,i){return function(o){return Dn(o,e,i)}}),Z1=he(function(e,i){return function(o){return Dn(e,o,i)}});function mc(e,i,o){var c=Qe(i),l=Qs(i,c);o==null&&!(De(i)&&(l.length||!c.length))&&(o=i,i=e,e=this,l=Qs(i,Qe(i)));var g=!(De(o)&&"chain"in o)||!!o.chain,w=Or(e);return Mt(l,function(_){var P=i[_];e[_]=P,w&&(e.prototype[_]=function(){var C=this.__chain__;if(g||C){var O=e(this.__wrapped__),N=O.__actions__=gt(this.__actions__);return N.push({func:P,args:arguments,thisArg:e}),O.__chain__=C,O}return P.apply(e,Vr([this.value()],arguments))})}),e}function X1(){return ye._===this&&(ye._=xd),this}function vc(){}function e0(e){return e=se(e),he(function(i){return nh(i,e)})}var t0=Ja(Te),r0=Ja(xu),i0=Ja(ba);function El(e){return rc(e)?_a(dr(e)):Tg(e)}function n0(e){return function(i){return e==null?r:wi(e,i)}}var s0=Sh(),o0=Sh(!0);function wc(){return[]}function bc(){return!1}function a0(){return{}}function c0(){return""}function u0(){return!0}function h0(e,i){if(e=se(e),e<1||e>K)return[];var o=ae,c=st(e,ae);i=J(i),e-=ae;for(var l=Pa(c,i);++o<e;)i(o);return l}function l0(e){return ne(e)?Te(e,dr):Tt(e)?[e]:gt(Mh(_e(e)))}function f0(e){var i=++Id;return _e(e)+i}var p0=ro(function(e,i){return e+i},0),d0=Qa("ceil"),g0=ro(function(e,i){return e/i},1),y0=Qa("floor");function m0(e){return e&&e.length?Js(e,vt,Da):r}function v0(e,i){return e&&e.length?Js(e,J(i,2),Da):r}function w0(e){return Au(e,vt)}function b0(e,i){return Au(e,J(i,2))}function _0(e){return e&&e.length?Js(e,vt,ja):r}function E0(e,i){return e&&e.length?Js(e,J(i,2),ja):r}var I0=ro(function(e,i){return e*i},1),P0=Qa("round"),x0=ro(function(e,i){return e-i},0);function S0(e){return e&&e.length?Ia(e,vt):0}function F0(e,i){return e&&e.length?Ia(e,J(i,2)):0}return f.after=Jm,f.ary=Xh,f.assign=qv,f.assignIn=pl,f.assignInWith=yo,f.assignWith=zv,f.at=Bv,f.before=el,f.bind=cc,f.bindAll=k1,f.bindKey=tl,f.castArray=av,f.chain=Qh,f.chunk=yy,f.compact=my,f.concat=vy,f.cond=H1,f.conforms=V1,f.constant=gc,f.countBy=Sm,f.create=jv,f.curry=rl,f.curryRight=il,f.debounce=nl,f.defaults=Lv,f.defaultsDeep=Uv,f.defer=Qm,f.delay=Ym,f.difference=wy,f.differenceBy=by,f.differenceWith=_y,f.drop=Ey,f.dropRight=Iy,f.dropRightWhile=Py,f.dropWhile=xy,f.fill=Sy,f.filter=Am,f.flatMap=Om,f.flatMapDeep=Rm,f.flatMapDepth=Tm,f.flatten=Kh,f.flattenDeep=Fy,f.flattenDepth=Ay,f.flip=Zm,f.flow=G1,f.flowRight=W1,f.fromPairs=$y,f.functions=Wv,f.functionsIn=Jv,f.groupBy=Nm,f.initial=Oy,f.intersection=Ry,f.intersectionBy=Ty,f.intersectionWith=Ny,f.invert=Yv,f.invertBy=Zv,f.invokeMap=qm,f.iteratee=yc,f.keyBy=zm,f.keys=Qe,f.keysIn=mt,f.map=uo,f.mapKeys=e1,f.mapValues=t1,f.matches=J1,f.matchesProperty=Q1,f.memoize=lo,f.merge=r1,f.mergeWith=dl,f.method=Y1,f.methodOf=Z1,f.mixin=mc,f.negate=fo,f.nthArg=e0,f.omit=i1,f.omitBy=n1,f.once=Xm,f.orderBy=Bm,f.over=t0,f.overArgs=ev,f.overEvery=r0,f.overSome=i0,f.partial=uc,f.partialRight=sl,f.partition=jm,f.pick=s1,f.pickBy=gl,f.property=El,f.propertyOf=n0,f.pull=By,f.pullAll=Wh,f.pullAllBy=jy,f.pullAllWith=Ly,f.pullAt=Uy,f.range=s0,f.rangeRight=o0,f.rearg=tv,f.reject=Mm,f.remove=My,f.rest=rv,f.reverse=oc,f.sampleSize=Hm,f.set=a1,f.setWith=c1,f.shuffle=Vm,f.slice=ky,f.sortBy=Wm,f.sortedUniq=Qy,f.sortedUniqBy=Yy,f.split=O1,f.spread=iv,f.tail=Zy,f.take=Xy,f.takeRight=em,f.takeRightWhile=tm,f.takeWhile=rm,f.tap=mm,f.throttle=nv,f.thru=co,f.toArray=hl,f.toPairs=yl,f.toPairsIn=ml,f.toPath=l0,f.toPlainObject=fl,f.transform=u1,f.unary=sv,f.union=im,f.unionBy=nm,f.unionWith=sm,f.uniq=om,f.uniqBy=am,f.uniqWith=cm,f.unset=h1,f.unzip=ac,f.unzipWith=Jh,f.update=l1,f.updateWith=f1,f.values=sn,f.valuesIn=p1,f.without=um,f.words=bl,f.wrap=ov,f.xor=hm,f.xorBy=lm,f.xorWith=fm,f.zip=pm,f.zipObject=dm,f.zipObjectDeep=gm,f.zipWith=ym,f.entries=yl,f.entriesIn=ml,f.extend=pl,f.extendWith=yo,mc(f,f),f.add=p0,f.attempt=_l,f.camelCase=m1,f.capitalize=vl,f.ceil=d0,f.clamp=d1,f.clone=cv,f.cloneDeep=hv,f.cloneDeepWith=lv,f.cloneWith=uv,f.conformsTo=fv,f.deburr=wl,f.defaultTo=K1,f.divide=g0,f.endsWith=v1,f.eq=tr,f.escape=w1,f.escapeRegExp=b1,f.every=Fm,f.find=$m,f.findIndex=Hh,f.findKey=Mv,f.findLast=Cm,f.findLastIndex=Vh,f.findLastKey=kv,f.floor=y0,f.forEach=Yh,f.forEachRight=Zh,f.forIn=Hv,f.forInRight=Vv,f.forOwn=Kv,f.forOwnRight=Gv,f.get=fc,f.gt=pv,f.gte=dv,f.has=Qv,f.hasIn=pc,f.head=Gh,f.identity=vt,f.includes=Dm,f.indexOf=Cy,f.inRange=g1,f.invoke=Xv,f.isArguments=Ei,f.isArray=ne,f.isArrayBuffer=gv,f.isArrayLike=yt,f.isArrayLikeObject=Le,f.isBoolean=yv,f.isBuffer=Zr,f.isDate=mv,f.isElement=vv,f.isEmpty=wv,f.isEqual=bv,f.isEqualWith=_v,f.isError=hc,f.isFinite=Ev,f.isFunction=Or,f.isInteger=ol,f.isLength=po,f.isMap=al,f.isMatch=Iv,f.isMatchWith=Pv,f.isNaN=xv,f.isNative=Sv,f.isNil=Av,f.isNull=Fv,f.isNumber=cl,f.isObject=De,f.isObjectLike=ze,f.isPlainObject=Un,f.isRegExp=lc,f.isSafeInteger=$v,f.isSet=ul,f.isString=go,f.isSymbol=Tt,f.isTypedArray=nn,f.isUndefined=Cv,f.isWeakMap=Ov,f.isWeakSet=Rv,f.join=Dy,f.kebabCase=_1,f.last=Gt,f.lastIndexOf=qy,f.lowerCase=E1,f.lowerFirst=I1,f.lt=Tv,f.lte=Nv,f.max=m0,f.maxBy=v0,f.mean=w0,f.meanBy=b0,f.min=_0,f.minBy=E0,f.stubArray=wc,f.stubFalse=bc,f.stubObject=a0,f.stubString=c0,f.stubTrue=u0,f.multiply=I0,f.nth=zy,f.noConflict=X1,f.noop=vc,f.now=ho,f.pad=P1,f.padEnd=x1,f.padStart=S1,f.parseInt=F1,f.random=y1,f.reduce=Lm,f.reduceRight=Um,f.repeat=A1,f.replace=$1,f.result=o1,f.round=P0,f.runInContext=I,f.sample=km,f.size=Km,f.snakeCase=C1,f.some=Gm,f.sortedIndex=Hy,f.sortedIndexBy=Vy,f.sortedIndexOf=Ky,f.sortedLastIndex=Gy,f.sortedLastIndexBy=Wy,f.sortedLastIndexOf=Jy,f.startCase=R1,f.startsWith=T1,f.subtract=x0,f.sum=S0,f.sumBy=F0,f.template=N1,f.times=h0,f.toFinite=Rr,f.toInteger=se,f.toLength=ll,f.toLower=D1,f.toNumber=Wt,f.toSafeInteger=Dv,f.toString=_e,f.toUpper=q1,f.trim=z1,f.trimEnd=B1,f.trimStart=j1,f.truncate=L1,f.unescape=U1,f.uniqueId=f0,f.upperCase=M1,f.upperFirst=dc,f.each=Yh,f.eachRight=Zh,f.first=Gh,mc(f,function(){var e={};return fr(f,function(i,o){Ee.call(f.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),f.VERSION=n,Mt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),Mt(["drop","take"],function(e,i){ge.prototype[e]=function(o){o=o===r?1:Ge(se(o),0);var c=this.__filtered__&&!i?new ge(this):this.clone();return c.__filtered__?c.__takeCount__=st(o,c.__takeCount__):c.__views__.push({size:st(o,ae),type:e+(c.__dir__<0?"Right":"")}),c},ge.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Mt(["filter","map","takeWhile"],function(e,i){var o=i+1,c=o==jr||o==q;ge.prototype[e]=function(l){var g=this.clone();return g.__iteratees__.push({iteratee:J(l,3),type:o}),g.__filtered__=g.__filtered__||c,g}}),Mt(["head","last"],function(e,i){var o="take"+(i?"Right":"");ge.prototype[e]=function(){return this[o](1).value()[0]}}),Mt(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");ge.prototype[e]=function(){return this.__filtered__?new ge(this):this[o](1)}}),ge.prototype.compact=function(){return this.filter(vt)},ge.prototype.find=function(e){return this.filter(e).head()},ge.prototype.findLast=function(e){return this.reverse().find(e)},ge.prototype.invokeMap=he(function(e,i){return typeof e=="function"?new ge(this):this.map(function(o){return Dn(o,e,i)})}),ge.prototype.reject=function(e){return this.filter(fo(J(e)))},ge.prototype.slice=function(e,i){e=se(e);var o=this;return o.__filtered__&&(e>0||i<0)?new ge(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=se(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},ge.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ge.prototype.toArray=function(){return this.take(ae)},fr(ge.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=f[c?"take"+(i=="last"?"Right":""):i],g=c||/^find/.test(i);l&&(f.prototype[i]=function(){var w=this.__wrapped__,_=c?[1]:arguments,P=w instanceof ge,C=_[0],O=P||ne(w),N=function(pe){var me=l.apply(f,Vr([pe],_));return c&&z?me[0]:me};O&&o&&typeof C=="function"&&C.length!=1&&(P=O=!1);var z=this.__chain__,H=!!this.__actions__.length,Z=g&&!z,ce=P&&!H;if(!g&&O){w=ce?w:new ge(this);var X=e.apply(w,_);return X.__actions__.push({func:co,args:[N],thisArg:r}),new Ht(X,z)}return Z&&ce?e.apply(this,_):(X=this.thru(N),Z?c?X.value()[0]:X.value():X)})}),Mt(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ns[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var g=this.value();return i.apply(ne(g)?g:[],l)}return this[o](function(w){return i.apply(ne(w)?w:[],l)})}}),fr(ge.prototype,function(e,i){var o=f[i];if(o){var c=o.name+"";Ee.call(Zi,c)||(Zi[c]=[]),Zi[c].push({name:i,func:o})}}),Zi[to(r,M).name]=[{name:"wrapper",func:r}],ge.prototype.clone=Ud,ge.prototype.reverse=Md,ge.prototype.value=kd,f.prototype.at=vm,f.prototype.chain=wm,f.prototype.commit=bm,f.prototype.next=_m,f.prototype.plant=Im,f.prototype.reverse=Pm,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=xm,f.prototype.first=f.prototype.head,An&&(f.prototype[An]=Em),f},Ji=bd();je?((je.exports=Ji)._=Ji,Se._=Ji):ye._=Ji}).call(Jn)})(iu,iu.exports);var Bx=Object.defineProperty,jx=Object.defineProperties,Lx=Object.getOwnPropertyDescriptors,Nf=Object.getOwnPropertySymbols,Ux=Object.prototype.hasOwnProperty,Mx=Object.prototype.propertyIsEnumerable,Df=(s,t,r)=>t in s?Bx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,So=(s,t)=>{for(var r in t||(t={}))Ux.call(t,r)&&Df(s,r,t[r]);if(Nf)for(var r of Nf(t))Mx.call(t,r)&&Df(s,r,t[r]);return s},kx=(s,t)=>jx(s,Lx(t));function si(s,t,r){var n;const a=fw(s);return((n=t.rpcMap)==null?void 0:n[a.reference])||`${zx}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Ai(s){return s.includes(":")?s.split(":")[1]:s}function Jp(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function Hx(s,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(s));if(!r.length)return[];const n=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;n.push(...u)}),n}function Vx(s={},t={}){const r=qf(s),n=qf(t);return iu.exports.merge(r,n)}function qf(s){var t,r,n,a;const u={};if(!$o(s))return u;for(const[h,d]of Object.entries(s)){const p=Gf(h)?[h]:d.chains,y=d.methods||[],m=d.events||[],b=d.rpcMap||{},x=Qn(h);u[x]=kx(So(So({},u[x]),d),{chains:Ec(p,(t=u[x])==null?void 0:t.chains),methods:Ec(y,(r=u[x])==null?void 0:r.methods),events:Ec(m,(n=u[x])==null?void 0:n.events),rpcMap:So(So({},b),(a=u[x])==null?void 0:a.rpcMap)})}return u}function Kx(s){return s.includes(":")?s.split(":")[2]:s}function Gx(s){const t={};for(const[r,n]of Object.entries(s)){const a=n.methods||[],u=n.events||[],h=n.accounts||[],d=Gf(r)?[r]:n.chains?n.chains:Jp(n.accounts);t[r]={chains:d,methods:a,events:u,accounts:h}}return t}function Uc(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const Qp={},Ne=s=>Qp[s],Mc=(s,t)=>{Qp[s]=t};class Wx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=Ai(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class Jx{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||si(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=parseInt(Ai(r));t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class Qx{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=Ai(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class Yx{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=Ai(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class Zx{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),a=Ai(r);t[a]=this.createHttpProvider(a,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class Xx{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=Ai(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class eS{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const a=Ai(r);t[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Ne("disableProviderPing")))}}class tS{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Ne("events"),this.client=Ne("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||si(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(Br.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace);return typeof n>"u"?void 0:new ai(new oi(n,Ne("disableProviderPing")))}}var rS=Object.defineProperty,iS=Object.defineProperties,nS=Object.getOwnPropertyDescriptors,zf=Object.getOwnPropertySymbols,sS=Object.prototype.hasOwnProperty,oS=Object.prototype.propertyIsEnumerable,Bf=(s,t,r)=>t in s?rS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Fo=(s,t)=>{for(var r in t||(t={}))sS.call(t,r)&&Bf(s,r,t[r]);if(zf)for(var r of zf(t))oS.call(t,r)&&Bf(s,r,t[r]);return s},kc=(s,t)=>iS(s,nS(t));class Iu{constructor(t){this.events=new uu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Lo(Uo({level:(t==null?void 0:t.logger)||Rf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Iu(t);return await r.initialize(),r}async request(t,r){const[n,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Fo({},t),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(t,r,n){const a=new Date().getTime();this.request(t,n).then(u=>r(null,Bo(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:at("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=Gx(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Gp)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,a]=this.validateChain(t);this.getProvider(n).setDefaultChain(a,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(pn(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Tx.init({logger:this.providerOpts.logger||Rf,relayUrl:this.providerOpts.relayUrl||Nx,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Qn(r)))];Mc("client",this.client),Mc("events",this.events),Mc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=Hx(r,this.session),a=Jp(n),u=Vx(this.namespaces,this.optionalNamespaces),h=kc(Fo({},u[r]),{accounts:n,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new Jx({namespace:h});break;case"solana":this.rpcProviders[r]=new Qx({namespace:h});break;case"cosmos":this.rpcProviders[r]=new Yx({namespace:h});break;case"polkadot":this.rpcProviders[r]=new Wx({namespace:h});break;case"cip34":this.rpcProviders[r]=new Zx({namespace:h});break;case"elrond":this.rpcProviders[r]=new Xx({namespace:h});break;case"multiversx":this.rpcProviders[r]=new eS({namespace:h});break;case"near":this.rpcProviders[r]=new tS({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const a=n.data;a&&pn(a)&&this.events.emit("accountsChanged",a.map(Kx))}else if(n.name==="chainChanged"){const a=r.chainId,u=r.event.data,h=Qn(a),d=Uc(a)!==Uc(u)?`${h}:${Uc(u)}`:a;this.onChainChanged(d)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:a}=r,u=(n=this.client)==null?void 0:n.session.get(t);this.session=kc(Fo({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",kc(Fo({},at("USER_DISCONNECTED")),{data:t.topic}))}),this.on(Br.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(h=>Qn(h)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const a=Qn(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Tf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Tf}/${t}`)}}const aS=Iu,cS="wc",uS="ethereum_provider",hS=`${cS}@2:${uS}:`,lS="https://rpc.walletconnect.com/v1/",nu=["eth_sendTransaction","personal_sign"],fS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],su=["chainChanged","accountsChanged"],pS=["chainChanged","accountsChanged","message","disconnect","connect"];var dS=Object.defineProperty,gS=Object.defineProperties,yS=Object.getOwnPropertyDescriptors,jf=Object.getOwnPropertySymbols,mS=Object.prototype.hasOwnProperty,vS=Object.prototype.propertyIsEnumerable,Lf=(s,t,r)=>t in s?dS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Zn=(s,t)=>{for(var r in t||(t={}))mS.call(t,r)&&Lf(s,r,t[r]);if(jf)for(var r of jf(t))vS.call(t,r)&&Lf(s,r,t[r]);return s},Uf=(s,t)=>gS(s,yS(t));function Do(s){return Number(s[0].split(":")[1])}function Hc(s){return`0x${s.toString(16)}`}function wS(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:a,events:u,optionalEvents:h,rpcMap:d}=s;if(!pn(t))throw new Error("Invalid chains");const p={chains:t,methods:n||nu,events:u||su,rpcMap:Zn({},t.length?{[Do(t)]:d[Do(t)]}:{})},y=u==null?void 0:u.filter(A=>!su.includes(A)),m=n==null?void 0:n.filter(A=>!nu.includes(A));if(!r&&!h&&!a&&!(y!=null&&y.length)&&!(m!=null&&m.length))return{required:t.length?p:void 0};const b=(y==null?void 0:y.length)&&(m==null?void 0:m.length)||!r,x={chains:[...new Set(b?p.chains.concat(r||[]):r)],methods:[...new Set(p.methods.concat(a!=null&&a.length?a:fS))],events:[...new Set(p.events.concat(h!=null&&h.length?h:pS))],rpcMap:d};return{required:t.length?p:void 0,optional:r.length?x:void 0}}class Pu{constructor(){this.events=new Qt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=hS,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Pu;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=wS(this.rpc);try{const a=await new Promise(async(h,d)=>{var p;this.rpc.showQrModal&&((p=this.modal)==null||p.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),d(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Uf(Zn({namespaces:Zn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(y=>{h(y)}).catch(y=>{d(new Error(y.message))})});if(!a)return;const u=pw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:Hc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Hc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Uf(Zn({},at("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Hc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,a]=t.split(":");return{chainId:`${r}:${n}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(n=t==null?void 0:t.optionalChains)!=null?n:[],h=a.concat(u);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const d=a.length?(t==null?void 0:t.methods)||nu:[],p=a.length?(t==null?void 0:t.events)||su:[],y=(t==null?void 0:t.optionalMethods)||[],m=(t==null?void 0:t.optionalEvents)||[],b=(t==null?void 0:t.rpcMap)||this.buildRpcMap(h,t.projectId),x=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(A=>this.formatChainId(A)),optionalChains:u.map(A=>this.formatChainId(A)),methods:d,events:p,optionalMethods:y,optionalEvents:m,rpcMap:b,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:x,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(a=>{n[a]=this.getRpcUrl(a,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Do(this.rpc.chains):Do(this.rpc.optionalChains),this.signer=await aS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await dw(()=>import("./index-4d9504d5.js").then(a=>a.i),["./index-4d9504d5.js","./web3-735b79eb.js","./vendor-d152ed12.js"],import.meta.url);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Zn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:a}=t;r&&pn(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),n&&pn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(u=>this.formatChainId(u)),n.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${lS}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const US=Pu;export{US as EthereumProvider,pS as OPTIONAL_EVENTS,fS as OPTIONAL_METHODS,su as REQUIRED_EVENTS,nu as REQUIRED_METHODS,Pu as default};
//# sourceMappingURL=index.es-1526eef7.js.map
